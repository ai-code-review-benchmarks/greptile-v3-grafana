/*! For license information please see module.js.LICENSE.txt */
define(["@grafana/data","@grafana/runtime","react","@grafana/ui","@emotion/css","prismjs","lodash","rxjs"],((e,t,r,n,s,a,i,o)=>(()=>{var l={9874:(e,t,r)=>{"use strict";var n=r(300),s={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},o={};function l(e){return n.isMemo(e)?i:o[e.$$typeof]||s}o[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},o[n.Memo]=i;var c=Object.defineProperty,u=Object.getOwnPropertyNames,p=Object.getOwnPropertySymbols,g=Object.getOwnPropertyDescriptor,d=Object.getPrototypeOf,h=Object.prototype;e.exports=function e(t,r,n){if("string"!=typeof r){if(h){var s=d(r);s&&s!==h&&e(t,s,n)}var i=u(r);p&&(i=i.concat(p(r)));for(var o=l(t),f=l(r),m=0;m<i.length;++m){var v=i[m];if(!(a[v]||n&&n[v]||f&&f[v]||o&&o[v])){var y=g(r,v);try{c(t,v,y)}catch(e){}}}}return t}},3520:(e,t)=>{"use strict";var r="function"==typeof Symbol&&Symbol.for,n=r?Symbol.for("react.element"):60103,s=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,i=r?Symbol.for("react.strict_mode"):60108,o=r?Symbol.for("react.profiler"):60114,l=r?Symbol.for("react.provider"):60109,c=r?Symbol.for("react.context"):60110,u=r?Symbol.for("react.async_mode"):60111,p=r?Symbol.for("react.concurrent_mode"):60111,g=r?Symbol.for("react.forward_ref"):60112,d=r?Symbol.for("react.suspense"):60113,h=r?Symbol.for("react.suspense_list"):60120,f=r?Symbol.for("react.memo"):60115,m=r?Symbol.for("react.lazy"):60116,v=r?Symbol.for("react.block"):60121,y=r?Symbol.for("react.fundamental"):60117,O=r?Symbol.for("react.responder"):60118,b=r?Symbol.for("react.scope"):60119;function S(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case u:case p:case a:case o:case i:case d:return e;default:switch(e=e&&e.$$typeof){case c:case g:case m:case f:case l:return e;default:return t}}case s:return t}}}function x(e){return S(e)===p}t.AsyncMode=u,t.ConcurrentMode=p,t.ContextConsumer=c,t.ContextProvider=l,t.Element=n,t.ForwardRef=g,t.Fragment=a,t.Lazy=m,t.Memo=f,t.Portal=s,t.Profiler=o,t.StrictMode=i,t.Suspense=d,t.isAsyncMode=function(e){return x(e)||S(e)===u},t.isConcurrentMode=x,t.isContextConsumer=function(e){return S(e)===c},t.isContextProvider=function(e){return S(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},t.isForwardRef=function(e){return S(e)===g},t.isFragment=function(e){return S(e)===a},t.isLazy=function(e){return S(e)===m},t.isMemo=function(e){return S(e)===f},t.isPortal=function(e){return S(e)===s},t.isProfiler=function(e){return S(e)===o},t.isStrictMode=function(e){return S(e)===i},t.isSuspense=function(e){return S(e)===d},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===a||e===p||e===o||e===i||e===d||e===h||"object"==typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===f||e.$$typeof===l||e.$$typeof===c||e.$$typeof===g||e.$$typeof===y||e.$$typeof===O||e.$$typeof===b||e.$$typeof===v)},t.typeOf=S},300:(e,t,r)=>{"use strict";e.exports=r(3520)},1777:(e,t,r)=>{"use strict";var n=r(4769),s=r(5959),a=n.__importDefault(r(5053));t.A=function(e,t){void 0===t&&(t=[]);var r=a.default(e,t,{loading:!0}),n=r[0],i=r[1];return s.useEffect((function(){i()}),[i]),n}},5053:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4769),s=r(5959),a=n.__importDefault(r(9812));t.default=function(e,t,r){void 0===t&&(t=[]),void 0===r&&(r={loading:!1});var i=s.useRef(0),o=a.default(),l=s.useState(r),c=l[0],u=l[1],p=s.useCallback((function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var s=++i.current;return c.loading||u((function(e){return n.__assign(n.__assign({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return o()&&s===i.current&&u({value:e,loading:!1}),e}),(function(e){return o()&&s===i.current&&u({error:e,loading:!1}),e}))}),t);return[c,p]}},9812:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5959);t.default=function(){var e=n.useRef(!1),t=n.useCallback((function(){return e.current}),[]);return n.useEffect((function(){return e.current=!0,function(){e.current=!1}}),[]),t}},8044:(e,t,r)=>{"use strict";var n=r(5959),s=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,a={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,n)&&!l.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:s,type:e,key:c,ref:u,props:a,_owner:o.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},9728:(e,t,r)=>{"use strict";e.exports=r(8044)},9264:(e,t,r)=>{const n=Symbol("SemVer ANY");class s{static get ANY(){return n}constructor(e,t){if(t=a(t),e instanceof s){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),c("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===n?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){const t=this.options.loose?i[o.COMPARATORLOOSE]:i[o.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new u(r[2],this.options.loose):this.semver=n}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===n||e===n)return!0;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof s))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new p(e.value,t).test(this.value):""===e.operator?""===e.value||new p(this.value,t).test(e.semver):!((t=a(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!e.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!e.operator.startsWith("<"))&&(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))&&!(l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))&&!(l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}e.exports=s;const a=r(9547),{safeRe:i,t:o}=r(5750),l=r(4991),c=r(1064),u=r(4708),p=r(2839)},2839:(e,t,r)=>{const n=/\s+/g;class s{constructor(e,t){if(t=i(t),e instanceof s)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new s(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(n," "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!v(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&y(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&f)|(this.options.loose&&m))+":"+e,r=a.get(t);if(r)return r;const n=this.options.loose,s=n?u[p.HYPHENRANGELOOSE]:u[p.HYPHENRANGE];e=e.replace(s,C(this.options.includePrerelease)),l("hyphen replace",e),e=e.replace(u[p.COMPARATORTRIM],g),l("comparator trim",e),e=e.replace(u[p.TILDETRIM],d),l("tilde trim",e),e=e.replace(u[p.CARETTRIM],h),l("caret trim",e);let i=e.split(" ").map((e=>b(e,this.options))).join(" ").split(/\s+/).map((e=>k(e,this.options)));n&&(i=i.filter((e=>(l("loose invalid filter",e,this.options),!!e.match(u[p.COMPARATORLOOSE]))))),l("range list",i);const c=new Map,y=i.map((e=>new o(e,this.options)));for(const e of y){if(v(e))return[e];c.set(e.value,e)}c.size>1&&c.has("")&&c.delete("");const O=[...c.values()];return a.set(t,O),O}intersects(e,t){if(!(e instanceof s))throw new TypeError("a Range is required");return this.set.some((r=>O(r,t)&&e.set.some((e=>O(e,t)&&r.every((r=>e.every((e=>r.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(R(this.set[t],e,this.options))return!0;return!1}}e.exports=s;const a=new(r(122)),i=r(9547),o=r(9264),l=r(1064),c=r(4708),{safeRe:u,t:p,comparatorTrimReplace:g,tildeTrimReplace:d,caretTrimReplace:h}=r(5750),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:m}=r(2074),v=e=>"<0.0.0-0"===e.value,y=e=>""===e.value,O=(e,t)=>{let r=!0;const n=e.slice();let s=n.pop();for(;r&&n.length;)r=n.every((e=>s.intersects(e,t))),s=n.pop();return r},b=(e,t)=>(l("comp",e,t),e=j(e,t),l("caret",e),e=x(e,t),l("tildes",e),e=P(e,t),l("xrange",e),e=E(e,t),l("stars",e),e),S=e=>!e||"x"===e.toLowerCase()||"*"===e,x=(e,t)=>e.trim().split(/\s+/).map((e=>w(e,t))).join(" "),w=(e,t)=>{const r=t.loose?u[p.TILDELOOSE]:u[p.TILDE];return e.replace(r,((t,r,n,s,a)=>{let i;return l("tilde",e,t,r,n,s,a),S(r)?i="":S(n)?i=`>=${r}.0.0 <${+r+1}.0.0-0`:S(s)?i=`>=${r}.${n}.0 <${r}.${+n+1}.0-0`:a?(l("replaceTilde pr",a),i=`>=${r}.${n}.${s}-${a} <${r}.${+n+1}.0-0`):i=`>=${r}.${n}.${s} <${r}.${+n+1}.0-0`,l("tilde return",i),i}))},j=(e,t)=>e.trim().split(/\s+/).map((e=>T(e,t))).join(" "),T=(e,t)=>{l("caret",e,t);const r=t.loose?u[p.CARETLOOSE]:u[p.CARET],n=t.includePrerelease?"-0":"";return e.replace(r,((t,r,s,a,i)=>{let o;return l("caret",e,t,r,s,a,i),S(r)?o="":S(s)?o=`>=${r}.0.0${n} <${+r+1}.0.0-0`:S(a)?o="0"===r?`>=${r}.${s}.0${n} <${r}.${+s+1}.0-0`:`>=${r}.${s}.0${n} <${+r+1}.0.0-0`:i?(l("replaceCaret pr",i),o="0"===r?"0"===s?`>=${r}.${s}.${a}-${i} <${r}.${s}.${+a+1}-0`:`>=${r}.${s}.${a}-${i} <${r}.${+s+1}.0-0`:`>=${r}.${s}.${a}-${i} <${+r+1}.0.0-0`):(l("no pr"),o="0"===r?"0"===s?`>=${r}.${s}.${a}${n} <${r}.${s}.${+a+1}-0`:`>=${r}.${s}.${a}${n} <${r}.${+s+1}.0-0`:`>=${r}.${s}.${a} <${+r+1}.0.0-0`),l("caret return",o),o}))},P=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map((e=>_(e,t))).join(" ")),_=(e,t)=>{e=e.trim();const r=t.loose?u[p.XRANGELOOSE]:u[p.XRANGE];return e.replace(r,((r,n,s,a,i,o)=>{l("xRange",e,r,n,s,a,i,o);const c=S(s),u=c||S(a),p=u||S(i),g=p;return"="===n&&g&&(n=""),o=t.includePrerelease?"-0":"",c?r=">"===n||"<"===n?"<0.0.0-0":"*":n&&g?(u&&(a=0),i=0,">"===n?(n=">=",u?(s=+s+1,a=0,i=0):(a=+a+1,i=0)):"<="===n&&(n="<",u?s=+s+1:a=+a+1),"<"===n&&(o="-0"),r=`${n+s}.${a}.${i}${o}`):u?r=`>=${s}.0.0${o} <${+s+1}.0.0-0`:p&&(r=`>=${s}.${a}.0${o} <${s}.${+a+1}.0-0`),l("xRange return",r),r}))},E=(e,t)=>(l("replaceStars",e,t),e.trim().replace(u[p.STAR],"")),k=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(u[t.includePrerelease?p.GTE0PRE:p.GTE0],"")),C=e=>(t,r,n,s,a,i,o,l,c,u,p,g)=>`${r=S(n)?"":S(s)?`>=${n}.0.0${e?"-0":""}`:S(a)?`>=${n}.${s}.0${e?"-0":""}`:i?`>=${r}`:`>=${r}${e?"-0":""}`} ${l=S(c)?"":S(u)?`<${+c+1}.0.0-0`:S(p)?`<${c}.${+u+1}.0-0`:g?`<=${c}.${u}.${p}-${g}`:e?`<${c}.${u}.${+p+1}-0`:`<=${l}`}`.trim(),R=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==o.ANY&&e[r].semver.prerelease.length>0){const n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}},4708:(e,t,r)=>{const n=r(1064),{MAX_LENGTH:s,MAX_SAFE_INTEGER:a}=r(2074),{safeRe:i,t:o}=r(5750),l=r(9547),{compareIdentifiers:c}=r(1427);class u{constructor(e,t){if(t=l(t),e instanceof u){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>s)throw new TypeError(`version is longer than ${s} characters`);n("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?i[o.LOOSE]:i[o.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>a||this.major<0)throw new TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<a)return t}return e})):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(n("SemVer.compare",this.version,this.options,e),!(e instanceof u)){if("string"==typeof e&&e===this.version)return 0;e=new u(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof u||(e=new u(e,this.options)),c(this.major,e.major)||c(this.minor,e.minor)||c(this.patch,e.patch)}comparePre(e){if(e instanceof u||(e=new u(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],s=e.prerelease[t];if(n("prerelease compare",t,r,s),void 0===r&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===r)return-1;if(r!==s)return c(r,s)}while(++t)}compareBuild(e){e instanceof u||(e=new u(e,this.options));let t=0;do{const r=this.build[t],s=e.build[t];if(n("build compare",t,r,s),void 0===r&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===r)return-1;if(r!==s)return c(r,s)}while(++t)}inc(e,t,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let n=this.prerelease.length;for(;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let n=[t,e];!1===r&&(n=[t]),0===c(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=u},8854:(e,t,r)=>{const n=r(4256);e.exports=(e,t)=>{const r=n(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},4991:(e,t,r)=>{const n=r(1409),s=r(6031),a=r(9308),i=r(3833),o=r(2083),l=r(4624);e.exports=(e,t,r,c)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return n(e,r,c);case"!=":return s(e,r,c);case">":return a(e,r,c);case">=":return i(e,r,c);case"<":return o(e,r,c);case"<=":return l(e,r,c);default:throw new TypeError(`Invalid operator: ${t}`)}}},362:(e,t,r)=>{const n=r(4708),s=r(4256),{safeRe:a,t:i}=r(5750);e.exports=(e,t)=>{if(e instanceof n)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){const n=t.includePrerelease?a[i.COERCERTLFULL]:a[i.COERCERTL];let s;for(;(s=n.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&s.index+s[0].length===r.index+r[0].length||(r=s),n.lastIndex=s.index+s[1].length+s[2].length;n.lastIndex=-1}else r=e.match(t.includePrerelease?a[i.COERCEFULL]:a[i.COERCE]);if(null===r)return null;const o=r[2],l=r[3]||"0",c=r[4]||"0",u=t.includePrerelease&&r[5]?`-${r[5]}`:"",p=t.includePrerelease&&r[6]?`+${r[6]}`:"";return s(`${o}.${l}.${c}${u}${p}`,t)}},7565:(e,t,r)=>{const n=r(4708);e.exports=(e,t,r)=>{const s=new n(e,r),a=new n(t,r);return s.compare(a)||s.compareBuild(a)}},5699:(e,t,r)=>{const n=r(3440);e.exports=(e,t)=>n(e,t,!0)},3440:(e,t,r)=>{const n=r(4708);e.exports=(e,t,r)=>new n(e,r).compare(new n(t,r))},4952:(e,t,r)=>{const n=r(4256);e.exports=(e,t)=>{const r=n(e,null,!0),s=n(t,null,!0),a=r.compare(s);if(0===a)return null;const i=a>0,o=i?r:s,l=i?s:r,c=!!o.prerelease.length;if(l.prerelease.length&&!c)return l.patch||l.minor?o.patch?"patch":o.minor?"minor":"major":"major";const u=c?"pre":"";return r.major!==s.major?u+"major":r.minor!==s.minor?u+"minor":r.patch!==s.patch?u+"patch":"prerelease"}},1409:(e,t,r)=>{const n=r(3440);e.exports=(e,t,r)=>0===n(e,t,r)},9308:(e,t,r)=>{const n=r(3440);e.exports=(e,t,r)=>n(e,t,r)>0},3833:(e,t,r)=>{const n=r(3440);e.exports=(e,t,r)=>n(e,t,r)>=0},2479:(e,t,r)=>{const n=r(4708);e.exports=(e,t,r,s,a)=>{"string"==typeof r&&(a=s,s=r,r=void 0);try{return new n(e instanceof n?e.version:e,r).inc(t,s,a).version}catch(e){return null}}},2083:(e,t,r)=>{const n=r(3440);e.exports=(e,t,r)=>n(e,t,r)<0},4624:(e,t,r)=>{const n=r(3440);e.exports=(e,t,r)=>n(e,t,r)<=0},1034:(e,t,r)=>{const n=r(4708);e.exports=(e,t)=>new n(e,t).major},9406:(e,t,r)=>{const n=r(4708);e.exports=(e,t)=>new n(e,t).minor},6031:(e,t,r)=>{const n=r(3440);e.exports=(e,t,r)=>0!==n(e,t,r)},4256:(e,t,r)=>{const n=r(4708);e.exports=(e,t,r=!1)=>{if(e instanceof n)return e;try{return new n(e,t)}catch(e){if(!r)return null;throw e}}},5229:(e,t,r)=>{const n=r(4708);e.exports=(e,t)=>new n(e,t).patch},6513:(e,t,r)=>{const n=r(4256);e.exports=(e,t)=>{const r=n(e,t);return r&&r.prerelease.length?r.prerelease:null}},7618:(e,t,r)=>{const n=r(3440);e.exports=(e,t,r)=>n(t,e,r)},1173:(e,t,r)=>{const n=r(7565);e.exports=(e,t)=>e.sort(((e,r)=>n(r,e,t)))},3238:(e,t,r)=>{const n=r(2839);e.exports=(e,t,r)=>{try{t=new n(t,r)}catch(e){return!1}return t.test(e)}},3559:(e,t,r)=>{const n=r(7565);e.exports=(e,t)=>e.sort(((e,r)=>n(e,r,t)))},9881:(e,t,r)=>{const n=r(4256);e.exports=(e,t)=>{const r=n(e,t);return r?r.version:null}},709:(e,t,r)=>{const n=r(5750),s=r(2074),a=r(4708),i=r(1427),o=r(4256),l=r(9881),c=r(8854),u=r(2479),p=r(4952),g=r(1034),d=r(9406),h=r(5229),f=r(6513),m=r(3440),v=r(7618),y=r(5699),O=r(7565),b=r(3559),S=r(1173),x=r(9308),w=r(2083),j=r(1409),T=r(6031),P=r(3833),_=r(4624),E=r(4991),k=r(362),C=r(9264),R=r(2839),N=r(3238),I=r(3327),D=r(6988),$=r(2366),F=r(7453),A=r(130),Q=r(7715),L=r(7379),W=r(110),z=r(284),q=r(8285),M=r(2008);e.exports={parse:o,valid:l,clean:c,inc:u,diff:p,major:g,minor:d,patch:h,prerelease:f,compare:m,rcompare:v,compareLoose:y,compareBuild:O,sort:b,rsort:S,gt:x,lt:w,eq:j,neq:T,gte:P,lte:_,cmp:E,coerce:k,Comparator:C,Range:R,satisfies:N,toComparators:I,maxSatisfying:D,minSatisfying:$,minVersion:F,validRange:A,outside:Q,gtr:L,ltr:W,intersects:z,simplifyRange:q,subset:M,SemVer:a,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:s.SEMVER_SPEC_VERSION,RELEASE_TYPES:s.RELEASE_TYPES,compareIdentifiers:i.compareIdentifiers,rcompareIdentifiers:i.rcompareIdentifiers}},2074:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},1064:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},1427:e=>{const t=/^[0-9]+$/,r=(e,r)=>{const n=t.test(e),s=t.test(r);return n&&s&&(e=+e,r=+r),e===r?0:n&&!s?-1:s&&!n?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},122:e=>{e.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},9547:e=>{const t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},5750:(e,t,r)=>{const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:a}=r(2074),i=r(1064),o=(t=e.exports={}).re=[],l=t.safeRe=[],c=t.src=[],u=t.t={};let p=0;const g="[a-zA-Z0-9-]",d=[["\\s",1],["\\d",a],[g,s]],h=(e,t,r)=>{const n=(e=>{for(const[t,r]of d)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),s=p++;i(e,s,t),u[e]=s,c[s]=t,o[s]=new RegExp(t,r?"g":void 0),l[s]=new RegExp(n,r?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","\\d+"),h("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${g}*`),h("MAINVERSION",`(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${c[u.NUMERICIDENTIFIER]}|${c[u.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${c[u.NUMERICIDENTIFIERLOOSE]}|${c[u.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${c[u.PRERELEASEIDENTIFIER]}(?:\\.${c[u.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${c[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[u.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER",`${g}+`),h("BUILD",`(?:\\+(${c[u.BUILDIDENTIFIER]}(?:\\.${c[u.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${c[u.MAINVERSION]}${c[u.PRERELEASE]}?${c[u.BUILD]}?`),h("FULL",`^${c[u.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${c[u.MAINVERSIONLOOSE]}${c[u.PRERELEASELOOSE]}?${c[u.BUILD]}?`),h("LOOSE",`^${c[u.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${c[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${c[u.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:${c[u.PRERELEASE]})?${c[u.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:${c[u.PRERELEASELOOSE]})?${c[u.BUILD]}?)?)?`),h("XRANGE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAINLOOSE]}$`),h("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),h("COERCE",`${c[u.COERCEPLAIN]}(?:$|[^\\d])`),h("COERCEFULL",c[u.COERCEPLAIN]+`(?:${c[u.PRERELEASE]})?`+`(?:${c[u.BUILD]})?(?:$|[^\\d])`),h("COERCERTL",c[u.COERCE],!0),h("COERCERTLFULL",c[u.COERCEFULL],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${c[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",h("TILDE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${c[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",h("CARET",`^${c[u.LONECARET]}${c[u.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${c[u.LONECARET]}${c[u.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${c[u.GTLT]}\\s*(${c[u.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]}|${c[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${c[u.XRANGEPLAIN]})\\s+-\\s+(${c[u.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${c[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[u.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},7379:(e,t,r)=>{const n=r(7715);e.exports=(e,t,r)=>n(e,t,">",r)},284:(e,t,r)=>{const n=r(2839);e.exports=(e,t,r)=>(e=new n(e,r),t=new n(t,r),e.intersects(t,r))},110:(e,t,r)=>{const n=r(7715);e.exports=(e,t,r)=>n(e,t,"<",r)},6988:(e,t,r)=>{const n=r(4708),s=r(2839);e.exports=(e,t,r)=>{let a=null,i=null,o=null;try{o=new s(t,r)}catch(e){return null}return e.forEach((e=>{o.test(e)&&(a&&-1!==i.compare(e)||(a=e,i=new n(a,r)))})),a}},2366:(e,t,r)=>{const n=r(4708),s=r(2839);e.exports=(e,t,r)=>{let a=null,i=null,o=null;try{o=new s(t,r)}catch(e){return null}return e.forEach((e=>{o.test(e)&&(a&&1!==i.compare(e)||(a=e,i=new n(a,r)))})),a}},7453:(e,t,r)=>{const n=r(4708),s=r(2839),a=r(9308);e.exports=(e,t)=>{e=new s(e,t);let r=new n("0.0.0");if(e.test(r))return r;if(r=new n("0.0.0-0"),e.test(r))return r;r=null;for(let t=0;t<e.set.length;++t){const s=e.set[t];let i=null;s.forEach((e=>{const t=new n(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":i&&!a(t,i)||(i=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!i||r&&!a(r,i)||(r=i)}return r&&e.test(r)?r:null}},7715:(e,t,r)=>{const n=r(4708),s=r(9264),{ANY:a}=s,i=r(2839),o=r(3238),l=r(9308),c=r(2083),u=r(4624),p=r(3833);e.exports=(e,t,r,g)=>{let d,h,f,m,v;switch(e=new n(e,g),t=new i(t,g),r){case">":d=l,h=u,f=c,m=">",v=">=";break;case"<":d=c,h=p,f=l,m="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,g))return!1;for(let r=0;r<t.set.length;++r){const n=t.set[r];let i=null,o=null;if(n.forEach((e=>{e.semver===a&&(e=new s(">=0.0.0")),i=i||e,o=o||e,d(e.semver,i.semver,g)?i=e:f(e.semver,o.semver,g)&&(o=e)})),i.operator===m||i.operator===v)return!1;if((!o.operator||o.operator===m)&&h(e,o.semver))return!1;if(o.operator===v&&f(e,o.semver))return!1}return!0}},8285:(e,t,r)=>{const n=r(3238),s=r(3440);e.exports=(e,t,r)=>{const a=[];let i=null,o=null;const l=e.sort(((e,t)=>s(e,t,r)));for(const e of l)n(e,t,r)?(o=e,i||(i=e)):(o&&a.push([i,o]),o=null,i=null);i&&a.push([i,null]);const c=[];for(const[e,t]of a)e===t?c.push(e):t||e!==l[0]?t?e===l[0]?c.push(`<=${t}`):c.push(`${e} - ${t}`):c.push(`>=${e}`):c.push("*");const u=c.join(" || "),p="string"==typeof t.raw?t.raw:String(t);return u.length<p.length?u:t}},2008:(e,t,r)=>{const n=r(2839),s=r(9264),{ANY:a}=s,i=r(3238),o=r(3440),l=[new s(">=0.0.0-0")],c=[new s(">=0.0.0")],u=(e,t,r)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===a){if(1===t.length&&t[0].semver===a)return!0;e=r.includePrerelease?l:c}if(1===t.length&&t[0].semver===a){if(r.includePrerelease)return!0;t=c}const n=new Set;let s,u,d,h,f,m,v;for(const t of e)">"===t.operator||">="===t.operator?s=p(s,t,r):"<"===t.operator||"<="===t.operator?u=g(u,t,r):n.add(t.semver);if(n.size>1)return null;if(s&&u){if(d=o(s.semver,u.semver,r),d>0)return null;if(0===d&&(">="!==s.operator||"<="!==u.operator))return null}for(const e of n){if(s&&!i(e,String(s),r))return null;if(u&&!i(e,String(u),r))return null;for(const n of t)if(!i(e,String(n),r))return!1;return!0}let y=!(!u||r.includePrerelease||!u.semver.prerelease.length)&&u.semver,O=!(!s||r.includePrerelease||!s.semver.prerelease.length)&&s.semver;y&&1===y.prerelease.length&&"<"===u.operator&&0===y.prerelease[0]&&(y=!1);for(const e of t){if(v=v||">"===e.operator||">="===e.operator,m=m||"<"===e.operator||"<="===e.operator,s)if(O&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===O.major&&e.semver.minor===O.minor&&e.semver.patch===O.patch&&(O=!1),">"===e.operator||">="===e.operator){if(h=p(s,e,r),h===e&&h!==s)return!1}else if(">="===s.operator&&!i(s.semver,String(e),r))return!1;if(u)if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),"<"===e.operator||"<="===e.operator){if(f=g(u,e,r),f===e&&f!==u)return!1}else if("<="===u.operator&&!i(u.semver,String(e),r))return!1;if(!e.operator&&(u||s)&&0!==d)return!1}return!(s&&m&&!u&&0!==d||u&&v&&!s&&0!==d||O||y)},p=(e,t,r)=>{if(!e)return t;const n=o(e.semver,t.semver,r);return n>0?e:n<0||">"===t.operator&&">="===e.operator?t:e},g=(e,t,r)=>{if(!e)return t;const n=o(e.semver,t.semver,r);return n<0?e:n>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new n(e,r),t=new n(t,r);let s=!1;e:for(const n of e.set){for(const e of t.set){const t=u(n,e,r);if(s=s||null!==t,t)continue e}if(s)return!1}return!0}},3327:(e,t,r)=>{const n=r(2839);e.exports=(e,t)=>new n(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},130:(e,t,r)=>{const n=r(2839);e.exports=(e,t)=>{try{return new n(e,t).range||"*"}catch(e){return null}}},6089:e=>{"use strict";e.exports=s},7781:t=>{"use strict";t.exports=e},8531:e=>{"use strict";e.exports=t},2007:e=>{"use strict";e.exports=n},3241:e=>{"use strict";e.exports=i},8146:e=>{"use strict";e.exports=a},5959:e=>{"use strict";e.exports=r},1269:e=>{"use strict";e.exports=o},4769:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__addDisposableResource:()=>D,__assign:()=>a,__asyncDelegator:()=>T,__asyncGenerator:()=>j,__asyncValues:()=>P,__await:()=>w,__awaiter:()=>h,__classPrivateFieldGet:()=>R,__classPrivateFieldIn:()=>I,__classPrivateFieldSet:()=>N,__createBinding:()=>m,__decorate:()=>o,__disposeResources:()=>F,__esDecorate:()=>c,__exportStar:()=>v,__extends:()=>s,__generator:()=>f,__importDefault:()=>C,__importStar:()=>k,__makeTemplateObject:()=>_,__metadata:()=>d,__param:()=>l,__propKey:()=>p,__read:()=>O,__rest:()=>i,__runInitializers:()=>u,__setFunctionName:()=>g,__spread:()=>b,__spreadArray:()=>x,__spreadArrays:()=>S,__values:()=>y,default:()=>A});var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)};function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var a=function(){return a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},a.apply(this,arguments)};function i(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r}function o(e,t,r,n){var s,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(i=(a<3?s(i):a>3?s(t,r,i):s(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i}function l(e,t){return function(r,n){t(r,n,e)}}function c(e,t,r,n,s,a){function i(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=n.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?n.static?e:e.prototype:null,p=t||(u?Object.getOwnPropertyDescriptor(u,n.name):{}),g=!1,d=r.length-1;d>=0;d--){var h={};for(var f in n)h[f]="access"===f?{}:n[f];for(var f in n.access)h.access[f]=n.access[f];h.addInitializer=function(e){if(g)throw new TypeError("Cannot add initializers after decoration has completed");a.push(i(e||null))};var m=(0,r[d])("accessor"===l?{get:p.get,set:p.set}:p[c],h);if("accessor"===l){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(o=i(m.get))&&(p.get=o),(o=i(m.set))&&(p.set=o),(o=i(m.init))&&s.unshift(o)}else(o=i(m))&&("field"===l?s.unshift(o):p[c]=o)}u&&Object.defineProperty(u,n.name,p),g=!0}function u(e,t,r){for(var n=arguments.length>2,s=0;s<t.length;s++)r=n?t[s].call(e,r):t[s].call(e);return n?r:void 0}function p(e){return"symbol"==typeof e?e:"".concat(e)}function g(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function d(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function h(e,t,r,n){return new(r||(r=Promise))((function(s,a){function i(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}l((n=n.apply(e,t||[])).next())}))}function f(e,t){var r,n,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=o(0),i.throw=o(1),i.return=o(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(a=0)),a;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}var m=Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function v(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||m(t,e,r)}function y(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function O(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,a=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}return i}function b(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(O(arguments[t]));return e}function S(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),s=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,o=a.length;i<o;i++,s++)n[s]=a[i];return n}function x(e,t,r){if(r||2===arguments.length)for(var n,s=0,a=t.length;s<a;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))}function w(e){return this instanceof w?(this.v=e,this):new w(e)}function j(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,s=r.apply(e,t||[]),a=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),i("next"),i("throw"),i("return",(function(e){return function(t){return Promise.resolve(t).then(e,c)}})),n[Symbol.asyncIterator]=function(){return this},n;function i(e,t){s[e]&&(n[e]=function(t){return new Promise((function(r,n){a.push([e,t,r,n])>1||o(e,t)}))},t&&(n[e]=t(n[e])))}function o(e,t){try{(r=s[e](t)).value instanceof w?Promise.resolve(r.value.v).then(l,c):u(a[0][2],r)}catch(e){u(a[0][3],e)}var r}function l(e){o("next",e)}function c(e){o("throw",e)}function u(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}function T(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,s){t[n]=e[n]?function(t){return(r=!r)?{value:w(e[n](t)),done:!1}:s?s(t):t}:s}}function P(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=y(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,s){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,s,(t=e[r](t)).done,t.value)}))}}}function _(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var E=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(t,e,r);return E(t,e),t}function C(e){return e&&e.__esModule?e:{default:e}}function R(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function N(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r}function I(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function D(e,t,r){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var n,s;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(void 0===n){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],r&&(s=n)}if("function"!=typeof n)throw new TypeError("Object not disposable.");s&&(n=function(){try{s.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}var $="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function F(e){function t(t){e.error=e.hasError?new $(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var r,n=0;return function s(){for(;r=e.stack.pop();)try{if(!r.async&&1===n)return n=0,e.stack.push(r),Promise.resolve().then(s);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(a).then(s,(function(e){return t(e),s()}))}else n|=1}catch(e){t(e)}if(1===n)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}const A={__extends:s,__assign:a,__rest:i,__decorate:o,__param:l,__metadata:d,__awaiter:h,__generator:f,__createBinding:m,__exportStar:v,__values:y,__read:O,__spread:b,__spreadArrays:S,__spreadArray:x,__await:w,__asyncGenerator:j,__asyncDelegator:T,__asyncValues:P,__makeTemplateObject:_,__importStar:k,__importDefault:C,__classPrivateFieldGet:R,__classPrivateFieldSet:N,__classPrivateFieldIn:I,__addDisposableResource:D,__disposeResources:F}}},c={};function u(e){var t=c[e];if(void 0!==t)return t.exports;var r=c[e]={exports:{}};return l[e](r,r.exports,u),r.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var r in t)u.o(t,r)&&!u.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var p={};return(()=>{"use strict";u.r(p),u.d(p,{plugin:()=>cp});var e,t=u(7781),r=u(8531),n=u(9728),s=u(2007),a=u(6089),i=u(5959),o=u.n(i);!function(e){e[e.Error=7e3]="Error",e[e.Info=3e3]="Info",e[e.Success=3e3]="Success",e[e.Warning=5e3]="Warning"}(e||(e={}));const l={error:7e3,info:3e3,success:3e3,warning:5e3},c=e=>{const t=(r=(0,s.useTheme2)(),(0,a.css)({position:"absolute",zIndex:r.zIndex.portal,top:0,right:10}));var r;const[o,c]=(0,i.useState)(!1),[u,p]=(0,i.useState)();return(0,i.useEffect)((()=>()=>{u&&clearTimeout(u)}),[u]),(0,i.useEffect)((()=>{if(""!==e.text){c(!0);const t=setTimeout((()=>{c(!1)}),l[e.severity]);p(t)}}),[e.severity,e.text]),(0,n.jsx)(n.Fragment,{children:o&&(0,n.jsx)(s.Alert,{className:t,elevated:!0,onRemove:()=>c(!1),severity:e.severity,title:e.text})})};var g=u(8146),d=u.n(g);u(9874);let h=null;function f({query:e,lang:r,className:s}){const o=(0,i.useContext)(h||t.ThemeContext),l=m(o),c=d().highlight(e,r.grammar,r.name);return(0,n.jsx)("div",{className:(0,a.cx)(l.editorField,"prism-syntax-highlight",s),"aria-label":"selector",dangerouslySetInnerHTML:{__html:c}})}new WeakMap;const m=e=>({editorField:(0,a.css)({fontFamily:e.typography.fontFamilyMonospace,fontSize:e.typography.bodySmall.fontSize})});var v,y,O;!function(e){e.Done="done",e.Error="error",e.Pending="pending",e.Streaming="streaming"}(v||(v={})),function(e){e.Raw="raw",e.Spans="spans",e.Traces="traces"}(y||(y={})),function(e){e.Intrinsic="intrinsic",e.Resource="resource",e.Span="span",e.Unscoped="unscoped"}(O||(O={}));var b=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;const w=e=>{var t=e,{children:r}=t,n=((e,t)=>{var r={};for(var n in e)S.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&b)for(var n of b(e))t.indexOf(n)<0&&x.call(e,n)&&(r[n]=e[n]);return r})(t,["children"]);const a=(0,s.useStyles2)((0,i.useCallback)((e=>j(e,n)),[n]));return o().createElement("div",{className:a.root},r)},j=(e,t)=>{var r,n,s;return{root:(0,a.css)({display:"flex",flexDirection:null!=(r=t.direction)?r:"row",flexWrap:null==(n=t.wrap)||n?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!=(s=t.gap)?s:2),flexGrow:t.flexGrow})}},T=({children:e})=>{const t=(0,s.useStyles2)(P);return o().createElement("div",{className:t.root},o().createElement(w,{gap:2},e))},P=e=>({root:(0,a.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(1)})}),_=({v:e=0,h:t=0,layout:r="block"})=>{const n=(0,s.useStyles2)((0,i.useCallback)((n=>E(n,{v:e,h:t,layout:r})),[e,t,r]));return o().createElement("span",{className:(0,a.cx)(n.wrapper)})},E=(e,t)=>{var r,n;return{wrapper:(0,a.css)([{paddingRight:e.spacing(null!=(r=t.h)?r:0),paddingBottom:e.spacing(null!=(n=t.v)?n:0)},"inline"===t.layout&&{display:"inline-block"},"block"===t.layout&&{display:"block"}])}};var k=Object.defineProperty,C=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable,I=(e,t,r)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const D=e=>{var t;const r=e,{label:n,optional:a,tooltip:l,tooltipInteractive:c,children:u,width:p}=r,g=((e,t)=>{var r={};for(var n in e)R.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&C)for(var n of C(e))t.indexOf(n)<0&&N.call(e,n)&&(r[n]=e[n]);return r})(r,["label","optional","tooltip","tooltipInteractive","children","width"]),d=(0,s.useStyles2)((0,i.useCallback)((e=>$(e,p)),[p])),h=(null==g?void 0:g.htmlFor)||(null==(t=s.ReactUtils)?void 0:t.getChildId(u)),f=o().createElement(o().Fragment,null,o().createElement("label",{className:d.label,htmlFor:h},n,a&&o().createElement("span",{className:d.optional}," - optional"),l&&o().createElement(s.Tooltip,{placement:"top",content:l,theme:"info",interactive:c},o().createElement(s.Icon,{tabIndex:0,name:"info-circle",size:"sm",className:d.icon}))),o().createElement(_,{v:.5}));return o().createElement("div",{className:d.root},o().createElement(s.Field,((e,t)=>{for(var r in t||(t={}))R.call(t,r)&&I(e,r,t[r]);if(C)for(var r of C(t))N.call(t,r)&&I(e,r,t[r]);return e})({className:d.field,label:f},g),u))},$=(e,t)=>({root:(0,a.css)({minWidth:e.spacing(null!=t?t:0)}),label:(0,a.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium}),optional:(0,a.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,a.css)({marginBottom:0}),icon:(0,a.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})});var F=function(e,t){return"boolean"==typeof t?t:!e};function A({title:e,children:t,collapsedInfo:a,queryStats:o}){const[l,c]=(p=!1,(0,i.useReducer)(F,p)),u=(0,s.useStyles2)(Q);var p;return(0,n.jsxs)("div",{className:u.wrapper,children:[(0,n.jsx)(s.Collapse,{className:u.collapse,collapsible:!0,isOpen:l,onToggle:c,label:(0,n.jsxs)(s.Stack,{gap:0,children:[(0,n.jsx)("h6",{className:u.title,children:e}),!l&&(0,n.jsx)("div",{className:u.description,children:a.map(((e,t)=>(0,n.jsx)("span",{children:e},t)))})]}),children:(0,n.jsx)("div",{className:u.body,children:t})}),o&&r.config.featureToggles.lokiQuerySplitting&&(0,n.jsx)(s.Tooltip,{content:"Note: the query will be split into multiple parts and executed in sequence. Query limits will only apply each individual part.",children:(0,n.jsx)(s.Icon,{tabIndex:0,name:"info-circle",className:u.tooltip,size:"sm"})}),o&&(0,n.jsx)("p",{className:u.stats,children:L(o)})]})}const Q=e=>({collapse:(0,a.css)({backgroundColor:"unset",border:"unset",marginBottom:0,"> button":{padding:e.spacing(0,1)}}),wrapper:(0,a.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,a.css)({flexGrow:1,overflow:"hidden",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,margin:0}),description:(0,a.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.bodySmall.fontWeight,paddingLeft:e.spacing(2),gap:e.spacing(2),display:"flex"}),body:(0,a.css)({display:"flex",gap:e.spacing(2),flexWrap:"wrap"}),stats:(0,a.css)({margin:"0px",color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize}),tooltip:(0,a.css)({marginRight:e.spacing(.25)})}),L=e=>e.message?e.message:`This query will process approximately ${W(e)}.`,W=e=>{const{text:r,suffix:n}=(0,t.getValueFormat)("bytes")(e.bytes,1);return r+n};var z=u(3241),q=u(1269);function M(e){return"function"==typeof e}function V(e){return function(t){if(function(e){return M(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}var U,B=u(4769),G=(U=function(e){(function(e){Error.call(e),e.stack=(new Error).stack})(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e},U.prototype=Object.create(Error.prototype),U.prototype.constructor=U,U);function X(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Y=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,r,n,s;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var i=(0,B.__values)(a),o=i.next();!o.done;o=i.next())o.value.remove(this)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}else a.remove(this);var l=this.initialTeardown;if(M(l))try{l()}catch(e){s=e instanceof G?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=(0,B.__values)(c),p=u.next();!p.done;p=u.next()){var g=p.value;try{H(g)}catch(e){s=null!=s?s:[],e instanceof G?s=(0,B.__spreadArray)((0,B.__spreadArray)([],(0,B.__read)(s)),(0,B.__read)(e.errors)):s.push(e)}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}if(s)throw new G(s)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)H(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&X(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&X(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function J(e){return e instanceof Y||e&&"closed"in e&&M(e.remove)&&M(e.add)&&M(e.unsubscribe)}function H(e){M(e)?e():e.unsubscribe()}Y.EMPTY;var Z={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},K={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var s=K.delegate;return(null==s?void 0:s.setTimeout)?s.setTimeout.apply(s,(0,B.__spreadArray)([e,t],(0,B.__read)(r))):setTimeout.apply(void 0,(0,B.__spreadArray)([e,t],(0,B.__read)(r)))},clearTimeout:function(e){var t=K.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function ee(e){K.setTimeout((function(){var t=Z.onUnhandledError;if(!t)throw e;t(e)}))}function te(){}var re=ne("C",void 0,void 0);function ne(e,t,r){return{kind:e,value:t,error:r}}var se=null,ae=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,J(t)&&t.add(r)):r.destination=ge,r}return(0,B.__extends)(t,e),t.create=function(e,t,r){return new ce(e,t,r)},t.prototype.next=function(e){this.isStopped?pe(function(e){return ne("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?pe(ne("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?pe(re,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Y),ie=Function.prototype.bind;function oe(e,t){return ie.call(e,t)}var le=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){ue(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){ue(e)}else ue(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){ue(e)}},e}(),ce=function(e){function t(t,r,n){var s,a,i=e.call(this)||this;return M(t)||!t?s={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:i&&Z.useDeprecatedNextContext?((a=Object.create(t)).unsubscribe=function(){return i.unsubscribe()},s={next:t.next&&oe(t.next,a),error:t.error&&oe(t.error,a),complete:t.complete&&oe(t.complete,a)}):s=t,i.destination=new le(s),i}return(0,B.__extends)(t,e),t}(ae);function ue(e){var t;Z.useDeprecatedSynchronousErrorHandling?(t=e,Z.useDeprecatedSynchronousErrorHandling&&se&&(se.errorThrown=!0,se.error=t)):ee(e)}function pe(e,t){var r=Z.onStoppedNotification;r&&K.setTimeout((function(){return r(e,t)}))}var ge={closed:!0,next:te,error:function(e){throw e},complete:te};function de(e,t,r,n,s){return new he(e,t,r,n,s)}var he=function(e){function t(t,r,n,s,a,i){var o=e.call(this,t)||this;return o.onFinalize=a,o.shouldUnsubscribe=i,o._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,o._error=s?function(e){try{s(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,o}return(0,B.__extends)(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(ae);function fe(e,t){return V((function(r,n){var s=0;r.subscribe(de(n,(function(r){n.next(e.call(t,r,s++))})))}))}var me=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},ve="function"==typeof Symbol&&Symbol.observable||"@@observable";function ye(e){return e}var Oe=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n,s=this,a=(n=e)&&n instanceof ae||function(e){return e&&M(e.next)&&M(e.error)&&M(e.complete)}(n)&&J(n)?e:new ce(e,t,r);return function(e){if(Z.useDeprecatedSynchronousErrorHandling){var t=!se;if(t&&(se={errorThrown:!1,error:null}),e(),t){var r=se,n=r.errorThrown,s=r.error;if(se=null,n)throw s}}else e()}((function(){var e=s,t=e.operator,r=e.source;a.add(t?t.call(a,r):r?s._subscribe(a):s._trySubscribe(a))})),a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=be(t))((function(t,n){var s=new ce({next:function(t){try{e(t)}catch(e){n(e),s.unsubscribe()}},error:n,complete:t});r.subscribe(s)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[ve]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(r=e).length?ye:1===r.length?r[0]:function(e){return r.reduce((function(e,t){return t(e)}),e)})(this);var r},e.prototype.toPromise=function(e){var t=this;return new(e=be(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}();function be(e){var t;return null!==(t=null!=e?e:Z.Promise)&&void 0!==t?t:Promise}var Se="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function xe(e){if(e instanceof Oe)return e;if(null!=e){if(function(e){return M(e[ve])}(e))return a=e,new Oe((function(e){var t=a[ve]();if(M(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(me(e))return s=e,new Oe((function(e){for(var t=0;t<s.length&&!e.closed;t++)e.next(s[t]);e.complete()}));if(M(null==(n=e)?void 0:n.then))return r=e,new Oe((function(e){r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,ee)}));if(function(e){return Symbol.asyncIterator&&M(null==e?void 0:e[Symbol.asyncIterator])}(e))return we(e);if(function(e){return M(null==e?void 0:e[Se])}(e))return t=e,new Oe((function(e){var r,n;try{for(var s=(0,B.__values)(t),a=s.next();!a.done;a=s.next()){var i=a.value;if(e.next(i),e.closed)return}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}e.complete()}));if(function(e){return M(null==e?void 0:e.getReader)}(e))return we(function(e){return(0,B.__asyncGenerator)(this,arguments,(function(){var t,r,n;return(0,B.__generator)(this,(function(s){switch(s.label){case 0:t=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,(0,B.__await)(t.read())];case 3:return r=s.sent(),n=r.value,r.done?[4,(0,B.__await)(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,(0,B.__await)(n)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}(e))}var t,r,n,s,a;throw function(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}(e)}function we(e){return new Oe((function(t){(function(e,t){var r,n,s,a;return(0,B.__awaiter)(this,void 0,void 0,(function(){var i,o;return(0,B.__generator)(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),r=(0,B.__asyncValues)(e),l.label=1;case 1:return[4,r.next()];case 2:if((n=l.sent()).done)return[3,4];if(i=n.value,t.next(i),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=l.sent(),s={error:o},[3,11];case 6:return l.trys.push([6,,9,10]),n&&!n.done&&(a=r.return)?[4,a.call(r)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function je(e){return V((function(t,r){var n,s=null,a=!1;s=t.subscribe(de(r,void 0,void 0,(function(i){n=xe(e(i,je(e)(t))),s?(s.unsubscribe(),s=null,n.subscribe(r)):a=!0}))),a&&(s.unsubscribe(),s=null,n.subscribe(r))}))}function Te(e,t,r){return void 0===r&&(r=1/0),M(t)?Te((function(r,n){return fe((function(e,s){return t(r,e,n,s)}))(xe(e(r,n)))}),r):("number"==typeof t&&(r=t),V((function(t,n){return function(e,t,r,n,s,a,i,o){var l=[],c=0,u=0,p=!1,g=function(){!p||l.length||c||t.complete()},d=function(e){return c<n?h(e):l.push(e)},h=function(e){c++;var s=!1;xe(r(e,u++)).subscribe(de(t,(function(e){t.next(e)}),(function(){s=!0}),void 0,(function(){if(s)try{c--;for(var e=function(){var e=l.shift();h(e)};l.length&&c<n;)e();g()}catch(e){t.error(e)}})))};return e.subscribe(de(t,d,(function(){p=!0,g()}))),function(){}}(t,n,e,r)})))}function Pe(e,t){return M(t)?Te(e,t,1):Te(e,1)}var _e=function(e,t){return e.push(t),e};function Ee(){return V((function(e,t){(function(e,t){return V(function(e,t,r,n,s){return function(n,s){var a=r,i=t,o=0;n.subscribe(de(s,(function(t){var r=o++;i=a?e(i,t,r):(a=!0,t)}),(function(){a&&s.next(i),s.complete()})))}}(e,t,arguments.length>=2))})(_e,[])(e).subscribe(t)}))}var ke,Ce,Re,Ne,Ie,De,$e,Fe,Ae,Qe,Le,We,ze,qe,Me,Ve,Ue,Be,Ge,Xe,Ye,Je,He,Ze,Ke,et,tt,rt,nt,st,at,it,ot,lt,ct,ut,pt,gt,dt,ht,ft,mt=u(709),vt=u.n(mt);!function(e){e.AlertStates="alertStates",e.Annotations="annotations",e.Series="series"}(ke||(ke={})),function(e){e.Linear="linear",e.Quad="quad"}(Ce||(Ce={})),function(e){e.Clamped="clamped",e.Mod="mod"}(Re||(Re={})),function(e){e.Field="field",e.Fixed="fixed",e.Template="template"}(Ne||(Ne={})),function(e){e.Field="field",e.Fixed="fixed",e.Mapping="mapping"}(Ie||(Ie={})),function(e){e.Auto="auto",e.Coords="coords",e.Geohash="geohash",e.Lookup="lookup"}(De||(De={})),function(e){e.Count="count",e.Size="size"}($e||($e={})),function(e){e.auto="auto",e.ge="ge",e.le="le",e.unknown="unknown"}(Fe||(Fe={})),function(e){e.Ascending="Ascending",e.Descending="Descending"}(Ae||(Ae={})),function(e){e.Auto="auto",e.Bottom="bottom",e.Hidden="hidden",e.Left="left",e.Right="right",e.Top="top"}(Qe||(Qe={})),function(e){e.Series="series",e.Text="text"}(Le||(Le={})),function(e){e.Always="always",e.Auto="auto",e.Never="never"}(We||(We={})),function(e){e.Bars="bars",e.Line="line",e.Points="points"}(ze||(ze={})),function(e){e.Constant="constant",e.NegativeY="negative-Y"}(qe||(qe={})),function(e){e.Linear="linear",e.Smooth="smooth",e.StepAfter="stepAfter",e.StepBefore="stepBefore"}(Me||(Me={})),function(e){e.Linear="linear",e.Log="log",e.Ordinal="ordinal",e.Symlog="symlog"}(Ve||(Ve={})),function(e){e.Hue="hue",e.None="none",e.Opacity="opacity",e.Scheme="scheme"}(Ue||(Ue={})),function(e){e.None="none",e.Normal="normal",e.Percent="percent"}(Be||(Be={})),function(e){e[e.After=1]="After",e[e.Before=-1]="Before",e[e.Center=0]="Center"}(Ge||(Ge={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical"}(Xe||(Xe={})),function(e){e[e.Down=-1]="Down",e[e.Left=-1]="Left",e[e.Right=1]="Right",e[e.Up=1]="Up"}(Ye||(Ye={})),function(e){e.Area="area",e.Dashed="dashed",e.DashedAndArea="dashed+area",e.Line="line",e.LineAndArea="line+area",e.Off="off",e.Series="series"}(Je||(Je={})),function(e){e.Hidden="hidden",e.List="list",e.Table="table"}(He||(He={})),function(e){e.Auto="auto",e.Horizontal="horizontal",e.Vertical="vertical"}(Ze||(Ze={})),function(e){e.Background="background",e.BackgroundSolid="background_solid",e.None="none",e.Value="value"}(Ke||(Ke={})),function(e){e.Area="area",e.Line="line",e.None="none"}(et||(et={})),function(e){e.Auto="auto",e.Center="center"}(tt||(tt={})),function(e){e.Auto="auto",e.Name="name",e.None="none",e.Value="value",e.ValueAndName="value_and_name"}(rt||(rt={})),function(e){e.Inverted="inverted",e.SameAsValue="same_as_value",e.Standard="standard"}(nt||(nt={})),function(e){e.Multi="multi",e.None="none",e.Single="single"}(st||(st={})),function(e){e.Ascending="asc",e.Descending="desc",e.None="none"}(at||(at={})),function(e){e.Basic="basic",e.Gradient="gradient",e.Lcd="lcd"}(it||(it={})),function(e){e.Color="color",e.Hidden="hidden",e.Text="text"}(ot||(ot={})),function(e){e.Auto="auto",e.Hidden="hidden",e.Left="left",e.Top="top"}(lt||(lt={})),function(e){e.Auto="auto",e.Manual="manual"}(ct||(ct={})),function(e){e.Auto="auto",e.BasicGauge="basic",e.ColorBackground="color-background",e.ColorBackgroundSolid="color-background-solid",e.ColorText="color-text",e.Custom="custom",e.DataLinks="data-links",e.Gauge="gauge",e.GradientGauge="gradient-gauge",e.Image="image",e.JSONView="json-view",e.LcdGauge="lcd-gauge",e.Sparkline="sparkline"}(ut||(ut={})),function(e){e.Basic="basic",e.Gradient="gradient"}(pt||(pt={})),function(e){e.Auto="auto",e.Lg="lg",e.Md="md",e.Sm="sm"}(gt||(gt={})),function(e){e.CSV="csv",e.Date="date",e.Distributed="distributed",e.DoubleQuote="doublequote",e.Glob="glob",e.HTML="html",e.JSON="json",e.Lucene="lucene",e.PercentEncode="percentencode",e.Pipe="pipe",e.QueryParam="queryparam",e.Raw="raw",e.Regex="regex",e.SQLString="sqlstring",e.SingleQuote="singlequote",e.Text="text",e.UriEncode="uriencode"}(dt||(dt={})),function(e){e.exact="exact",e.none="none",e.numbers="numbers",e.signature="signature"}(ht||(ht={})),function(e){e.EQ="eq",e.GT="gt",e.GTE="gte",e.LT="lt",e.LTE="lte",e.NEQ="neq"}(ft||(ft={}));const yt=["=","!=",">","<",">=","<=","=~","!~"],Ot=["=","!="],bt=["=","!=","=~","!~"],St=["=","!=",">","<",">=","<="],xt=["duration","kind","name","rootName","rootServiceName","status","statusMessage","traceDuration"],wt=["resource","span"],jt=["avg","count","max","min","sum"].concat(["by","count_over_time","histogram_over_time","quantile_over_time","rate","select"]),Tt=xt.concat(wt),Pt={id:"traceql",extensions:[".traceql"],aliases:["tempo","traceql"],mimetypes:[],def:{language:{ignoreCase:!1,defaultToken:"",tokenPostfix:".traceql",keywords:Tt,operators:yt,statusValues:["ok","unset","error","false","true"],functions:jt,symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,tokenizer:{root:[[/\/\/.*/,"comment"],[/\/\*.*\*\//,"comment"],[/[0-9]+(.[0-9]+)?(us|µs|ns|ms|s|m|h)/,"number"],[/^\s*[0-9A-Fa-f]+\s*$/,"tag"],[`(?:${Tt.join("|")})`,{cases:{"@keywords":"keyword","@default":"tag"}}],[/(?:\w|^[^{}()=~!<>&|," ]|"(?:\\"|\\\\|[^\\"])*")+/,{cases:{"@functions":"predefined","@statusValues":"type","@default":"tag"}}],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/([^\w])(")/,[{token:""},{token:"string",next:"@string_double"}]],[/([^\w])(')/,[{token:""},{token:"string",next:"@string_single"}]],[/([^\w])(`)/,[{token:""},{token:"string",next:"@string_back"}]],[/[{}()\[\]]/,"delimiter.bracket"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?[fFdD]?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?[fFdD]?/,"number.float"],[/0(@octaldigits)[Ll]?/,"number.octal"],[/0[bB](@binarydigits)[Ll]?/,"number.binary"],[/(@digits)[fFdD]/,"number.float"],[/(@digits)[lL]?/,"number"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],string_back:[[/[^\\`]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/`/,"string","@pop"]]}},languageConfiguration:{wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g,brackets:[["{","}"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],folding:{}}}},_t={comment:{pattern:/\/\/.*/},"span-set":{pattern:/\{[^}]*}/,inside:{filter:{pattern:/([\w.\/-]+)?(\s*)(([!=+\-<>~]+)\s*("([^"\n&]+)?"?|([^"\n\s&|}]+))?)/g,inside:{comment:{pattern:/#.*/},"label-key":{pattern:/[a-z_.][\w./_-]*(?=\s*(=|!=|>|<|>=|<=|=~|!~))/,alias:"attr-name"},"label-value":{pattern:/("(?:\\.|[^\\"])*")|(\w+)/,alias:"attr-value"}}},punctuation:/[}{&|]/}},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,operator:new RegExp("/[-+*/=%^~]|&&?|\\|?\\||!=?|<(?:=>?|<|>)?|>[>=]?|","i"),punctuation:/[{};()`,.]/};function Et(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const kt=(e,t)=>e.map((e=>{var n;const s=(a=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Et(e,t,r[t])}))}return e}({},e),i=null!=(i={tag:(0,r.getTemplateSrv)().replace(null!==(n=e.tag)&&void 0!==n?n:"",null!=t?t:{})})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(i)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(i,e))})),a);var a,i,o;return e.value&&(s.value="string"==typeof e.value?(0,r.getTemplateSrv)().replace(null!==(o=e.value)&&void 0!==o?o:"",null!=t?t:{},dt.Pipe):e.value.map((e=>(0,r.getTemplateSrv)().replace(null!=e?e:"",null!=t?t:{},dt.Pipe)))),s})),Ct=e=>e?`{${e.filter((e=>{var t;return e.tag&&e.operator&&(null===(t=e.value)||void 0===t?void 0:t.length)})).map((t=>`${Nt(t)}${It(t,e)}${t.operator}${Rt(t)}`)).join(" && ")}}`:"",Rt=e=>Array.isArray(e.value)&&e.value.length>1?`"${e.value.join("|")}"`:"string"===e.valueType?`"${e.value}"`:e.value,Nt=e=>{var t;return xt.find((t=>t===e.tag))?"":(e.scope===O.Resource||e.scope===O.Span?null===(t=e.scope)||void 0===t?void 0:t.toLowerCase():"")+"."},It=(e,t)=>{if("duration"===e.tag){const r=t.find((e=>"duration-type"===e.id));return r?"trace"===r.value?"traceDuration":"duration":e.tag}return e.tag},Dt=e=>Nt(e)+e.tag,$t=e=>"name"===e.tag?"Span Name":"service.name"===e.tag&&e.scope===O.Resource?"Service Name":(0,z.startCase)(Dt(e)),Ft=e=>(0,z.uniq)(e.map((e=>e.name&&"intrinsic"!==e.name&&e.tags?e.tags:[])).flat()),At=(e,t)=>(0,z.uniq)(e.map((e=>e.name&&e.name===t&&e.tags?e.tags:[])).flat());function Qt(e,t,r){const n=e.slice(0);return n[t]=r,n}const Lt=e=>{const t={label:e,value:e};switch(e){case"=":t.description="Equals";break;case"!=":t.description="Not equals";break;case">":t.description="Greater";break;case">=":t.description="Greater or Equal";break;case"<":t.description="Less";break;case"<=":t.description="Less or Equal";break;case"=~":t.description="Matches regex";break;case"!~":t.description="Does not match regex"}return t};var Wt=u(1777);function zt(e,t,r,n,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,s)}function qt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){qt(e,t,r[t])}))}return e}function Vt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Ut=()=>({dropdown:(0,a.css)({boxShadow:"none"})}),Bt=e=>[...e||[],...(0,r.getTemplateSrv)().getVariables().map((e=>({label:`$${e.name}`,value:`$${e.name}`})))],Gt=1e3,Xt=({filter:e,datasource:t,updateFilter:a,isTagsLoading:o,tags:l,setError:u,hideScope:p,hideTag:g,hideValue:d,query:h,addVariablesToOptions:f,isMulti:m=!0,allowCustomValue:v=!0})=>{var y;const b=(0,s.useStyles2)(Ut),[S,x]=(0,i.useState)(),w=(0,i.useMemo)((()=>Dt(e)),[e]),[j,T]=(0,i.useState)(e.operator),[P,_]=(0,i.useState)(e.value),[E,k]=(0,i.useState)(""),[C,R]=(0,i.useState)(""),N=(I=function*(){try{const r=e.tag?yield t.languageProvider.getOptionsV2(w,h):[];return x(void 0),u(null),r}catch(e){(0,r.isFetchError)(e)&&404===(null==e?void 0:e.status)?u(e):e instanceof Error&&x(`Error: ${e.message}`)}return[]},D=function(){var e=this,t=arguments;return new Promise((function(r,n){var s=I.apply(e,t);function a(e){zt(s,r,n,a,i,"next",e)}function i(e){zt(s,r,n,a,i,"throw",e)}a(void 0)}))},function(){return D.apply(this,arguments)});var I,D;const{loading:$,value:F}=(0,Wt.A)(N,[w,t.languageProvider,u,h]);e.value&&!Array.isArray(e.value)&&F&&!F.find((t=>t.value===e.value))&&F.push({label:e.value.toString(),value:e.value.toString(),type:e.valueType}),(0,i.useEffect)((()=>{Array.isArray(e.value)&&e.value.length>1&&"=~"!==e.operator&&"!~"!==e.operator&&(T(e.operator),a(Vt(Mt({},e),{operator:"=~"}))),Array.isArray(e.value)&&e.value.length<=1&&((null==P?void 0:P.length)||0)>1&&a(Vt(Mt({},e),{operator:j,value:e.value[0]}))}),[P,j,a,e]),(0,i.useEffect)((()=>{_(e.value)}),[e.value]);const A=Object.values(O).filter((e=>e!==O.Intrinsic)).map((e=>({label:e,value:e}))),Q=null==F?void 0:F.filter((e=>{var t;return e.type===(null===(t=F[0])||void 0===t?void 0:t.type)})),L=(null==F?void 0:F.length)===(null==Q?void 0:Q.length)?null==F||null===(y=F[0])||void 0===y?void 0:y.type:void 0;let W=yt;switch(L){case"keyword":W=Ot;break;case"string":W=bt;break;case"int":case"float":W=St}const q=W.map(Lt),M=(e,t)=>(void 0!==t?(0,z.uniq)([t,...e]):e).map((e=>({label:e,value:e}))),V=(0,i.useMemo)((()=>{if(0===E.length)return M(l.slice(0,Gt),e.tag);const t=E.toLowerCase(),r=l.filter((e=>e.toLowerCase().includes(t))).slice(0,Gt);return M(r,e.tag)}),[e.tag,E,l]),U=(0,i.useMemo)((()=>{if(!F)return;if(0===C.length)return F.slice(0,Gt);const e=C.toLowerCase();return F.filter((t=>!!(t.value&&t.value.length>0)&&t.value.toLowerCase().includes(e))).slice(0,Gt)}),[C,F]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(s.HorizontalGroup,{spacing:"none",width:"auto",children:[!p&&(0,n.jsx)(s.Select,{className:b.dropdown,inputId:`${e.id}-scope`,options:f?Bt(A):A,value:e.scope,onChange:t=>a(Vt(Mt({},e),{scope:null==t?void 0:t.value})),placeholder:"Select scope","aria-label":`select ${e.id} scope`}),!g&&(0,n.jsx)(s.Select,{className:b.dropdown,inputId:`${e.id}-tag`,isLoading:o,options:f?Bt(V):V,onInputChange:(e,{action:t})=>{"input-change"===t&&k(e)},onCloseMenu:()=>k(""),onChange:t=>a(Vt(Mt({},e),{tag:null==t?void 0:t.value,value:[]})),value:e.tag,placeholder:"Select tag",isClearable:!0,"aria-label":`select ${e.id} tag`,allowCustomValue:!0,virtualized:!0}),(0,n.jsx)(s.Select,{className:b.dropdown,inputId:`${e.id}-operator`,options:f?Bt(q):q,value:e.operator,onChange:t=>a(Vt(Mt({},e),{operator:null==t?void 0:t.value})),isClearable:!1,"aria-label":`select ${e.id} operator`,allowCustomValue:!0,width:8}),!d&&(0,n.jsx)(s.Select,{virtualized:!0,className:b.dropdown,inputId:`${e.id}-value`,isLoading:$,options:f?Bt(U):U,value:e.value,onInputChange:(e,{action:t})=>{"input-change"===t&&R(e)},onCloseMenu:()=>R(""),onChange:t=>{var r;Array.isArray(t)?a(Vt(Mt({},e),{value:t.map((e=>e.value)),valueType:(null===(r=t[0])||void 0===r?void 0:r.type)||L})):a(Vt(Mt({},e),{value:null==t?void 0:t.value,valueType:(null==t?void 0:t.type)||L}))},placeholder:"Select value",isClearable:!0,"aria-label":`select ${e.id} value`,allowCustomValue:v,isMulti:m,allowCreateWhileLoading:!0})]}),S&&(0,n.jsx)(c,{severity:"error",text:S})]})};var Yt;!function(e){e[e.LabelNames=0]="LabelNames",e[e.LabelValues=1]="LabelValues"}(Yt||(Yt={}));const Jt=[{label:"Label names",value:0},{label:"Label values",value:1}],Ht="TempoDatasourceVariableQueryEditor-VariableQuery",Zt=({onChange:e,query:t,datasource:r})=>{const[a,o]=(0,i.useState)(t.label||""),[l,c]=(0,i.useState)(t.type),[u,p]=(0,i.useState)([]),[g,d]=(0,i.useState)("");(0,i.useEffect)((()=>{1===l&&r.labelNamesQuery().then((e=>{p(e.map((({text:e})=>({label:e,value:e}))))}))}),[r,t,l]);const h=(0,i.useMemo)((()=>{if(0===g.length)return u.slice(0,Gt);const e=g.toLowerCase();return u.filter((t=>!!(t.value&&t.value.length>0)&&t.value.toLowerCase().includes(e))).slice(0,Gt)}),[g,u]),f=()=>{void 0!==l&&e({type:l,label:a,refId:Ht})};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{label:"Query type",labelWidth:20,children:(0,n.jsx)(s.Select,{"aria-label":"Query type",onChange:t=>{c(t.value),void 0!==t.value&&e({type:t.value,label:a,refId:Ht})},onBlur:f,value:l,options:Jt,width:32})})}),1===l&&(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{label:"Label",labelWidth:20,children:(0,n.jsx)(s.Select,{"aria-label":"Label",onChange:t=>{const r=t.value||"";o(r),void 0!==l&&e({type:l,label:r,refId:Ht})},onBlur:f,onInputChange:(e,{action:t})=>{"input-change"===t&&d(e)},onCloseMenu:()=>d(""),value:{label:a,value:a},options:h,width:32,allowCustomValue:!0,virtualized:!0})})})]})};function Kt(e,t,r){return{main:`${er(e)}ms (${er(e/t*100)}%)`,secondary:`${er(r)}ms (${er(r/e*100)}%)`}}function er(e){return parseFloat(e.toFixed(2))}function tr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){tr(e,t,r[t])}))}return e}function nr(e){const{nodes:r,edges:n}=function(e){const r=[],n=[],s=new t.DataFrameView(e),a=function(e){let t=0,r=1/0;for(let n=0;n<e.length;n++){const s=e.get(n);s.startTime<r&&(r=s.startTime),s.startTime+s.duration>t&&(t=s.startTime+s.duration)}return t-r}(s),i=function(e){const t={};let r;for(let n=0;r=e(n),r;n++){t[r.id]?t[r.id].span=r.span:t[r.id]={span:r.span,children:[]};for(const e of r.parentIds)e&&(t[e]?t[e].children.push(r.id):t[e]={span:void 0,children:[r.id]})}return t}((t=>{if(t>=e.length)return;const r=s.get(t);return{span:rr({},r),id:r.spanID,parentIds:r.parentSpanID?[r.parentSpanID]:[]}}));for(let e=0;e<s.length;e++){const c=s.get(e),u=((l=i[c.spanID].children.map((e=>{const t=i[e].span;return[t.startTime,t.startTime+t.duration]}))).sort(((e,t)=>e[0]-t[0])),l.reduce(((e,t)=>{if(!e.length)return[t];const r=e.slice(-1)[0],[n,s]=r,[a,i]=t;return i<s?e:a>s?[...e,t]:[...e.slice(0,-1),[n,i]]}),[]).reduce(((e,t)=>e+(t[1]-t[0])),0)),p=c.duration-u,g=Kt(c.duration,a,p);var o;r.push({[t.NodeGraphDataFrameFieldNames.id]:c.spanID,[t.NodeGraphDataFrameFieldNames.title]:null!==(o=c.serviceName)&&void 0!==o?o:"",[t.NodeGraphDataFrameFieldNames.subTitle]:c.operationName,[t.NodeGraphDataFrameFieldNames.mainStat]:g.main,[t.NodeGraphDataFrameFieldNames.secondaryStat]:g.secondary,[t.NodeGraphDataFrameFieldNames.color]:p/a}),c.parentSpanID&&i[c.parentSpanID].span&&n.push({[t.NodeGraphDataFrameFieldNames.id]:c.parentSpanID+"--"+c.spanID,[t.NodeGraphDataFrameFieldNames.target]:c.spanID,[t.NodeGraphDataFrameFieldNames.source]:c.parentSpanID})}var l;return{nodes:r,edges:n}}(e),[s,a]=[new t.MutableDataFrame({fields:[{name:t.NodeGraphDataFrameFieldNames.id,type:t.FieldType.string},{name:t.NodeGraphDataFrameFieldNames.title,type:t.FieldType.string},{name:t.NodeGraphDataFrameFieldNames.subTitle,type:t.FieldType.string},{name:t.NodeGraphDataFrameFieldNames.mainStat,type:t.FieldType.string,config:{displayName:"Total time (% of trace)"}},{name:t.NodeGraphDataFrameFieldNames.secondaryStat,type:t.FieldType.string,config:{displayName:"Self time (% of total)"}},{name:t.NodeGraphDataFrameFieldNames.color,type:t.FieldType.number,config:{color:{mode:"continuous-GrYlRd"},displayName:"Self time / Trace duration"}}],meta:{preferredVisualisationType:"nodeGraph"}}),new t.MutableDataFrame({fields:[{name:t.NodeGraphDataFrameFieldNames.id,type:t.FieldType.string},{name:t.NodeGraphDataFrameFieldNames.target,type:t.FieldType.string},{name:t.NodeGraphDataFrameFieldNames.source,type:t.FieldType.string}],meta:{preferredVisualisationType:"nodeGraph"}})];for(const e of r)s.add(e);for(const e of n)a.add(e);return[s,a]}const sr="traces_service_graph_request_server_seconds_sum",ar="traces_service_graph_request_total",ir="traces_service_graph_request_failed_total",or="traces_service_graph_request_server_seconds_bucket",lr={expr:"sum(rate(traces_spanmetrics_calls_total{}[$__range])) by (span_name)",topk:5,params:[]},cr={expr:"sum(rate(traces_spanmetrics_calls_total{}[$__range])) by (span_name)",topk:5,params:['status_code="STATUS_CODE_ERROR"']},ur={expr:"histogram_quantile(.9, sum(rate(traces_spanmetrics_latency_bucket{}[$__range])) by (le))",params:[]},pr='span_kind="SPAN_KIND_SERVER"',gr=[sr,ar,ir,or];var dr;function hr(e,t,r,n,s){if(!e)return;const a=`Value #${r}`;for(let r=0;r<e.length;r++){const i=e.get(r),o=i.server_service_namespace?`${i.server_service_namespace}/${i.server}`:i.server,l=i.client_service_namespace?`${i.client_service_namespace}/${i.client}`:i.client,c=`${l}_${o}`;s[c]?s[c][t]=(s[c][t]||0)+i[a]:s[c]={target:o,targetName:i.server,targetNamespace:i.server_service_namespace,source:l,sourceName:i.client,sourceNamespace:i.client_service_namespace,[t]:i[a]},n[o]?n[o][t]=(n[o][t]||0)+i[a]:n[o]={name:i.server,namespace:i.server_service_namespace,[t]:i[a]},n[l]||(n[l]={name:i.client,namespace:i.client_service_namespace,[t]:0})}}function fr(e,t,r,n,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,s)}function mr(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function i(e){fr(a,n,s,i,o,"next",e)}function o(e){fr(a,n,s,i,o,"throw",e)}i(void 0)}))}}function vr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e){e.sourceName="sourceName",e.sourceNamespace="sourceNamespace",e.targetName="targetName",e.targetNamespace="targetNamespace"}(dr||(dr={}));class yr extends t.LanguageProvider{fetchTags(){var e=this;return mr((function*(){let t,r;try{r=yield e.request("/api/v2/search/tags",[])}catch(r){t=yield e.request("/api/search/tags",[])}r&&r.scopes?e.setV2Tags(r.scopes):t&&e.setV1Tags(t.tagNames)}))()}getOptionsV1(e){var t=this;return mr((function*(){const r=t.encodeTag(e),n=yield t.request(`/api/search/tag/${r}/values`);let s=[];return n&&n.tagValues&&(s=n.tagValues.map((e=>({value:e,label:e})))),s}))()}getOptionsV2(e,t){var n=this;return mr((function*(){const s=n.encodeTag(e),a=yield n.request(`/api/v2/search/tag/${s}/values`,t?{q:(0,r.getTemplateSrv)().replace(t,{},dt.Pipe)}:{});let i=[];return a&&a.tagValues&&a.tagValues.forEach((e=>{e.value&&i.push({type:e.type,value:e.value,label:e.value})})),i}))()}constructor(e,t){super(),vr(this,"datasource",void 0),vr(this,"tagsV1",void 0),vr(this,"tagsV2",void 0);var r,n=this;vr(this,"request",(r=mr((function*(e,t={}){const r=yield n.datasource.metadataRequest(e,t);return null==r?void 0:r.data})),function(e){return r.apply(this,arguments)}));var s=this;vr(this,"start",mr((function*(){return s.startTask||(s.startTask=s.fetchTags().then((()=>[]))),s.startTask}))),vr(this,"setV1Tags",(e=>{this.tagsV1=e})),vr(this,"setV2Tags",(e=>{this.tagsV2=e})),vr(this,"getTags",(e=>this.tagsV2&&e?e===O.Unscoped?Ft(this.tagsV2):At(this.tagsV2,e):this.tagsV1?(this.tagsV1.find((e=>"status"===e))||this.tagsV1.push("status"),this.tagsV1):[])),vr(this,"getMetricsSummaryTags",(e=>this.tagsV2&&e?e===O.Unscoped?Ft(this.tagsV2):At(this.tagsV2,e):this.tagsV1?this.tagsV1:[])),vr(this,"getTraceqlAutocompleteTags",(e=>this.tagsV2?e?e===O.Unscoped?Ft(this.tagsV2):At(this.tagsV2,e):Ft(this.tagsV2):this.tagsV1?(this.tagsV1.find((e=>"status"===e))||this.tagsV1.push("status"),this.tagsV1):[])),vr(this,"getAutocompleteTags",(()=>this.tagsV2?(e=>(0,z.uniq)(e.map((e=>e.tags?e.tags:[])).flat()))(this.tagsV2):this.tagsV1?(this.tagsV1.find((e=>"status.code"===e))||this.tagsV1.push("status.code"),this.tagsV1):[])),vr(this,"encodeTag",(e=>encodeURIComponent(encodeURIComponent(e)))),this.datasource=e,Object.assign(this,t)}}function Or(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function br(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Or(e,t,r[t])}))}return e}function Sr(e,r,n){let s;if(!e.length)return Cr;const a={};e.forEach((e=>{const s=wr(e.series,r);e.series.forEach((e=>{a[e.key]={name:`${e.key}`,type:t.FieldType.string,config:jr(e,s,n),values:[]}}))})),s=(0,t.createDataFrame)({name:"Metrics Summary",refId:"metrics-summary",fields:[...Object.values(a).sort(((e,t)=>e.name.localeCompare(t.name))),{name:"spanCount",type:t.FieldType.number,config:{displayNameFromDS:"Span count",custom:{width:150}}},{name:"errorPercentage",type:t.FieldType.number,config:{displayNameFromDS:"Error",unit:"percent",custom:{width:150}}},Er("p50"),Er("p90"),Er("p95"),Er("p99")],meta:{preferredVisualisationType:"table"}});const i=e.map(xr);s.length=i.length;for(const e of i)for(const t of s.fields)t.values.push(e[t.name]);return s=(0,t.sortDataFrame)(s,0),[s]}const xr=e=>{const t=e.errorSpanCount?kr(e.errorSpanCount)/kr(e.spanCount)*100:"0%",r={spanCount:kr(e.spanCount),errorPercentage:t,p50:kr(e.p50),p90:kr(e.p90),p95:kr(e.p95),p99:kr(e.p99)};return e.series.forEach((e=>{r[`${e.key}`]=Tr(e)||""})),r},wr=(e,t)=>{const r=e.map((e=>{const t=3===e.value.type||4===e.value.type,r=8===e.value.type||9===e.value.type,n=t||r?"":'"';return`${e.key}=${n}\${__data.fields["`+e.key+'"]}'+`${n}`}));let n="";const s=t.indexOf("}");if(-1!==s){const e=t.substring(s+1);n=t.substring(0,s),r.length>0&&(n+=t.replace(/\s/g,"").includes("{}")?"":" && ",n+=`${r.join(" && ")}`,n+="}"),n+=`${e}`}else n=`{${r.join(" && ")}} | ${t}`;return n},jr=(e,t,r)=>{const n={displayNameFromDS:e.key,noValue:"<no value>",links:[{title:"Query in explore",url:"",internal:{datasourceUid:r.uid,datasourceName:r.name,query:{query:t,queryType:"traceql"}}}]};return 7===e.value.type?(s=br({},n),a=null!=(a={unit:"ns"})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(a)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(a)).forEach((function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(a,e))})),s):br({},n);var s,a},Tr=e=>{if(!e.value.type)return"";switch(e.value.type){case 3:return e.value.n;case 4:return e.value.f;case 5:return e.value.s;case 6:return e.value.b;case 7:return e.value.d;case 8:return Pr(e.value.status);case 9:return _r(e.value.kind);default:return""}},Pr=e=>{if(!e)return"";switch(e){case 0:return"error";case 1:return"ok";default:return"unset"}},_r=e=>{if(!e)return"";switch(e){case 1:return"internal";case 2:return"client";case 3:return"server";case 4:return"producer";case 5:return"consumer";default:return"unspecified"}},Er=e=>({name:e,type:t.FieldType.number,config:{displayNameFromDS:e,unit:"ns",custom:{width:150}}}),kr=e=>{const t=parseInt(e,10);return isNaN(t)?0:t},Cr=new t.MutableDataFrame({name:"Metrics Summary",refId:"metrics-summary",fields:[],meta:{preferredVisualisationType:"table"}});function Rr(e){for(var t={},r=e.length,n=0;n<r;n++){var s=e[n];s&&(t[String(s).toUpperCase().replace(/[-.]/g,"_")]=s)}return t}var Nr=Rr(["cloud.provider","cloud.account.id","cloud.region","cloud.availability_zone","cloud.platform","aws.ecs.container.arn","aws.ecs.cluster.arn","aws.ecs.launchtype","aws.ecs.task.arn","aws.ecs.task.family","aws.ecs.task.revision","aws.eks.cluster.arn","aws.log.group.names","aws.log.group.arns","aws.log.stream.names","aws.log.stream.arns","container.name","container.id","container.runtime","container.image.name","container.image.tag","deployment.environment","device.id","device.model.identifier","device.model.name","faas.name","faas.id","faas.version","faas.instance","faas.max_memory","host.id","host.name","host.type","host.arch","host.image.name","host.image.id","host.image.version","k8s.cluster.name","k8s.node.name","k8s.node.uid","k8s.namespace.name","k8s.pod.uid","k8s.pod.name","k8s.container.name","k8s.replicaset.uid","k8s.replicaset.name","k8s.deployment.uid","k8s.deployment.name","k8s.statefulset.uid","k8s.statefulset.name","k8s.daemonset.uid","k8s.daemonset.name","k8s.job.uid","k8s.job.name","k8s.cronjob.uid","k8s.cronjob.name","os.type","os.description","os.name","os.version","process.pid","process.executable.name","process.executable.path","process.command","process.command_line","process.command_args","process.owner","process.runtime.name","process.runtime.version","process.runtime.description","service.name","service.namespace","service.instance.id","service.version","telemetry.sdk.name","telemetry.sdk.language","telemetry.sdk.version","telemetry.auto.version","webengine.name","webengine.version","webengine.description"]);function Ir(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Dr(e){if(e.stringValue)return e.stringValue;if(void 0!==e.boolValue)return Boolean(e.boolValue);if(void 0!==e.intValue)return Number.parseInt(String(e.intValue),10);if(e.doubleValue)return Number.parseFloat(String(e.doubleValue));if(e.arrayValue){const t=[];for(const r of e.arrayValue.values)t.push(Dr(r));return t}return""}function $r(e){const t=[];let r="OTLPResourceNoServiceName";if(!e)return{serviceName:r,serviceTags:t};for(const n of e.attributes)n.key===Nr.SERVICE_NAME&&(r=n.value.stringValue||r),t.push({key:n.key,value:Dr(n.value)});return{serviceName:r,serviceTags:t}}function Fr(e){const t=[];if(e.attributes)for(const r of e.attributes)t.push({key:r.key,value:Dr(r.value)});return t}function Ar(e){let t;if(e.kind){const r=e.kind.toString().toLowerCase().split("_");t=r.length?r[r.length-1]:e.kind.toString()}return t}function Qr(e){const t=[];if(e.links)for(const r of e.links){const{traceId:e,spanId:n}=r,s=[];if(r.attributes)for(const e of r.attributes)s.push({key:e.key,value:Dr(e.value)});t.push({traceID:e,spanID:n,tags:s})}return t}function Lr(e){const t=[];if(e.events)for(const r of e.events){const e=[];if(r.attributes)for(const t of r.attributes)e.push({key:t.key,value:Dr(t.value)});t.push({fields:e,timestamp:r.timeUnixNano/1e6,name:r.name})}return t}function Wr(e,n,s=!1){const a=e.data[0];if(!a)return Br;const i=null==n?void 0:n.jsonData,o=null==i?void 0:i.tracesToProfiles;let l;if((null==o?void 0:o.datasourceUid)&&(l=(0,r.getDataSourceSrv)().getInstanceSettings(o.datasourceUid)),o&&l){const e=o.customQuery?o.query:void 0;var c;const r={title:"Related profiles",url:"",internal:{datasourceUid:l.uid,datasourceName:l.name,query:{labelSelector:e||"{${__tags}}",groupBy:[],profileTypeId:null!==(c=o.profileTypeId)&&void 0!==c?c:"",queryType:"profile",spanSelector:['${__span.tags["pyroscope.profile.id"]}'],refId:"profile"}},origin:t.DataLinkConfigOrigin.Datasource};a.fields.forEach((e=>{"tags"===e.name&&(e.config.links=[r])}))}let u=[...e.data];return s&&u.push(...nr((0,t.toDataFrame)(a))),p=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Ir(e,t,r[t])}))}return e}({},e),g=null!=(g={data:u})?g:{},Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(g)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(g)).forEach((function(e){Object.defineProperty(p,e,Object.getOwnPropertyDescriptor(g,e))})),p;var p,g}const zr=e=>e.stringValue?`"${e.stringValue}"`:""+(e.intValue||e.doubleValue||e.boolValue||'""');function qr(e,r,n){switch(n){case y.Spans:return function(e,r){const n={};let s=!1;null==e||e.forEach((e=>Mr(e).forEach((e=>{var r;null===(r=e.attributes)||void 0===r||r.forEach((e=>{n[e.key]={name:e.key,type:t.FieldType.string,config:{displayNameFromDS:e.key}}})),e.spans.forEach((e=>{var r;e.name&&(s=!0),null===(r=e.attributes)||void 0===r||r.forEach((e=>{n[e.key]={name:e.key,type:t.FieldType.string,config:{displayNameFromDS:e.key}}}))}))}))));const a=new t.MutableDataFrame({name:"Spans",refId:"traces",fields:[{name:"traceIdHidden",type:t.FieldType.string,config:{custom:{hidden:!0}}},{name:"traceService",type:t.FieldType.string,config:{displayNameFromDS:"Trace Service",custom:{width:200}}},{name:"traceName",type:t.FieldType.string,config:{displayNameFromDS:"Trace Name",custom:{width:200}}},{name:"spanID",type:t.FieldType.string,config:{unit:"string",displayNameFromDS:"Span ID",custom:{width:200},links:[{title:"Span: ${__value.raw}",url:"",internal:{datasourceUid:r.uid,datasourceName:r.name,query:{query:"${__data.fields.traceIdHidden}",queryType:"traceql"},panelsState:{trace:{spanId:"${__value.raw}"}}}}]}},{name:"time",type:t.FieldType.time,config:{displayNameFromDS:"Start time"}},{name:"name",type:t.FieldType.string,config:{displayNameFromDS:"Name",custom:{hidden:!s}}},...Object.values(n).sort(((e,t)=>e.name.localeCompare(t.name))),{name:"duration",type:t.FieldType.number,config:{displayNameFromDS:"Duration",unit:"ns",custom:{width:120}}}],meta:{preferredVisualisationType:"table"}});return e&&e.length?(e.sort(((e,t)=>parseInt(null==t?void 0:t.startTimeUnixNano,10)/1e6-parseInt(null==e?void 0:e.startTimeUnixNano,10)/1e6)).forEach((e=>{Mr(e).forEach((t=>{t.spans.forEach((r=>{a.add(Ur(r,t,e))}))}))})),[a]):[a]}(e,r);case y.Raw:return function(e){return[(0,t.createDataFrame)({name:"Raw response",refId:"raw",fields:[{name:"response",type:t.FieldType.string,values:[JSON.stringify(e,null,2)]}]})]}(e);default:return function(e,r){const n=(0,t.createDataFrame)({name:"Traces",refId:"traces",fields:[{name:"traceID",type:t.FieldType.string,config:{unit:"string",displayNameFromDS:"Trace ID",custom:{width:200},links:[{title:"Trace: ${__value.raw}",url:"",internal:{datasourceUid:r.uid,datasourceName:r.name,query:{query:"${__value.raw}",queryType:"traceql"}}}]}},{name:"startTime",type:t.FieldType.time,config:{displayNameFromDS:"Start time",custom:{width:200}}},{name:"traceService",type:t.FieldType.string,config:{displayNameFromDS:"Service"}},{name:"traceName",type:t.FieldType.string,config:{displayNameFromDS:"Name"}},{name:"traceDuration",type:t.FieldType.number,config:{displayNameFromDS:"Duration",unit:"ms",custom:{width:120}}},{name:"nested",type:t.FieldType.nestedFrames}],meta:{preferredVisualisationType:"table",uniqueRowIdFields:[0]}});return(null==e?void 0:e.length)?(n.length=e.length,e.sort(((e,t)=>parseInt(null==t?void 0:t.startTimeUnixNano,10)/1e6-parseInt(null==e?void 0:e.startTimeUnixNano,10)/1e6)).forEach((e=>{const t=function(e){return{traceID:e.traceID,startTime:parseInt(e.startTimeUnixNano,10)/1e6,traceDuration:e.durationMs,traceService:e.rootServiceName||"",traceName:e.rootTraceName||""}}(e);n.fields[0].values.push(t.traceID),n.fields[1].values.push(t.startTime),n.fields[2].values.push(t.traceService),n.fields[3].values.push(t.traceName),n.fields[4].values.push(t.traceDuration?t.traceDuration:"<1ms"),e.spanSets?n.fields[5].values.push(e.spanSets.map((t=>Vr(e,t,r)))):e.spanSet&&n.fields[5].values.push([Vr(e,e.spanSet,r)])})),[n]):[n]}(e,r)}}const Mr=e=>e.spanSets||(e.spanSet?[e.spanSet]:[]),Vr=(e,r,n)=>{var s;const a={};let i=!1;null===(s=r.attributes)||void 0===s||s.map((e=>{a[e.key]={name:e.key,type:t.FieldType.string,config:{displayNameFromDS:e.key},values:[]}})),r.spans.forEach((e=>{var r;e.name&&(i=!0),null===(r=e.attributes)||void 0===r||r.forEach((e=>{a[e.key]={name:e.key,type:t.FieldType.string,config:{displayNameFromDS:e.key},values:[]}}))}));const o=new t.MutableDataFrame({fields:[{name:"traceIdHidden",type:t.FieldType.string,config:{custom:{hidden:!0}},values:[]},{name:"spanID",type:t.FieldType.string,values:[],config:{unit:"string",displayNameFromDS:"Span ID",custom:{width:200},links:[{title:"Span: ${__value.raw}",url:"",internal:{datasourceUid:n.uid,datasourceName:n.name,query:{query:"${__data.fields.traceIdHidden}",queryType:"traceql"},panelsState:{trace:{spanId:"${__value.raw}"}}}}]}},{name:"time",type:t.FieldType.time,config:{displayNameFromDS:"Start time",custom:{width:200}}},{name:"name",type:t.FieldType.string,values:[],config:{displayNameFromDS:"Name",custom:{hidden:!i}}},...Object.values(a).sort(((e,t)=>e.name.localeCompare(t.name))),{name:"duration",type:t.FieldType.number,values:[],config:{displayNameFromDS:"Duration",unit:"ns",custom:{width:120}}}],meta:{preferredVisualisationType:"table"}}),l=(0,t.createTheme)();for(const e of o.fields)e.display=(0,t.getDisplayProcessor)({field:e,theme:l});return r.spans.forEach((t=>{o.add(Ur(t,r,e))})),o};function Ur(e,t,r){const n=parseInt(e.startTimeUnixNano,10)/1e6,s={traceIdHidden:r.traceID,traceService:r.rootServiceName||"",traceName:r.rootTraceName||"",spanID:e.spanID,time:n,duration:parseInt(e.durationNanos,10),name:e.name};let a=[];return t.attributes&&(a=a.concat(t.attributes)),e.attributes&&(a=a.concat(e.attributes)),a.forEach((e=>{var t,r,n,a,i,o,l,c;(e.value.boolValue||(null===(t=e.value.Value)||void 0===t?void 0:t.bool_value))&&(s[e.key]=e.value.boolValue||(null===(i=e.value.Value)||void 0===i?void 0:i.bool_value)),(e.value.doubleValue||(null===(r=e.value.Value)||void 0===r?void 0:r.double_value))&&(s[e.key]=e.value.doubleValue||(null===(o=e.value.Value)||void 0===o?void 0:o.double_value)),(e.value.intValue||(null===(n=e.value.Value)||void 0===n?void 0:n.int_value))&&(s[e.key]=e.value.intValue||(null===(l=e.value.Value)||void 0===l?void 0:l.int_value)),(e.value.stringValue||(null===(a=e.value.Value)||void 0===a?void 0:a.string_value))&&(s[e.key]=e.value.stringValue||(null===(c=e.value.Value)||void 0===c?void 0:c.string_value))})),s}const Br={data:[new t.MutableDataFrame({fields:[{name:"trace",type:t.FieldType.trace,values:[]}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"otlp"}}})]},Gr={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let Xr;const Yr=new Uint8Array(16);function Jr(){if(!Xr&&(Xr="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Xr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xr(Yr)}const Hr=[];for(let e=0;e<256;++e)Hr.push((e+256).toString(16).slice(1));const Zr=function(e,t,r){if(Gr.randomUUID&&!t&&!e)return Gr.randomUUID();const n=(e=e||{}).random||(e.rng||Jr)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return Hr[e[t+0]]+Hr[e[t+1]]+Hr[e[t+2]]+Hr[e[t+3]]+"-"+Hr[e[t+4]]+Hr[e[t+5]]+"-"+Hr[e[t+6]]+Hr[e[t+7]]+"-"+Hr[e[t+8]]+Hr[e[t+9]]+"-"+Hr[e[t+10]]+Hr[e[t+11]]+Hr[e[t+12]]+Hr[e[t+13]]+Hr[e[t+14]]+Hr[e[t+15]]}(n)};function Kr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function en(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Kr(e,t,r[t])}))}return e}function tn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function rn(e,r,n){const s={steps:[{color:"blue",value:-1/0},{color:"green",value:75}],mode:t.ThresholdsMode.Absolute};return{refId:"streaming-progress",name:"Streaming Progress",length:1,fields:[{name:"state",type:t.FieldType.string,values:[(0,z.capitalize)(r.toString())],config:{displayNameFromDS:"State"}},{name:"elapsedTime",type:t.FieldType.number,values:[n],config:{unit:"ms",displayNameFromDS:"Elapsed Time"}},{name:"totalBlocks",type:t.FieldType.number,values:[e.totalBlocks],config:{displayNameFromDS:"Total Blocks"}},{name:"completedJobs",type:t.FieldType.number,values:[e.completedJobs],config:{displayNameFromDS:"Completed Jobs"}},{name:"totalJobs",type:t.FieldType.number,values:[e.totalJobs],config:{displayNameFromDS:"Total Jobs"}},{name:"progress",type:t.FieldType.number,values:[r===v.Done?100:(e.completedJobs||0)/(e.totalJobs||1)*100],config:{displayNameFromDS:"Progress",unit:"percent",min:0,max:100,custom:{cellOptions:{type:"gauge",mode:"gradient"}},thresholds:s}}],meta:{preferredVisualisationType:"table"}}}var nn=Object.defineProperty,sn=Object.defineProperties,an=Object.getOwnPropertyDescriptors,on=Object.getOwnPropertySymbols,ln=Object.prototype.hasOwnProperty,cn=Object.prototype.propertyIsEnumerable,un=(e,t,r)=>t in e?nn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const pn=e=>{var t=e,{className:r}=t,n=((e,t)=>{var r={};for(var n in e)ln.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&on)for(var n of on(e))t.indexOf(n)<0&&cn.call(e,n)&&(r[n]=e[n]);return r})(t,["className"]);const i=(0,s.useStyles2)(gn);return o().createElement(s.Button,(l=((e,t)=>{for(var r in t||(t={}))ln.call(t,r)&&un(e,r,t[r]);if(on)for(var r of on(t))cn.call(t,r)&&un(e,r,t[r]);return e})({},n),c={className:(0,a.cx)(r,i.button)},sn(l,an(c))));var l,c},gn=e=>({button:(0,a.css)({paddingLeft:e.spacing(1.5),paddingRight:e.spacing(1.5)})}),dn=e=>({vertical:(0,a.css)({display:"flex",flexDirection:"column",gap:e.spacing(.25)}),horizontal:(0,a.css)({display:"flex",flexDirection:"row",gap:e.spacing(1)}),addTag:(0,a.css)({marginLeft:e.spacing(1)})}),hn=({updateFilter:e,deleteFilter:t,filters:r,datasource:a,setError:o,staticTags:l,isTagsLoading:c,hideValues:u,requireTagAndValue:p,query:g,addVariablesToOptions:d})=>{const h=(0,s.useStyles2)(dn),f=(0,i.useCallback)((()=>e({id:fn(),operator:"=",scope:O.Span})),[e]);(0,i.useEffect)((()=>{(null==r?void 0:r.length)||f()}),[r,f]);const m=e=>((e,t)=>[...xt,...e].filter((e=>!t.includes(e))))(a.languageProvider.getTags(e.scope),l),v=e=>p?e.tag&&e.value&&e.value.length>0:e.tag;return(0,n.jsx)("div",{className:h.vertical,children:null==r?void 0:r.map(((s,i)=>(0,n.jsxs)("div",{className:h.horizontal,children:[(0,n.jsx)(Xt,{filter:s,datasource:a,setError:o,updateFilter:e,tags:m(s),isTagsLoading:c,hideValue:u,query:g,addVariablesToOptions:d}),(v(s)||r.length>1)&&(0,n.jsx)(pn,{"aria-label":`Remove tag with ID ${s.id}`,variant:"secondary",icon:"times",onClick:()=>null==t?void 0:t(s),tooltip:"Remove tag"}),v(s)&&i===r.length-1&&(0,n.jsx)("span",{className:h.addTag,children:(0,n.jsx)(pn,{"aria-label":"Add tag",variant:"secondary",icon:"plus",onClick:f,tooltip:"Add tag"})})]},s.id)))})},fn=()=>Zr().slice(0,8);function mn(e,t,r,n,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,s)}const vn=(e,t)=>`${t||"Error"}${e?` (${e})`:""}. Please check the server logs for more details.`;function yn(){var e;return e=function*(e){if(!e)return;const t=(0,r.getDataSourceSrv)();try{return yield t.get(e)}catch(e){return void console.error("Failed to load data source",e)}},yn=function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function i(e){mn(a,n,s,i,o,"next",e)}function o(e){mn(a,n,s,i,o,"throw",e)}i(void 0)}))},yn.apply(this,arguments)}const On=e=>{let t=[];if(e.spanName&&t.push({id:"span-name",scope:O.Span,tag:"name",operator:"=",value:[e.spanName],valueType:"string"}),e.serviceName&&t.push({id:"service-name",scope:O.Resource,tag:"service.name",operator:"=",value:[e.serviceName],valueType:"string"}),(e.minDuration||e.maxDuration)&&t.push({id:"duration-type",value:"trace"}),e.minDuration&&t.push({id:"min-duration",tag:"duration",operator:">",value:[e.minDuration],valueType:"duration"}),e.maxDuration&&t.push({id:"max-duration",tag:"duration",operator:"<",value:[e.maxDuration],valueType:"duration"}),e.search){const r=e.search.split(" ");for(const e of r){const[r,n]=e.split("=");r&&n&&t.push({id:fn(),scope:O.Unscoped,tag:r,operator:"=",value:[n.replace(/(^"|"$)/g,"")],valueType:n.startsWith('"')&&n.endsWith('"')?"string":void 0})}}return{datasource:e.datasource,filters:t,groupBy:e.groupBy,limit:e.limit,query:e.query,queryType:"traceqlSearch",refId:e.refId}};function bn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Sn extends t.CustomVariableSupport{query(e){if(!this.datasource)throw new Error("Datasource not initialized");const t=this.datasource.executeVariableQuery(e.targets[0]);return(0,q.from)(t).pipe(fe((e=>({data:e}))))}constructor(e){super(),bn(this,"datasource",void 0),bn(this,"editor",void 0),this.datasource=e,this.editor=Zt}}function xn(e,t,r,n,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,s)}function wn(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function i(e){xn(a,n,s,i,o,"next",e)}function o(e){xn(a,n,s,i,o,"throw",e)}i(void 0)}))}}function jn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Tn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){jn(e,t,r[t])}))}return e}function Pn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const _n=20;var En;!function(e){e.streaming="streaming"}(En||(En={}));const kn={streaming:"2.2.0"};class Cn extends r.DataSourceWithBackend{executeVariableQuery(e){var t=this;return wn((function*(){if(void 0===e.type)return new Promise((()=>[]));switch(e.type){case Yt.LabelNames:return yield t.labelNamesQuery();case Yt.LabelValues:return t.labelValuesQuery(e.label);default:throw Error("Invalid query type: "+e.type)}}))()}labelNamesQuery(){var e=this;return wn((function*(){return yield e.languageProvider.fetchTags(),e.languageProvider.getAutocompleteTags().filter((e=>void 0!==e)).map((e=>({text:e})))}))()}labelValuesQuery(e){var t=this;return wn((function*(){if(!e)return[];let r;try{var n;const s=null===(n=(t.languageProvider.tagsV2||[]).flatMap((e=>e.tags.map((t=>({scope:e.name,name:t}))))).find((t=>t.name===e)))||void 0===n?void 0:n.scope;if(!s)throw Error(`Scope for tag ${e} not found`);const a="intrinsic"===s?e:`${s}.${e}`;r=yield t.languageProvider.getOptionsV2(a)}catch(n){r=yield t.languageProvider.getOptionsV1(e)}return r.flatMap((e=>void 0!==e.value?[{text:e.value}]:[]))}))()}getTagKeys(){var e=this;return wn((function*(){return yield e.languageProvider.fetchTags(),(e.languageProvider.tagsV2||[]).map((({name:e,tags:t})=>t.filter((e=>void 0!==e)).map((t=>"intrinsic"!==e?`${e}.${t}`:`${t}`)))).flat().map((e=>({text:e})))}))()}getTagValues(e){const t=`{${e.filters.filter((e=>e.key&&e.operator&&e.value)).map((e=>`${e.key}${e.operator}${(e=>xt.find((t=>t===e.key))||parseInt(e.value,10).toString()===e.value?e.value:`"${e.value}"`)(e)}`)).join(" && ")}}`;return this.tagValuesQuery(e.key,t)}tagValuesQuery(e,t){var r=this;return wn((function*(){let n;try{n=yield r.languageProvider.getOptionsV2(e,t)}catch(t){n=yield r.languageProvider.getOptionsV1((e=>e.replace(/^(event|link|resource|span)\./,""))(e))}return n.flatMap((e=>void 0!==e.value?[{text:e.value}]:[]))}))()}isFeatureAvailable(e){var t;const r=null!==(t=this.tempoVersion)&&void 0!==t?t:"2.1.0";try{return vt().gte(r,kn[e])}catch(e){return!0}}isStreamingSearchEnabled(){var e;return(null===(e=this.streamingEnabled)||void 0===e?void 0:e.search)&&r.config.liveEnabled}isTraceQlMetricsQuery(e){return!!e.trim().match(/\|\s*(rate|count_over_time|avg_over_time|max_over_time|min_over_time|quantile_over_time|histogram_over_time|compare)\s*\(/)}isTraceIdQuery(e){return!!e.trim().match(/^[0-9A-Fa-f]*$/)}query(e){var n,s,a,i,o,l;const c=[],u=e.targets.filter((e=>!e.hide)),p=(0,z.groupBy)(u,(e=>e.queryType||"traceql"));if(p.clear)return(0,q.of)({data:[],state:t.LoadingState.Done});if((null===(n=p.nativeSearch)||void 0===n?void 0:n.length)&&(p.nativeSearch[0].spanName||p.nativeSearch[0].serviceName||p.nativeSearch[0].search||p.nativeSearch[0].maxDuration||p.nativeSearch[0].minDuration||"nativeSearch"===p.nativeSearch[0].queryType)){var g;const e=On(p.nativeSearch[0]);(null===(g=p.traceqlSearch)||void 0===g?void 0:g.length)?p.traceqlSearch.push(e):p.traceqlSearch=[e]}if(null===(s=p.traceql)||void 0===s?void 0:s.length)try{const t=this.applyVariables(p.traceql[0],e.scopedVars),n=(null==t?void 0:t.query)||"";var d,h,f;this.isTraceIdQuery(n)?((0,r.reportInteraction)("grafana_traces_traceID_queried",{datasourceType:"tempo",app:null!==(d=e.app)&&void 0!==d?d:"",grafana_version:r.config.buildInfo.version,hasQuery:""!==n}),c.push(this.handleTraceIdQuery(e,p.traceql))):this.isTraceQlMetricsQuery(n)?((0,r.reportInteraction)("grafana_traces_traceql_metrics_queried",{datasourceType:"tempo",app:null!==(h=e.app)&&void 0!==h?h:"",grafana_version:r.config.buildInfo.version,query:null!=n?n:""}),c.push(this.handleTraceQlMetricsQuery(e,n))):((0,r.reportInteraction)("grafana_traces_traceql_queried",{datasourceType:"tempo",app:null!==(f=e.app)&&void 0!==f?f:"",grafana_version:r.config.buildInfo.version,query:null!=n?n:"",streaming:this.isStreamingSearchEnabled()}),c.push(this.handleTraceQlQuery(e,p,n)))}catch(e){return(0,q.of)({error:{message:e instanceof Error?e.message:"Unknown error occurred"},data:[]})}if(null===(a=p.traceqlSearch)||void 0===a?void 0:a.length)try{if(r.config.featureToggles.metricsSummary){const t=p.traceqlSearch.find((e=>this.hasGroupBy(e)));if(t){const r=this.applyVariables(t,e.scopedVars);c.push(this.handleMetricsSummaryQuery(r,Ct(r.filters),e))}}const t=r.config.featureToggles.metricsSummary?p.traceqlSearch.filter((e=>!this.hasGroupBy(e))):p.traceqlSearch;if(t.length>0){const n=this.applyVariables(t[0],e.scopedVars),s=Ct(n.filters);var m,v,y;(0,r.reportInteraction)("grafana_traces_traceql_search_queried",{datasourceType:"tempo",app:null!==(m=e.app)&&void 0!==m?m:"",grafana_version:r.config.buildInfo.version,query:null!=s?s:"",streaming:this.isStreamingSearchEnabled()}),this.isStreamingSearchEnabled()?c.push(this.handleStreamingQuery(e,t,s)):c.push(this._request("/api/search",{q:s,limit:null!==(v=e.targets[0].limit)&&void 0!==v?v:_n,spss:null!==(y=e.targets[0].spss)&&void 0!==y?y:3,start:e.range.from.unix(),end:e.range.to.unix()}).pipe(fe((e=>({data:qr(e.data.traces,this.instanceSettings,p.traceqlSearch[0].tableType)}))),je((e=>(0,q.of)({error:{message:vn(e.data.message)},data:[]})))))}}catch(e){return(0,q.of)({error:{message:e instanceof Error?e.message:"Unknown error occurred"},data:[]})}if(null===(i=p.upload)||void 0===i?void 0:i.length)if(this.uploadedJson){var O;(0,r.reportInteraction)("grafana_traces_json_file_uploaded",{datasourceType:"tempo",app:null!==(O=e.app)&&void 0!==O?O:"",grafana_version:r.config.buildInfo.version});const n=JSON.parse(this.uploadedJson),s=n.batches,a=Array.isArray(n)&&n.some((e=>{var t;return"nodeGraph"===(null==e||null===(t=e.meta)||void 0===t?void 0:t.preferredVisualisationType)}));var b;s?c.push((0,q.of)(function(e,r=!1){const n=new t.MutableDataFrame({fields:[{name:"traceID",type:t.FieldType.string,values:[]},{name:"spanID",type:t.FieldType.string,values:[]},{name:"parentSpanID",type:t.FieldType.string,values:[]},{name:"operationName",type:t.FieldType.string,values:[]},{name:"serviceName",type:t.FieldType.string,values:[]},{name:"kind",type:t.FieldType.string,values:[]},{name:"statusCode",type:t.FieldType.number,values:[]},{name:"statusMessage",type:t.FieldType.string,values:[]},{name:"instrumentationLibraryName",type:t.FieldType.string,values:[]},{name:"instrumentationLibraryVersion",type:t.FieldType.string,values:[]},{name:"traceState",type:t.FieldType.string,values:[]},{name:"serviceTags",type:t.FieldType.other,values:[]},{name:"startTime",type:t.FieldType.number,values:[]},{name:"duration",type:t.FieldType.number,values:[]},{name:"logs",type:t.FieldType.other,values:[]},{name:"references",type:t.FieldType.other,values:[]},{name:"tags",type:t.FieldType.other,values:[]}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"otlp"}}});try{for(const t of e){const{serviceName:e,serviceTags:r}=$r(t.resource);for(const l of t.instrumentationLibrarySpans)for(const t of l.spans){var s,a,i,o;n.add({traceID:t.traceId.length>16?t.traceId.slice(16):t.traceId,spanID:t.spanId,parentSpanID:t.parentSpanId||"",operationName:t.name||"",serviceName:e,kind:Ar(t),statusCode:null===(s=t.status)||void 0===s?void 0:s.code,statusMessage:null===(a=t.status)||void 0===a?void 0:a.message,instrumentationLibraryName:null===(i=l.instrumentationLibrary)||void 0===i?void 0:i.name,instrumentationLibraryVersion:null===(o=l.instrumentationLibrary)||void 0===o?void 0:o.version,traceState:t.traceState,serviceTags:r,startTime:t.startTimeUnixNano/1e6,duration:(t.endTimeUnixNano-t.startTimeUnixNano)/1e6,tags:Fr(t),logs:Lr(t),references:Qr(t)})}}}catch(e){return console.error(e),{error:{message:"JSON is not valid OpenTelemetry format: "+e},data:[]}}let l=[n];return r&&l.push(...nr(n)),{data:l}}(n.batches,null===(b=this.nodeGraph)||void 0===b?void 0:b.enabled))):a?c.push((0,q.of)({data:n,state:t.LoadingState.Done})):c.push((0,q.of)({error:{message:"Unable to parse uploaded data."},data:[]}))}else c.push((0,q.of)({data:[],state:t.LoadingState.Done}));if((null===(o=this.serviceMap)||void 0===o?void 0:o.datasourceUid)&&(null===(l=p.serviceMap)||void 0===l?void 0:l.length)>0){var S;(0,r.reportInteraction)("grafana_traces_service_graph_queried",{datasourceType:"tempo",app:null!==(S=e.app)&&void 0!==S?S:"",grafana_version:r.config.buildInfo.version,hasServiceMapQuery:!!p.serviceMap[0].serviceMapQuery});const n=this.serviceMap.datasourceUid,s=this.uid;c.push((x=e,w=n,j=s,Rn($n(x),w).pipe(Ee(),fe((e=>{const n=e.find((e=>!!e.error));var s;if(n)throw new Error(vn(null===(s=n.error)||void 0===s?void 0:s.message));const{nodes:a,edges:i}=function(e,r){const n=function(e){var r;return((null===(r=e[0])||void 0===r?void 0:r.data)||[]).reduce(((e,r)=>{const n=(0,t.toDataFrame)(r);var s;return e[null!==(s=n.refId)&&void 0!==s?s:"A"]=new t.DataFrameView(n),e}),{})}(e),s={},a={};return hr(n[ar],"total",ar,s,a),hr(n[sr],"seconds",sr,s,a),hr(n[ir],"failed",ir,s,a),function(e,r,n){const[s,a]=function(){function e(e,r){return new t.MutableDataFrame({name:e,fields:r,meta:{preferredVisualisationType:"nodeGraph"}})}return[e("Nodes",[{name:t.NodeGraphDataFrameFieldNames.id,type:t.FieldType.string,values:[]},{name:t.NodeGraphDataFrameFieldNames.title,type:t.FieldType.string,config:{displayName:"Service name"},values:[]},{name:t.NodeGraphDataFrameFieldNames.subTitle,type:t.FieldType.string,config:{displayName:"Service namespace"},values:[]},{name:t.NodeGraphDataFrameFieldNames.mainStat,type:t.FieldType.number,config:{unit:"ms/r",displayName:"Average response time"},values:[]},{name:t.NodeGraphDataFrameFieldNames.secondaryStat,type:t.FieldType.number,config:{unit:"r/sec",displayName:"Requests per second"},values:[]},{name:t.NodeGraphDataFrameFieldNames.arc+"success",type:t.FieldType.number,config:{displayName:"Success",color:{fixedColor:"green",mode:t.FieldColorModeId.Fixed}},values:[]},{name:t.NodeGraphDataFrameFieldNames.arc+"failed",type:t.FieldType.number,config:{displayName:"Failed",color:{fixedColor:"red",mode:t.FieldColorModeId.Fixed}},values:[]}]),e("Edges",[{name:t.NodeGraphDataFrameFieldNames.id,type:t.FieldType.string,values:[]},{name:t.NodeGraphDataFrameFieldNames.source,type:t.FieldType.string,values:[]},{name:"sourceName",type:t.FieldType.string,values:[]},{name:"sourceNamespace",type:t.FieldType.string,values:[]},{name:t.NodeGraphDataFrameFieldNames.target,type:t.FieldType.string,values:[]},{name:"targetName",type:t.FieldType.string,values:[]},{name:"targetNamespace",type:t.FieldType.string,values:[]},{name:t.NodeGraphDataFrameFieldNames.mainStat,type:t.FieldType.number,config:{unit:"ms/r",displayName:"Average response time"},values:[]},{name:t.NodeGraphDataFrameFieldNames.secondaryStat,type:t.FieldType.number,config:{unit:"r/sec",displayName:"Requests per second"},values:[]}])]}();for(const r of Object.keys(e)){const n=e[r];s.add({[t.NodeGraphDataFrameFieldNames.id]:r,[t.NodeGraphDataFrameFieldNames.title]:n.name,[t.NodeGraphDataFrameFieldNames.subTitle]:n.namespace,[t.NodeGraphDataFrameFieldNames.mainStat]:n.total?n.seconds/n.total*1e3:Number.NaN,[t.NodeGraphDataFrameFieldNames.secondaryStat]:n.total?Math.round(100*n.total)/100:Number.NaN,[t.NodeGraphDataFrameFieldNames.arc+"success"]:n.total?(n.total-Math.min(n.failed||0,n.total))/n.total:1,[t.NodeGraphDataFrameFieldNames.arc+"failed"]:n.total?Math.min(n.failed||0,n.total)/n.total:0})}for(const e of Object.keys(r)){const n=r[e];a.add({[t.NodeGraphDataFrameFieldNames.id]:e,[t.NodeGraphDataFrameFieldNames.source]:n.source,sourceName:n.sourceName,sourceNamespace:n.sourceNamespace,[t.NodeGraphDataFrameFieldNames.target]:n.target,targetName:n.targetName,targetNamespace:n.targetNamespace,[t.NodeGraphDataFrameFieldNames.mainStat]:n.total?n.seconds/n.total*1e3:Number.NaN,[t.NodeGraphDataFrameFieldNames.secondaryStat]:n.total?Math.round(100*n.total)/100:Number.NaN})}return{nodes:s,edges:a}}(s,a)}(e,x.range);if(a.fields.length>0&&i.fields.length>0){const e=a.fields[0].values.length,t=i.fields[0].values.length;(0,r.reportInteraction)("grafana_traces_service_graph_size",{datasourceType:"tempo",grafana_version:r.config.buildInfo.version,nodeLength:e,edgeLength:t})}const{serviceMapIncludeNamespace:o,refId:l}=x.targets[0];return a.refId=l,i.refId=l,o?(a.fields[0].config=In(w,j,"__data.fields.title",0,void 0,{targetNamespace:"__data.fields.subtitle"}),i.fields[0].config=In(w,j,"__data.fields.targetName",0,"__data.fields.sourceName",{targetNamespace:"__data.fields.targetNamespace",sourceNamespace:"__data.fields.sourceNamespace"})):(a.fields[0].config=In(w,j,"__data.fields.id"),i.fields[0].config=In(w,j,"__data.fields.target",0,"__data.fields.source")),{nodes:a,edges:i,state:t.LoadingState.Done}})))).pipe(Pe((r=>function(e,t,r){const n=$n(e);return n.targets=Ln([Fn(lr,pr,e)]),Rn(n,r).pipe(Ee(),fe((e=>{var r;const n=e.find((e=>!!e.error));var s,a;if(n)throw new Error(vn(null===(s=n.error)||void 0===s?void 0:s.message));return{rates:null!==(a=null===(r=e[0])||void 0===r?void 0:r.data)&&void 0!==a?a:[],nodes:t.nodes,edges:t.edges}})))}(e,r,n).pipe(Pe((r=>function(e,r,n,s){let a=[],i="",o=[],l=[];if(r.rates[0]&&e.app===t.CoreApp.Explore){const e=r.rates[0].fields.find((e=>"span_name"===e.name));e&&e.values&&(l=e.values)}else r.rates&&r.rates.map((e=>{const t=e.fields.find((e=>{var t;return null===(t=e.labels)||void 0===t?void 0:t.span_name}));var r;t&&l.push(null===(r=t.labels)||void 0===r?void 0:r.span_name)}));const c=l.map((e=>e.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]\'+?.()|]/g,"\\\\$&")));c.length>0&&(i=Fn(cr,'span_name=~"'+c.join("|")+'"',e),a.push(i),c.map((t=>{const r=Fn(ur,'span_name=~"'+t+'"',e);o.push(r),a.push(r)})));const u=$n(e);return u.targets=Ln(a),Rn(u,n).pipe(Ee(),fe((a=>{const l=a.find((e=>!!e.error));var c;if(l)throw new Error(vn(null===(c=l.error)||void 0===c?void 0:c.message));const u=function(e,r,n,s,a,i,o){var l,c;let u={fields:[]};const p=r.rates.filter((t=>t.refId===Fn(lr,pr,e))),g=n.data.filter((e=>e.refId===s)),d=n.data.filter((e=>{var t;return a.includes(null!==(t=e.refId)&&void 0!==t?t:"")}));if(p.length>0&&(null===(l=p[0].fields)||void 0===l?void 0:l.length)>2&&(u.fields.push(Pn(Tn({},p[0].fields[1]),{name:"Name",config:{filterable:!1}})),u.fields.push(Pn(Tn({},p[0].fields[2]),{name:"Rate",config:{links:[Nn("Rate",An(Fn(lr,'span_name="${__data.fields[0]}"',e)),i,!1)],decimals:2}})),u.fields.push(Pn(Tn({},p[0].fields[2]),{name:"  ",labels:null,config:{color:{mode:"continuous-BlPu"},custom:{cellOptions:{mode:it.Lcd,type:ut.Gauge}},decimals:3}}))),g.length>0&&(null===(c=g[0].fields)||void 0===c?void 0:c.length)>2){var h,f,m;const t=null!==(m=null===(h=g[0].fields[1])||void 0===h?void 0:h.values)&&void 0!==m?m:[];var v;const r=null!==(v=null===(f=g[0].fields[2])||void 0===f?void 0:f.values)&&void 0!==v?v:[];let n={};t.map(((e,t)=>{n[e]={value:r[t]}}));const s=Qn(Tn({},p),n);u.fields.push(Pn(Tn({},g[0].fields[2]),{name:"Error Rate",values:s,config:{links:[Nn("Error Rate",An(Fn(cr,'span_name="${__data.fields[0]}"',e)),i,!1)],decimals:2}})),u.fields.push(Pn(Tn({},g[0].fields[2]),{name:"   ",values:s,labels:null,config:{color:{mode:"continuous-RdYlGr"},custom:{cellOptions:{mode:it.Lcd,type:ut.Gauge}},decimals:3}}))}if(d.length>0){let t={};d.forEach((e=>{if(e.fields.length>1){var r,n;const s=(null===(r=e.refId)||void 0===r?void 0:r.includes('span_name=~"'))?'span_name=~"':'span_name="',a=null===(n=e.refId)||void 0===n?void 0:n.split(s)[1].split('"}')[0];t[a]={value:e.fields[1].values[0]}}})),Object.keys(t).length>0&&u.fields.push(Pn(Tn({},d[0].fields[1]),{name:"Duration (p90)",values:Qn(Tn({},p),t),config:{links:[Nn("Duration",An(Fn(ur,'span_name="${__data.fields[0]}"',e)),i,!1)],unit:"s"}}))}return u.fields.length>0&&u.fields[0].values&&u.fields.push({name:"Links",type:t.FieldType.string,values:u.fields[0].values.map((()=>"Tempo")),config:{links:[Dn("Tempo",void 0,"","${__data.fields[0]}",o)]}}),u}(e,r,a[0],i,o,n,s);return 0===u.fields.length?{data:[r.nodes,r.edges],state:t.LoadingState.Done}:{data:[u,r.nodes,r.edges],state:t.LoadingState.Done}})))}(e,r,n,s))))))))}var x,w,j;return(0,q.merge)(...c)}applyTemplateVariables(e,t){return this.applyVariables(e,t)}interpolateVariablesInQueries(e,t){return e&&0!==e.length?e.map((e=>Tn(Pn(Tn({},e),{datasource:this.getRef()}),this.applyVariables(e,t)))):[]}applyVariables(e,t){const r=Tn({},e);var n,s;return e.filters&&(r.filters=kt(e.filters,t)),e.groupBy&&(r.groupBy=e.groupBy.map((e=>{var r;return Pn(Tn({},e),{tag:this.templateSrv.replace(null!==(r=e.tag)&&void 0!==r?r:"",t)})}))),Pn(Tn({},r),{query:this.templateSrv.replace(null!==(n=e.query)&&void 0!==n?n:"",t,dt.Pipe),serviceMapQuery:Array.isArray(e.serviceMapQuery)?e.serviceMapQuery.map((e=>this.templateSrv.replace(e,t))):this.templateSrv.replace(null!==(s=e.serviceMapQuery)&&void 0!==s?s:"",t)})}handleTraceIdQuery(e,t){const r=t.filter((e=>e.query)).map((e=>{var t;return Pn(Tn({},e),{query:null===(t=e.query)||void 0===t?void 0:t.trim(),queryType:"traceId"})}));if(!r.length)return q.EMPTY;const n=this.makeTraceIdRequest(e,r);return super.query(n).pipe(fe((e=>{var t;return e.error?e:Wr(e,this.instanceSettings,null===(t=this.nodeGraph)||void 0===t?void 0:t.enabled)})))}handleStreamingQuery(e,n,s){return""===s?q.EMPTY:(0,q.merge)(...n.map((n=>function(e,n,s,a){const i=s.range;let o,l=t.LoadingState.NotStarted;const c=performance.now();var u;return(0,r.getGrafanaLiveSrv)().getStream({scope:t.LiveChannelScope.DataSource,namespace:n.uid,path:`search/${Zr()}`,data:tn(en({},e),{SpansPerSpanSet:null!==(u=e.spss)&&void 0!==u?u:3,timeRange:{from:i.from.toISOString(),to:i.to.toISOString()}})}).pipe((0,q.takeWhile)((e=>{if("message"in e&&(null==e?void 0:e.message)){const t=e.message.data.values[2][0];if(t===v.Done||t===v.Error)return!1}return!0}),!0)).pipe((0,q.map)((r=>{if("message"in r&&(null==r?void 0:r.message)){const n=performance.now()-c,s=r.message.data.values[0][0],i=r.message.data.values[1][0],u=r.message.data.values[2][0],p=r.message.data.values[3][0];switch(u){case v.Done:l=t.LoadingState.Done;break;case v.Streaming:l=t.LoadingState.Streaming;break;case v.Error:throw new Error(p)}o=[rn(i,u,n),...qr(s,a,e.tableType)]}return{data:o||[],state:l}})))}(Pn(Tn({},n),{query:s}),this,e,this.instanceSettings))))}makeTraceIdRequest(e,r){var n;const s=Pn(Tn({},e),{targets:r});var a,i;return(null===(n=this.traceQuery)||void 0===n?void 0:n.timeShiftEnabled)?s.range=e.range&&Pn(Tn({},e.range),{from:(0,t.dateTime)(e.range.from).subtract(t.rangeUtil.intervalToMs((null===(a=this.traceQuery)||void 0===a?void 0:a.spanStartTimeShift)||"30m"),"milliseconds"),to:(0,t.dateTime)(e.range.to).add(t.rangeUtil.intervalToMs((null===(i=this.traceQuery)||void 0===i?void 0:i.spanEndTimeShift)||"30m"),"milliseconds")}):s.range={from:(0,t.dateTime)(0),to:(0,t.dateTime)(0),raw:{from:(0,t.dateTime)(0),to:(0,t.dateTime)(0)}},s}metadataRequest(e,t={}){var r=this;return wn((function*(){return yield(0,q.lastValueFrom)(r._request(e,t,{method:"GET",hideFromInspector:!0}))}))()}_request(e,n,s){const a=n?t.urlUtil.serializeParams(n):"",i=`${this.instanceSettings.url}${e}${a.length?`?${a}`:""}`,o=Pn(Tn({},s),{url:i});return(0,r.getBackendSrv)().fetch(o)}testDatasource(){var e=this;return wn((function*(){var n;const s=[],a={headers:{},method:"GET",url:`${e.instanceSettings.url}/api/echo`};if(s.push((0,r.getBackendSrv)().fetch(a).pipe(Te((()=>(0,q.of)({status:"success",message:"Health check succeeded"}))),je((e=>(0,q.of)({status:"error",message:vn(e.data.message,"Unable to connect with Tempo")}))))),null===(n=e.streamingEnabled)||void 0===n?void 0:n.search){const r=new Date,n=new Date(r);n.setMinutes(n.getMinutes()-15),s.push(e.handleStreamingQuery({range:{from:(0,t.dateTime)(n),to:(0,t.dateTime)(r),raw:{from:"now-15m",to:"now"}},requestId:"",interval:"",intervalMs:0,scopedVars:{},targets:[],timezone:"",app:"",startTime:0},[{datasource:e.instanceSettings,limit:1,query:"{}",queryType:"traceql",refId:"A",tableType:y.Traces,filters:[]}],"{}").pipe(Te((()=>(0,q.of)({status:"success",message:"Streaming test succeeded."}))),je((e=>(0,q.of)({status:"error",message:vn(e.data.message,"Test for streaming failed, consider disabling streaming")})))))}return yield(0,q.lastValueFrom)((0,q.forkJoin)(s).pipe(Te((e=>{const t=e.find((e=>"success"!==e.status));return t?(0,q.of)(t):(0,q.of)({status:"success",message:"Successfully connected to Tempo data source."})}))))}))()}getQueryDisplayText(e){var t;if("traceql"===e.queryType||"traceId"===e.queryType)return null!==(t=e.query)&&void 0!==t?t:"";const r=this.applyVariables(e,{});return Ct(r.filters)}constructor(e,n=(0,r.getTemplateSrv)()){var s;super(e),jn(this,"instanceSettings",void 0),jn(this,"templateSrv",void 0),jn(this,"tracesToLogs",void 0),jn(this,"serviceMap",void 0),jn(this,"search",void 0),jn(this,"nodeGraph",void 0),jn(this,"traceQuery",void 0),jn(this,"uploadedJson",void 0),jn(this,"spanBar",void 0),jn(this,"languageProvider",void 0),jn(this,"streamingEnabled",void 0),jn(this,"tempoVersion",void 0),jn(this,"init",void 0),jn(this,"formatGroupBy",void 0),jn(this,"hasGroupBy",void 0),jn(this,"handleTraceQlQuery",void 0),jn(this,"handleTraceQlMetricsQuery",void 0),jn(this,"handleMetricsSummaryQuery",void 0),this.instanceSettings=e,this.templateSrv=n,this.uploadedJson=null;var a=this;this.init=wn((function*(){const e=yield(0,q.lastValueFrom)(a._request("/api/status/buildinfo").pipe(fe((e=>e)),je((e=>(console.error("Failure in retrieving build information",e.data.message),(0,q.of)({error:e,data:{version:null}}))))));a.tempoVersion=e.data.version})),this.formatGroupBy=e=>null==e?void 0:e.filter((e=>e.tag)).map((e=>e.scope===O.Unscoped?`.${e.tag}`:e.scope!==O.Intrinsic?`${e.scope}.${e.tag}`:e.tag)).join(", "),this.hasGroupBy=e=>{var t;return null===(t=e.groupBy)||void 0===t?void 0:t.find((e=>e.tag))},this.handleTraceQlQuery=(e,t,r)=>{return this.isStreamingSearchEnabled()?this.handleStreamingQuery(e,t.traceql,r):this._request("/api/search",{q:r,limit:null!==(n=e.targets[0].limit)&&void 0!==n?n:_n,spss:null!==(s=e.targets[0].spss)&&void 0!==s?s:3,start:e.range.from.unix(),end:e.range.to.unix()}).pipe(fe((e=>({data:qr(e.data.traces,this.instanceSettings,t.traceql[0].tableType)}))),je((e=>(0,q.of)({error:{message:vn(e.data.message)},data:[]}))));var n,s},this.handleTraceQlMetricsQuery=(e,r)=>{const n={query:r,start:e.range.from.unix(),end:e.range.to.unix(),step:e.targets[0].step};return n.step||delete n.step,this._request("/api/metrics/query_range",n).pipe(fe((e=>{return{data:(n=r,s=e.data,s.series.map(((e,r)=>{var a;const i={};null===(a=e.labels)||void 0===a||a.forEach((e=>{i[e.key]=zr(e.value)}));let o=1===s.series.length?n:"";return e.labels&&(o=1===e.labels.length?zr(e.labels[0].value):`{${e.labels.map((e=>`${e.key}=${zr(e.value)}`)).join(", ")}}`),(0,t.createDataFrame)({refId:o||`A${r}`,fields:[{name:"time",type:t.FieldType.time,values:e.samples.map((e=>parseInt(e.timestampMs,10)))},{name:o,labels:i,type:t.FieldType.number,values:e.samples.map((e=>e.value)),config:{displayNameFromDS:o}}],meta:{preferredVisualisationType:"graph"}})})))};var n,s})),je((e=>(0,q.of)({error:{message:vn(e.data.message)},data:[]}))))},this.handleMetricsSummaryQuery=(e,t,n)=>{var s,a,i;if((0,r.reportInteraction)("grafana_traces_metrics_summary_queried",{datasourceType:"tempo",app:null!==(a=n.app)&&void 0!==a?a:"",grafana_version:r.config.buildInfo.version,filterCount:null!==(i=null===(s=e.groupBy)||void 0===s?void 0:s.length)&&void 0!==i?i:0}),"{}"===t)return(0,q.of)({error:{message:"Please ensure you do not have an empty query. This is so filters are applied and the metrics summary is not generated from all spans."},data:Cr});const o=e.groupBy?this.formatGroupBy(e.groupBy):"";return this._request("/api/metrics/summary",{q:t,groupBy:o,start:n.range.from.unix(),end:n.range.to.unix()}).pipe(fe((e=>e.data.summaries?e.data.summaries.some((e=>e.series.length>0))?{data:Sr(e.data.summaries,t,this.instanceSettings)}:{error:{message:vn("No series data. Ensure you are using an up to date version of Tempo")},data:Cr}:{error:{message:vn(`No summary data for '${o}'.`)},data:Cr})),je((e=>(0,q.of)({error:{message:vn(e.data.message)},data:Cr}))))},this.tracesToLogs=e.jsonData.tracesToLogs,this.serviceMap=e.jsonData.serviceMap,this.search=e.jsonData.search,this.nodeGraph=e.jsonData.nodeGraph,this.traceQuery=e.jsonData.traceQuery,this.streamingEnabled=e.jsonData.streamingEnabled,this.languageProvider=new yr(this),(null===(s=this.search)||void 0===s?void 0:s.filters)||(this.search=Pn(Tn({},this.search),{filters:[{id:"service-name",tag:"service.name",operator:"=",scope:O.Resource},{id:"span-name",tag:"name",operator:"=",scope:O.Span}]})),this.variables=new Sn(this)}}function Rn(e,t){return(0,q.from)((0,r.getDataSourceSrv)().get(t)).pipe(Te((t=>t.query(e))))}function Nn(e,t,n,s){var a,i;return{url:"",title:e,internal:{query:{expr:t,range:!s,exemplar:!s,instant:s},datasourceUid:n,datasourceName:null!==(i=null===(a=(0,r.getDataSourceSrv)().getInstanceSettings(n))||void 0===a?void 0:a.name)&&void 0!==i?i:""}}}function In(e,t,r,n,s,a){let i=s?`client="\${${s}}",`:"",o=`server="\${${r}}"`,l="server";if(void 0!==a){const{targetNamespace:e}=a;if(o+=`,server_service_namespace="\${${e}}"`,l+=", server_service_namespace",i){const{sourceNamespace:e}=a;i+=`client_service_namespace="\${${e}}",`,l+=", client_service_namespace"}}return{links:[Nn("Request rate",`sum by (client, ${l})(rate(${ar}{${i}${o}}[$__rate_interval]))`,e,!1),Nn("Request histogram",`histogram_quantile(0.9, sum(rate(${or}{${i}${o}}[$__rate_interval])) by (le, client, ${l}))`,e,!1),Nn("Failed request rate",`sum by (client, ${l})(rate(${ir}{${i}${o}}[$__rate_interval]))`,e,!1),Dn("View traces",void 0!==a?`\${${a.targetNamespace}}`:"",`\${${r}}`,"",t)]}}function Dn(e,t,n,s,a){var i;let o={refId:"A",queryType:"traceqlSearch",filters:[]};var l;return void 0!==t&&""!==t&&o.filters.push({id:"service-namespace",scope:O.Resource,tag:"service.namespace",value:t,operator:"=",valueType:"string"}),""!==n&&o.filters.push({id:"service-name",scope:O.Resource,tag:"service.name",value:n,operator:"=",valueType:"string"}),""!==s&&o.filters.push({id:"span-name",scope:O.Span,tag:"name",value:s,operator:"=",valueType:"string"}),{url:"",title:e,internal:{query:o,datasourceUid:a,datasourceName:null!==(l=null===(i=(0,r.getDataSourceSrv)().getInstanceSettings(a))||void 0===i?void 0:i.name)&&void 0!==l?l:""}}}function $n(e){return Pn(Tn({},e),{targets:gr.map((t=>{const{serviceMapQuery:r,serviceMapIncludeNamespace:n}=e.targets[0],s=n?", client_service_namespace, server_service_namespace":"",a=(Array.isArray(r)?r:[r]).map((e=>`sum by (client, server${s}) (rate(${t}${e||""}[$__range]))`));return{format:"table",refId:t,expr:a.join(" OR "),instant:!0}}))})}function Fn(e,t,r){var n,s;let a=null!==(s=null===(n=r.targets[0])||void 0===n?void 0:n.serviceMapQuery)&&void 0!==s?s:"";const i=(Array.isArray(a)?a:[a]).map((r=>{const n=r.match(/^{(.*)}$/);return(null==n?void 0:n.length)&&(r=n[1]),(r=r.replace("client","service").replace("server","service")).includes("span_name")?e.params.concat(r):e.params.concat(r).concat(t).filter((e=>e))})).map((t=>e.expr.replace("{}","{"+t.join(",")+"}"))).join(" OR ");return e.topk?`topk(${e.topk}, ${i})`:i}function An(e){return(e=e.replace("topk(5, ","").replace(" by (span_name))","")).replace("__range","__rate_interval")}function Qn(e,t){var r,n,s;const a=null!==(s=null===(n=e[0])||void 0===n||null===(r=n.fields[1])||void 0===r?void 0:r.values)&&void 0!==s?s:[];let i=[];for(let e=0;e<a.length;e++)Object.keys(t).includes(a[e])?i.push(t[a[e]].value):i.push("0");return i}function Ln(e){return e.map((e=>({refId:e,expr:e,instant:!0})))}function Wn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Wn(e,t,r[t])}))}return e}function qn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Mn=(e,t)=>{const r=parseInt(e,10);return isNaN(r)?t:r},Vn=i.memo((({onChange:e,query:t,isStreaming:r})=>{t.hasOwnProperty("limit")||(t.limit=_n),t.hasOwnProperty("tableType")||(t.tableType=y.Traces);const a=[`Limit: ${t.limit||_n}`,`Spans Limit: ${t.spss||3}`,"Table Format: "+(t.tableType===y.Traces?"Traces":"Spans"),`Step: ${t.step||"auto"}`,"Streaming: "+(r?"Enabled":"Disabled")];return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(T,{children:(0,n.jsxs)(A,{title:"Options",collapsedInfo:a,children:[(0,n.jsx)(D,{label:"Limit",tooltip:"Maximum number of traces to return.",children:(0,n.jsx)(s.AutoSizeInput,{className:"width-4",placeholder:"auto",type:"number",min:1,defaultValue:t.limit||_n,onCommitChange:r=>{e(qn(zn({},t),{limit:Mn(r.currentTarget.value,_n)}))},value:t.limit})}),(0,n.jsx)(D,{label:"Span Limit",tooltip:"Maximum number of spans to return for each span set.",children:(0,n.jsx)(s.AutoSizeInput,{className:"width-4",placeholder:"auto",type:"number",min:1,defaultValue:t.spss||3,onCommitChange:r=>{e(qn(zn({},t),{spss:Mn(r.currentTarget.value,3)}))},value:t.spss})}),(0,n.jsx)(D,{label:"Table Format",tooltip:"How the query data should be displayed in the results table",children:(0,n.jsx)(s.RadioButtonGroup,{options:[{label:"Traces",value:y.Traces},{label:"Spans",value:y.Spans}],value:t.tableType,onChange:r=>{e(qn(zn({},t),{tableType:r}))}})}),(0,n.jsx)(D,{label:"Step",tooltip:"Defines the step for metric queries. Use duration notation, for example 30s or 1m",children:(0,n.jsx)(s.AutoSizeInput,{className:"width-4",placeholder:"auto",type:"string",defaultValue:t.step,onCommitChange:r=>{e(qn(zn({},t),{step:r.currentTarget.value}))},value:t.step})}),(0,n.jsx)(D,{label:"Streaming",tooltip:(0,n.jsx)(Un,{}),tooltipInteractive:!0,children:(0,n.jsx)("div",{children:r?"Enabled":"Disabled"})})]})})})})),Un=()=>(0,n.jsxs)("div",{style:{display:"flex",gap:"4px"},children:[(0,n.jsx)("span",{children:"Indicates if streaming is currently enabled. Streaming allows you to view partial query results before the entire query completes."}),(0,n.jsx)("a",{href:"https://grafana.com/docs/tempo/latest/traceql/#stream-query-results","aria-label":"Learn more about streaming query results",target:"_blank",rel:"noreferrer",style:{textDecoration:"underline"},children:"Learn more"})]});function Bn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Bn(e,t,r[t])}))}return e}function Xn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}Vn.displayName="TempoQueryBuilderOptions";const Yn=/^(\$\w+)|(\d+(?:\.\d)?\d*(?:us|µs|ns|ms|s|m|h))$/,Jn=()=>({noBoxShadow:(0,a.css)({boxShadow:"none","*:focus":{boxShadow:"none"}})}),Hn=({filter:e,operators:t,updateFilter:r})=>{const a=(0,s.useStyles2)(Jn);let i=!1;return"string"==typeof e.value&&(i=!!e.value&&!Yn.test(e.value.concat(""))),(0,n.jsxs)(s.HorizontalGroup,{spacing:"none",children:[(0,n.jsx)(s.Select,{className:a.noBoxShadow,inputId:`${e.id}-operator`,options:t.map(Lt),value:e.operator,onChange:t=>{r(Xn(Gn({},e),{operator:null==t?void 0:t.value}))},isClearable:!1,"aria-label":`select ${e.id} operator`,allowCustomValue:!0,width:8}),(0,n.jsx)(s.Input,{className:a.noBoxShadow,value:e.value,onChange:t=>{r(Xn(Gn({},e),{value:t.currentTarget.value}))},placeholder:"e.g. 100ms, 1.2s","aria-label":`select ${e.id} value`,invalid:i,width:18})]})},Zn=({label:e,tooltip:t,children:r})=>(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{label:e,labelWidth:28,grow:!0,tooltip:t,children:r})});function Kn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function es(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Kn(e,t,r[t])}))}return e}function ts(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const rs=e=>{var t;const{datasource:r,onChange:a,query:o,isTagsLoading:l,addVariablesToOptions:c}=e,u=(0,s.useStyles2)(ns),p=()=>Zr().slice(0,8),[g,d]=(0,i.useState)("");(0,i.useEffect)((()=>{o.groupBy&&0!==o.groupBy.length||a(ts(es({},o),{groupBy:[{id:p(),scope:O.Span}]}))}),[a,o]);const h=(0,i.useMemo)((()=>e=>{const t=r.languageProvider.getMetricsSummaryTags(e.scope);if(0===g.length)return t.slice(0,Gt);const n=g.toLowerCase();return t.filter((e=>e.toLowerCase().includes(n))).slice(0,Gt)}),[r,g]),f=e=>{var t;const r=es({},o);(t=r).groupBy||(t.groupBy=[]);const n=r.groupBy.findIndex((t=>t.id===e.id));n>=0?r.groupBy=Qt(r.groupBy,n,e):r.groupBy.push(e),a(r)},m=Object.values(O).map((e=>({label:e,value:e})));return(0,n.jsx)(Zn,{label:"Aggregate by",tooltip:"Select one or more tags to see the metrics summary.",children:(0,n.jsx)(n.Fragment,{children:null===(t=o.groupBy)||void 0===t?void 0:t.map(((e,t)=>{var r,i,g,v;const y=null===(i=h(e))||void 0===i?void 0:i.concat(void 0===e.tag||(null===(r=h(e))||void 0===r?void 0:r.includes(e.tag))?[]:[e.tag]).map((e=>({label:e,value:e})));var b,S;return(0,n.jsx)("div",{children:(0,n.jsxs)(s.HorizontalGroup,{spacing:"none",width:"auto",children:[(0,n.jsx)(s.Select,{"aria-label":`Select scope for filter ${t+1}`,onChange:t=>{f(ts(es({},e),{scope:null==t?void 0:t.value,tag:""}))},options:m,placeholder:"Select scope",value:e.scope}),(0,n.jsx)(s.Select,{"aria-label":`Select tag for filter ${t+1}`,isClearable:!0,allowCustomValue:!0,isLoading:l,onChange:t=>{f(ts(es({},e),{tag:null==t?void 0:t.value}))},options:c?Bt(y):y,onInputChange:(e,{action:t})=>{"input-change"===t&&d(e)},onCloseMenu:()=>d(""),placeholder:"Select tag",value:e.tag||""},e.tag),(e.tag||(null!==(b=null===(g=o.groupBy)||void 0===g?void 0:g.length)&&void 0!==b?b:0)>1)&&(0,n.jsx)(pn,{"aria-label":`Remove tag for filter ${t+1}`,icon:"times",onClick:()=>(e=>{var t;a(ts(es({},o),{groupBy:null===(t=o.groupBy)||void 0===t?void 0:t.filter((t=>t.id!==e.id))}))})(e),tooltip:"Remove tag",title:`Remove tag for filter ${t+1}`,variant:"secondary"}),e.tag&&t===(null!==(S=null===(v=o.groupBy)||void 0===v?void 0:v.length)&&void 0!==S?S:0)-1&&(0,n.jsx)("span",{className:u.addTag,children:(0,n.jsx)(pn,{"aria-label":"Add tag",icon:"plus",onClick:()=>{f({id:p(),scope:O.Span})},tooltip:"Add tag",variant:"secondary"})})]})},e.id)}))})})},ns=e=>({addTag:(0,a.css)({marginLeft:e.spacing(1)})});function ss(e,t,r,n,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,s)}function as(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function is(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){as(e,t,r[t])}))}return e}function os(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ls=["min-duration","max-duration","status"],cs=({datasource:e,query:t,onChange:a,onClearResults:o,app:l,addVariablesToOptions:u=!0})=>{var p,g,d,h,m,v;const y=(0,s.useStyles2)(us),[b,S]=(0,i.useState)(),[x,w]=(0,i.useState)(null),[j,T]=(0,i.useState)(!0),[P,_]=(0,i.useState)(""),E=(0,r.getTemplateSrv)(),k=(0,i.useCallback)((e=>{var r;const n=is({},t);(r=n).filters||(r.filters=[]);const s=n.filters.findIndex((t=>t.id===e.id));s>=0?n.filters=Qt(n.filters,s,e):n.filters.push(e),a(n)}),[a,t]),C=(0,r.getTemplateSrv)().getVariables();(0,i.useEffect)((()=>{_(Ct(kt(t.filters||[])))}),[t,C]);const R=(0,i.useCallback)((e=>{var r;return null===(r=t.filters)||void 0===r?void 0:r.find((t=>t.id===e))}),[t.filters]);(0,i.useEffect)((()=>{const t=(r=function*(){try{yield e.languageProvider.start(),T(!1),S(void 0)}catch(e){e instanceof Error&&S(`Error: ${e.message}`)}},n=function(){var e=this,t=arguments;return new Promise((function(n,s){var a=r.apply(e,t);function i(e){ss(a,n,s,i,o,"next",e)}function o(e){ss(a,n,s,i,o,"throw",e)}i(void 0)}))},function(){return n.apply(this,arguments)});var r,n;t()}),[e,S]),(0,i.useEffect)((()=>{var t,r;null===(r=e.search)||void 0===r||null===(t=r.filters)||void 0===t||t.filter((e=>e.value)).forEach((e=>{R(e.id)||k(e)}))}),[null===(p=e.search)||void 0===p?void 0:p.filters,R,k]);const N=(null===(d=e.search)||void 0===d||null===(g=d.filters)||void 0===g?void 0:g.map((e=>e.tag)))||[];N.push("duration"),N.push("traceDuration");const I=(t.filters||[]).filter((t=>{var r,n;return!ls.includes(t.id)&&-1===((null===(n=e.search)||void 0===n||null===(r=n.filters)||void 0===r?void 0:r.findIndex((e=>e.id===t.id)))||0)&&"duration-type"!==t.id}));var D,$;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:y.container,children:[(0,n.jsxs)("div",{children:[null===(m=e.search)||void 0===m||null===(h=m.filters)||void 0===h?void 0:h.map((t=>t.tag&&(0,n.jsx)(Zn,{label:$t(t),tooltip:`Filter your search by ${Dt(t)}. To modify the default filters shown for search visit the Tempo datasource configuration page.`,children:(0,n.jsx)(Xt,{filter:R(t.id)||t,datasource:e,setError:w,updateFilter:k,tags:[],hideScope:!0,hideTag:!0,query:P,addVariablesToOptions:u})},t.id))),(0,n.jsx)(Zn,{label:"Status",children:(0,n.jsx)(Xt,{filter:R("status")||{id:"status",tag:"status",scope:O.Intrinsic,operator:"="},datasource:e,setError:w,updateFilter:k,tags:[],hideScope:!0,hideTag:!0,query:P,isMulti:!1,allowCustomValue:!1,addVariablesToOptions:u})}),(0,n.jsx)(Zn,{label:"Duration",tooltip:"The trace or span duration, i.e. end - start time of the trace/span. Accepted units are ns, ms, s, m, h",children:(0,n.jsxs)(s.HorizontalGroup,{spacing:"none",children:[(0,n.jsx)(s.Select,{options:[{label:"span",value:"span"},{label:"trace",value:"trace"}],value:null!==(D=null===(v=R("duration-type"))||void 0===v?void 0:v.value)&&void 0!==D?D:"span",onChange:e=>{const t=R("duration-type")||{id:"duration-type",value:"span"};k(os(is({},t),{value:null==e?void 0:e.value}))},"aria-label":"duration type"}),(0,n.jsx)(Hn,{filter:R("min-duration")||{id:"min-duration",tag:"duration",operator:">",valueType:"duration"},operators:[">",">="],updateFilter:k}),(0,n.jsx)(Hn,{filter:R("max-duration")||{id:"max-duration",tag:"duration",operator:"<",valueType:"duration"},operators:["<","<="],updateFilter:k})]})}),(0,n.jsx)(Zn,{label:"Tags",children:(0,n.jsx)(hn,{filters:I,datasource:e,setError:w,updateFilter:k,deleteFilter:e=>{a(os(is({},t),{filters:t.filters.filter((t=>t.id!==e.id))}))},staticTags:N,isTagsLoading:j,query:P,requireTagAndValue:!0,addVariablesToOptions:u})}),r.config.featureToggles.metricsSummary&&(0,n.jsx)(rs,{datasource:e,onChange:a,query:t,isTagsLoading:j,addVariablesToOptions:u})]}),(0,n.jsxs)("div",{className:y.rawQueryContainer,children:[(0,n.jsx)(f,{query:E.replace(P),lang:{grammar:_t,name:"traceql"}}),(0,n.jsx)(s.Button,{variant:"secondary",size:"sm",onClick:()=>{(0,r.reportInteraction)("grafana_traces_copy_to_traceql_clicked",{app:null!=l?l:"",grafana_version:r.config.buildInfo.version,location:"search_tab"}),o();const e=Ct(t.filters||[]);a(os(is({},t),{query:e,queryType:"traceql"}))},children:"Edit in TraceQL"})]}),(0,n.jsx)(Vn,{onChange:a,query:t,isStreaming:null!==($=e.isStreamingSearchEnabled())&&void 0!==$&&$})]}),x?(0,n.jsxs)(s.Alert,{title:"Unable to connect to Tempo search",severity:"info",className:y.alert,children:["Please ensure that Tempo is configured with search enabled. If you would like to hide this tab, you can configure it in the ",(0,n.jsx)("a",{href:`/datasources/edit/${e.uid}`,children:"datasource settings"}),"."]}):null,b&&(0,n.jsx)(c,{severity:"error",text:b})]})},us=e=>({alert:(0,a.css)({maxWidth:"75ch",marginTop:e.spacing(2)}),container:(0,a.css)({display:"flex",gap:"4px",flexWrap:"wrap",flexDirection:"column"}),rawQueryContainer:(0,a.css)({alignItems:"center",backgroundColor:e.colors.background.secondary,display:"flex",justifyContent:"space-between",padding:e.spacing(1)})}),ps={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console&&console[e]&&console[e].apply(console,t)}};class gs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||ps,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,r,n){return n&&!this.debug?null:("string"==typeof e[0]&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new gs(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new gs(this.logger,e)}}var ds=new gs;class hs{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach((e=>{this.observers[e]||(this.observers[e]=new Map);const r=this.observers[e].get(t)||0;this.observers[e].set(t,r+1)})),this}off(e,t){this.observers[e]&&(t?this.observers[e].delete(t):delete this.observers[e])}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.observers[e]&&Array.from(this.observers[e].entries()).forEach((e=>{let[t,n]=e;for(let e=0;e<n;e++)t(...r)})),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach((t=>{let[n,s]=t;for(let t=0;t<s;t++)n.apply(n,[e,...r])}))}}const fs=()=>{let e,t;const r=new Promise(((r,n)=>{e=r,t=n}));return r.resolve=e,r.reject=t,r},ms=e=>null==e?"":""+e,vs=/###/g,ys=e=>e&&e.indexOf("###")>-1?e.replace(vs,"."):e,Os=e=>!e||"string"==typeof e,bs=(e,t,r)=>{const n="string"!=typeof t?t:t.split(".");let s=0;for(;s<n.length-1;){if(Os(e))return{};const t=ys(n[s]);!e[t]&&r&&(e[t]=new r),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++s}return Os(e)?{}:{obj:e,k:ys(n[s])}},Ss=(e,t,r)=>{const{obj:n,k:s}=bs(e,t,Object);if(void 0!==n||1===t.length)return void(n[s]=r);let a=t[t.length-1],i=t.slice(0,t.length-1),o=bs(e,i,Object);for(;void 0===o.obj&&i.length;)a=`${i[i.length-1]}.${a}`,i=i.slice(0,i.length-1),o=bs(e,i,Object),o&&o.obj&&void 0!==o.obj[`${o.k}.${a}`]&&(o.obj=void 0);o.obj[`${o.k}.${a}`]=r},xs=(e,t)=>{const{obj:r,k:n}=bs(e,t);if(r)return r[n]},ws=(e,t,r)=>{for(const n in t)"__proto__"!==n&&"constructor"!==n&&(n in e?"string"==typeof e[n]||e[n]instanceof String||"string"==typeof t[n]||t[n]instanceof String?r&&(e[n]=t[n]):ws(e[n],t[n],r):e[n]=t[n]);return e},js=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var Ts={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const Ps=e=>"string"==typeof e?e.replace(/[&<>"'\/]/g,(e=>Ts[e])):e,_s=[" ",",","?","!",";"],Es=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}(20),ks=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!e)return;if(e[t])return e[t];const n=t.split(r);let s=e;for(let e=0;e<n.length;){if(!s||"object"!=typeof s)return;let t,a="";for(let i=e;i<n.length;++i)if(i!==e&&(a+=r),a+=n[i],t=s[a],void 0!==t){if(["string","number","boolean"].indexOf(typeof t)>-1&&i<n.length-1)continue;e+=i-e+1;break}s=t}return s},Cs=e=>e&&e.indexOf("_")>0?e.replace("_","-"):e;class Rs extends hs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,a=void 0!==n.ignoreJSONStructure?n.ignoreJSONStructure:this.options.ignoreJSONStructure;let i;e.indexOf(".")>-1?i=e.split("."):(i=[e,t],r&&(Array.isArray(r)?i.push(...r):"string"==typeof r&&s?i.push(...r.split(s)):i.push(r)));const o=xs(this.data,i);return!o&&!t&&!r&&e.indexOf(".")>-1&&(e=i[0],t=i[1],r=i.slice(2).join(".")),o||!a||"string"!=typeof r?o:ks(this.data&&this.data[e]&&this.data[e][t],r,s)}addResource(e,t,r,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1};const a=void 0!==s.keySeparator?s.keySeparator:this.options.keySeparator;let i=[e,t];r&&(i=i.concat(a?r.split(a):r)),e.indexOf(".")>-1&&(i=e.split("."),n=t,t=i[1]),this.addNamespaces(t),Ss(this.data,i,n),s.silent||this.emit("added",e,t,r,n)}addResources(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(const n in r)("string"==typeof r[n]||Array.isArray(r[n]))&&this.addResource(e,t,n,r[n],{silent:!0});n.silent||this.emit("added",e,t,r)}addResourceBundle(e,t,r,n,s){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1,skipCopy:!1},i=[e,t];e.indexOf(".")>-1&&(i=e.split("."),n=r,r=t,t=i[1]),this.addNamespaces(t);let o=xs(this.data,i)||{};a.skipCopy||(r=JSON.parse(JSON.stringify(r))),n?ws(o,r,s):o={...o,...r},Ss(this.data,i,o),a.silent||this.emit("added",e,t,r)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?{...this.getResource(e,t)}:this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((e=>t[e]&&Object.keys(t[e]).length>0))}toJSON(){return this.data}}var Ns={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,r,n,s){return e.forEach((e=>{this.processors[e]&&(t=this.processors[e].process(t,r,n,s))})),t}};const Is={};class Ds extends hs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r,n;super(),r=e,n=this,["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"].forEach((e=>{r[e]&&(n[e]=r[e])})),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=ds.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;const r=this.resolve(e,t);return r&&void 0!==r.res}extractFromKey(e,t){let r=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===r&&(r=":");const n=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let s=t.ns||this.options.defaultNS||[];const a=r&&e.indexOf(r)>-1,i=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,r)=>{t=t||"",r=r||"";const n=_s.filter((e=>t.indexOf(e)<0&&r.indexOf(e)<0));if(0===n.length)return!0;const s=Es.getRegExp(`(${n.map((e=>"?"===e?"\\?":e)).join("|")})`);let a=!s.test(e);if(!a){const t=e.indexOf(r);t>0&&!s.test(e.substring(0,t))&&(a=!0)}return a})(e,r,n));if(a&&!i){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:s};const a=e.split(r);(r!==n||r===n&&this.options.ns.indexOf(a[0])>-1)&&(s=a.shift()),e=a.join(n)}return"string"==typeof s&&(s=[s]),{key:e,namespaces:s}}translate(e,t,r){if("object"!=typeof t&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof t&&(t={...t}),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const n=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,s=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,{key:a,namespaces:i}=this.extractFromKey(e[e.length-1],t),o=i[i.length-1],l=t.lng||this.language,c=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(l&&"cimode"===l.toLowerCase()){if(c){const e=t.nsSeparator||this.options.nsSeparator;return n?{res:`${o}${e}${a}`,usedKey:a,exactUsedKey:a,usedLng:l,usedNS:o,usedParams:this.getUsedParamsDetails(t)}:`${o}${e}${a}`}return n?{res:a,usedKey:a,exactUsedKey:a,usedLng:l,usedNS:o,usedParams:this.getUsedParamsDetails(t)}:a}const u=this.resolve(e,t);let p=u&&u.res;const g=u&&u.usedKey||a,d=u&&u.exactUsedKey||a,h=Object.prototype.toString.apply(p),f=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,m=!this.i18nFormat||this.i18nFormat.handleAsObject;if(m&&p&&"string"!=typeof p&&"boolean"!=typeof p&&"number"!=typeof p&&["[object Number]","[object Function]","[object RegExp]"].indexOf(h)<0&&("string"!=typeof f||!Array.isArray(p))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(g,p,{...t,ns:i}):`key '${a} (${this.language})' returned an object instead of string.`;return n?(u.res=e,u.usedParams=this.getUsedParamsDetails(t),u):e}if(s){const e=Array.isArray(p),r=e?[]:{},n=e?d:g;for(const e in p)if(Object.prototype.hasOwnProperty.call(p,e)){const a=`${n}${s}${e}`;r[e]=this.translate(a,{...t,joinArrays:!1,ns:i}),r[e]===a&&(r[e]=p[e])}p=r}}else if(m&&"string"==typeof f&&Array.isArray(p))p=p.join(f),p&&(p=this.extendTranslation(p,e,t,r));else{let n=!1,i=!1;const c=void 0!==t.count&&"string"!=typeof t.count,g=Ds.hasDefaultValue(t),d=c?this.pluralResolver.getSuffix(l,t.count,t):"",h=t.ordinal&&c?this.pluralResolver.getSuffix(l,t.count,{ordinal:!1}):"",f=c&&!t.ordinal&&0===t.count&&this.pluralResolver.shouldUseIntlApi(),m=f&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${d}`]||t[`defaultValue${h}`]||t.defaultValue;!this.isValidLookup(p)&&g&&(n=!0,p=m),this.isValidLookup(p)||(i=!0,p=a);const v=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&i?void 0:p,y=g&&m!==p&&this.options.updateMissing;if(i||n||y){if(this.logger.log(y?"updateKey":"missingKey",l,o,a,y?m:p),s){const e=this.resolve(a,{...t,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const r=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&r&&r[0])for(let t=0;t<r.length;t++)e.push(r[t]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(t.lng||this.language):e.push(t.lng||this.language);const n=(e,r,n)=>{const s=g&&n!==p?n:v;this.options.missingKeyHandler?this.options.missingKeyHandler(e,o,r,s,y,t):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(e,o,r,s,y,t),this.emit("missingKey",e,o,r,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&c?e.forEach((e=>{const r=this.pluralResolver.getSuffixes(e,t);f&&t[`defaultValue${this.options.pluralSeparator}zero`]&&r.indexOf(`${this.options.pluralSeparator}zero`)<0&&r.push(`${this.options.pluralSeparator}zero`),r.forEach((r=>{n([e],a+r,t[`defaultValue${r}`]||m)}))})):n(e,a,m))}p=this.extendTranslation(p,e,t,u,r),i&&p===a&&this.options.appendNamespaceToMissingKey&&(p=`${o}:${a}`),(i||n)&&this.options.parseMissingKeyHandler&&(p="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${o}:${a}`:a,n?p:void 0):this.options.parseMissingKeyHandler(p))}return n?(u.res=p,u.usedParams=this.getUsedParamsDetails(t),u):p}extendTranslation(e,t,r,n,s){var a=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const i="string"==typeof e&&(r&&r.interpolation&&void 0!==r.interpolation.skipOnVariables?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let o;if(i){const t=e.match(this.interpolator.nestingRegexp);o=t&&t.length}let l=r.replace&&"string"!=typeof r.replace?r.replace:r;if(this.options.interpolation.defaultVariables&&(l={...this.options.interpolation.defaultVariables,...l}),e=this.interpolator.interpolate(e,l,r.lng||this.language||n.usedLng,r),i){const t=e.match(this.interpolator.nestingRegexp);o<(t&&t.length)&&(r.nest=!1)}!r.lng&&"v1"!==this.options.compatibilityAPI&&n&&n.res&&(r.lng=this.language||n.usedLng),!1!==r.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return s&&s[0]===n[0]&&!r.context?(a.logger.warn(`It seems you are nesting recursively key: ${n[0]} in key: ${t[0]}`),null):a.translate(...n,t)}),r)),r.interpolation&&this.interpolator.reset()}const i=r.postProcess||this.options.postProcess,o="string"==typeof i?[i]:i;return null!=e&&o&&o.length&&!1!==r.applyPostProcessor&&(e=Ns.handle(o,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...n,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e){let t,r,n,s,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((e=>{if(this.isValidLookup(t))return;const o=this.extractFromKey(e,i),l=o.key;r=l;let c=o.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const u=void 0!==i.count&&"string"!=typeof i.count,p=u&&!i.ordinal&&0===i.count&&this.pluralResolver.shouldUseIntlApi(),g=void 0!==i.context&&("string"==typeof i.context||"number"==typeof i.context)&&""!==i.context,d=i.lngs?i.lngs:this.languageUtils.toResolveHierarchy(i.lng||this.language,i.fallbackLng);c.forEach((e=>{this.isValidLookup(t)||(a=e,!Is[`${d[0]}-${e}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(a)&&(Is[`${d[0]}-${e}`]=!0,this.logger.warn(`key "${r}" for languages "${d.join(", ")}" won't get resolved as namespace "${a}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),d.forEach((r=>{if(this.isValidLookup(t))return;s=r;const a=[l];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(a,l,r,e,i);else{let e;u&&(e=this.pluralResolver.getSuffix(r,i.count,i));const t=`${this.options.pluralSeparator}zero`,n=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(u&&(a.push(l+e),i.ordinal&&0===e.indexOf(n)&&a.push(l+e.replace(n,this.options.pluralSeparator)),p&&a.push(l+t)),g){const r=`${l}${this.options.contextSeparator}${i.context}`;a.push(r),u&&(a.push(r+e),i.ordinal&&0===e.indexOf(n)&&a.push(r+e.replace(n,this.options.pluralSeparator)),p&&a.push(r+t))}}let o;for(;o=a.pop();)this.isValidLookup(t)||(n=o,t=this.getResource(r,e,o,i))})))}))})),{res:t,usedKey:r,exactUsedKey:n,usedLng:s,usedNS:a}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,r,n):this.resourceStore.getResource(e,t,r,n)}getUsedParamsDetails(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&"string"!=typeof e.replace;let n=r?e.replace:e;if(r&&void 0!==e.count&&(n.count=e.count),this.options.interpolation.defaultVariables&&(n={...this.options.interpolation.defaultVariables,...n}),!r){n={...n};for(const e of t)delete n[e]}return n}static hasDefaultValue(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&"defaultValue"===t.substring(0,12)&&void 0!==e[t])return!0;return!1}}const $s=e=>e.charAt(0).toUpperCase()+e.slice(1);class Fs{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=ds.create("languageUtils")}getScriptPartFromCode(e){if(!(e=Cs(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}getLanguagePartFromCode(e){if(!(e=Cs(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if("string"==typeof e&&e.indexOf("-")>-1){const t=["hans","hant","latn","cyrl","cans","mong","arab"];let r=e.split("-");return this.options.lowerCaseLng?r=r.map((e=>e.toLowerCase())):2===r.length?(r[0]=r[0].toLowerCase(),r[1]=r[1].toUpperCase(),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=$s(r[1].toLowerCase()))):3===r.length&&(r[0]=r[0].toLowerCase(),2===r[1].length&&(r[1]=r[1].toUpperCase()),"sgn"!==r[0]&&2===r[2].length&&(r[2]=r[2].toUpperCase()),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=$s(r[1].toLowerCase())),t.indexOf(r[2].toLowerCase())>-1&&(r[2]=$s(r[2].toLowerCase()))),r.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach((e=>{if(t)return;const r=this.formatLanguageCode(e);this.options.supportedLngs&&!this.isSupportedCode(r)||(t=r)})),!t&&this.options.supportedLngs&&e.forEach((e=>{if(t)return;const r=this.getLanguagePartFromCode(e);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find((e=>e===r?e:e.indexOf("-")<0&&r.indexOf("-")<0?void 0:e.indexOf("-")>0&&r.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===r||0===e.indexOf(r)&&r.length>1?e:void 0))})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e[this.getLanguagePartFromCode(t)]),r||(r=e.default),r||[]}toResolveHierarchy(e,t){const r=this.getFallbackCodes(t||this.options.fallbackLng||[],e),n=[],s=e=>{e&&(this.isSupportedCode(e)?n.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return"string"==typeof e&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&s(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&s(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&s(this.getLanguagePartFromCode(e))):"string"==typeof e&&s(this.formatLanguageCode(e)),r.forEach((e=>{n.indexOf(e)<0&&s(this.formatLanguageCode(e))})),n}}let As=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],Qs={1:e=>Number(e>1),2:e=>Number(1!=e),3:e=>0,4:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2),5:e=>Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5),6:e=>Number(1==e?0:e>=2&&e<=4?1:2),7:e=>Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2),8:e=>Number(1==e?0:2==e?1:8!=e&&11!=e?2:3),9:e=>Number(e>=2),10:e=>Number(1==e?0:2==e?1:e<7?2:e<11?3:4),11:e=>Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3),12:e=>Number(e%10!=1||e%100==11),13:e=>Number(0!==e),14:e=>Number(1==e?0:2==e?1:3==e?2:3),15:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2),16:e=>Number(e%10==1&&e%100!=11?0:0!==e?1:2),17:e=>Number(1==e||e%10==1&&e%100!=11?0:1),18:e=>Number(0==e?0:1==e?1:2),19:e=>Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3),20:e=>Number(1==e?0:0==e||e%100>0&&e%100<20?1:2),21:e=>Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0),22:e=>Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)};const Ls=["v1","v2","v3"],Ws=["v4"],zs={zero:0,one:1,two:2,few:3,many:4,other:5};class qs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=ds.create("pluralResolver"),this.options.compatibilityJSON&&!Ws.includes(this.options.compatibilityJSON)||"undefined"!=typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=(()=>{const e={};return As.forEach((t=>{t.lngs.forEach((r=>{e[r]={numbers:t.nr,plurals:Qs[t.fc]}}))})),e})(),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi())try{const r=Cs("dev"===e?"en":e),n=t.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:r,type:n});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];const a=new Intl.PluralRules(r,{type:n});return this.pluralRulesCache[s]=a,a}catch(e){return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=this.getRule(e,t);return this.shouldUseIntlApi()?r&&r.resolvedOptions().pluralCategories.length>1:r&&r.numbers.length>1}getPluralFormsOfKey(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,r).map((e=>`${t}${e}`))}getSuffixes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=this.getRule(e,t);return r?this.shouldUseIntlApi()?r.resolvedOptions().pluralCategories.sort(((e,t)=>zs[e]-zs[t])).map((e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`)):r.numbers.map((r=>this.getSuffix(e,r,t))):[]}getSuffix(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=this.getRule(e,r);return n?this.shouldUseIntlApi()?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${n.select(t)}`:this.getSuffixRetroCompatible(n,t):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,t){const r=e.noAbs?e.plurals(t):e.plurals(Math.abs(t));let n=e.numbers[r];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===n?n="plural":1===n&&(n=""));const s=()=>this.options.prepend&&n.toString()?this.options.prepend+n.toString():n.toString();return"v1"===this.options.compatibilityJSON?1===n?"":"number"==typeof n?`_plural_${n.toString()}`:s():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?s():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}shouldUseIntlApi(){return!Ls.includes(this.options.compatibilityJSON)}}const Ms=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=((e,t,r)=>{const n=xs(e,r);return void 0!==n?n:xs(t,r)})(e,t,r);return!a&&s&&"string"==typeof r&&(a=ks(e,r,n),void 0===a&&(a=ks(t,r,n))),a},Vs=e=>e.replace(/\$/g,"$$$$");class Us{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=ds.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(e=>e),this.init(e)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:r,useRawValueToEscape:n,prefix:s,prefixEscaped:a,suffix:i,suffixEscaped:o,formatSeparator:l,unescapeSuffix:c,unescapePrefix:u,nestingPrefix:p,nestingPrefixEscaped:g,nestingSuffix:d,nestingSuffixEscaped:h,nestingOptionsSeparator:f,maxReplaces:m,alwaysFormat:v}=e.interpolation;this.escape=void 0!==t?t:Ps,this.escapeValue=void 0===r||r,this.useRawValueToEscape=void 0!==n&&n,this.prefix=s?js(s):a||"{{",this.suffix=i?js(i):o||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":u||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=p?js(p):g||js("$t("),this.nestingSuffix=d?js(d):h||js(")"),this.nestingOptionsSeparator=f||",",this.maxReplaces=m||1e3,this.alwaysFormat=void 0!==v&&v,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>e&&e.source===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,r,n){let s,a,i;const o=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=e=>{if(e.indexOf(this.formatSeparator)<0){const s=Ms(t,o,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(s,void 0,r,{...n,...t,interpolationkey:e}):s}const s=e.split(this.formatSeparator),a=s.shift().trim(),i=s.join(this.formatSeparator).trim();return this.format(Ms(t,o,a,this.options.keySeparator,this.options.ignoreJSONStructure),i,r,{...n,...t,interpolationkey:a})};this.resetRegExp();const c=n&&n.missingInterpolationHandler||this.options.missingInterpolationHandler,u=n&&n.interpolation&&void 0!==n.interpolation.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>Vs(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?Vs(this.escape(e)):Vs(e)}].forEach((t=>{for(i=0;s=t.regex.exec(e);){const r=s[1].trim();if(a=l(r),void 0===a)if("function"==typeof c){const t=c(e,s,n);a="string"==typeof t?t:""}else if(n&&Object.prototype.hasOwnProperty.call(n,r))a="";else{if(u){a=s[0];continue}this.logger.warn(`missed to pass in variable ${r} for interpolating ${e}`),a=""}else"string"==typeof a||this.useRawValueToEscape||(a=ms(a));const o=t.safeValue(a);if(e=e.replace(s[0],o),u?(t.regex.lastIndex+=a.length,t.regex.lastIndex-=s[0].length):t.regex.lastIndex=0,i++,i>=this.maxReplaces)break}})),e}nest(e,t){let r,n,s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=(e,t)=>{const r=this.nestingOptionsSeparator;if(e.indexOf(r)<0)return e;const n=e.split(new RegExp(`${r}[ ]*{`));let a=`{${n[1]}`;e=n[0],a=this.interpolate(a,s);const i=a.match(/'/g),o=a.match(/"/g);(i&&i.length%2==0&&!o||o.length%2!=0)&&(a=a.replace(/'/g,'"'));try{s=JSON.parse(a),t&&(s={...t,...s})}catch(t){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,t),`${e}${r}${a}`}return s.defaultValue&&s.defaultValue.indexOf(this.prefix)>-1&&delete s.defaultValue,e};for(;r=this.nestingRegexp.exec(e);){let o=[];s={...a},s=s.replace&&"string"!=typeof s.replace?s.replace:s,s.applyPostProcessor=!1,delete s.defaultValue;let l=!1;if(-1!==r[0].indexOf(this.formatSeparator)&&!/{.*}/.test(r[1])){const e=r[1].split(this.formatSeparator).map((e=>e.trim()));r[1]=e.shift(),o=e,l=!0}if(n=t(i.call(this,r[1].trim(),s),s),n&&r[0]===e&&"string"!=typeof n)return n;"string"!=typeof n&&(n=ms(n)),n||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),n=""),l&&(n=o.reduce(((e,t)=>this.format(e,t,a.lng,{...a,interpolationkey:r[1].trim()})),n.trim())),e=e.replace(r[0],n),this.regexp.lastIndex=0}return e}}const Bs=e=>{const t={};return(r,n,s)=>{let a=s;s&&s.interpolationkey&&s.formatParams&&s.formatParams[s.interpolationkey]&&s[s.interpolationkey]&&(a={...a,[s.interpolationkey]:void 0});const i=n+JSON.stringify(a);let o=t[i];return o||(o=e(Cs(n),s),t[i]=o),o(r)}};class Gs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=ds.create("formatter"),this.options=e,this.formats={number:Bs(((e,t)=>{const r=new Intl.NumberFormat(e,{...t});return e=>r.format(e)})),currency:Bs(((e,t)=>{const r=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>r.format(e)})),datetime:Bs(((e,t)=>{const r=new Intl.DateTimeFormat(e,{...t});return e=>r.format(e)})),relativetime:Bs(((e,t)=>{const r=new Intl.RelativeTimeFormat(e,{...t});return e=>r.format(e,t.range||"day")})),list:Bs(((e,t)=>{const r=new Intl.ListFormat(e,{...t});return e=>r.format(e)}))},this.init(e)}init(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=Bs(t)}format(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=t.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find((e=>e.indexOf(")")>-1))){const e=s.findIndex((e=>e.indexOf(")")>-1));s[0]=[s[0],...s.splice(1,e)].join(this.formatSeparator)}return s.reduce(((e,t)=>{const{formatName:s,formatOptions:a}=(e=>{let t=e.toLowerCase().trim();const r={};if(e.indexOf("(")>-1){const n=e.split("(");t=n[0].toLowerCase().trim();const s=n[1].substring(0,n[1].length-1);"currency"===t&&s.indexOf(":")<0?r.currency||(r.currency=s.trim()):"relativetime"===t&&s.indexOf(":")<0?r.range||(r.range=s.trim()):s.split(";").forEach((e=>{if(e){const[t,...n]=e.split(":"),s=n.join(":").trim().replace(/^'+|'+$/g,""),a=t.trim();r[a]||(r[a]=s),"false"===s&&(r[a]=!1),"true"===s&&(r[a]=!0),isNaN(s)||(r[a]=parseInt(s,10))}}))}return{formatName:t,formatOptions:r}})(t);if(this.formats[s]){let t=e;try{const i=n&&n.formatParams&&n.formatParams[n.interpolationkey]||{},o=i.locale||i.lng||n.locale||n.lng||r;t=this.formats[s](e,o,{...a,...n,...i})}catch(e){this.logger.warn(e)}return t}return this.logger.warn(`there was no format function for ${s}`),e}),e)}}class Xs extends hs{constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=r,this.languageUtils=r.languageUtils,this.options=n,this.logger=ds.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=n.maxParallelReads||10,this.readingCalls=0,this.maxRetries=n.maxRetries>=0?n.maxRetries:5,this.retryTimeout=n.retryTimeout>=1?n.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(r,n.backend,n)}queueLoad(e,t,r,n){const s={},a={},i={},o={};return e.forEach((e=>{let n=!0;t.forEach((t=>{const i=`${e}|${t}`;!r.reload&&this.store.hasResourceBundle(e,t)?this.state[i]=2:this.state[i]<0||(1===this.state[i]?void 0===a[i]&&(a[i]=!0):(this.state[i]=1,n=!1,void 0===a[i]&&(a[i]=!0),void 0===s[i]&&(s[i]=!0),void 0===o[t]&&(o[t]=!0)))})),n||(i[e]=!0)})),(Object.keys(s).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(s),pending:Object.keys(a),toLoadLanguages:Object.keys(i),toLoadNamespaces:Object.keys(o)}}loaded(e,t,r){const n=e.split("|"),s=n[0],a=n[1];t&&this.emit("failedLoading",s,a,t),!t&&r&&this.store.addResourceBundle(s,a,r,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&r&&(this.state[e]=0);const i={};this.queue.forEach((r=>{((e,t,r,n)=>{const{obj:s,k:a}=bs(e,t,Object);s[a]=s[a]||[],s[a].push(r)})(r.loaded,[s],a),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(r,e),t&&r.errors.push(t),0!==r.pendingCount||r.done||(Object.keys(r.loaded).forEach((e=>{i[e]||(i[e]={});const t=r.loaded[e];t.length&&t.forEach((t=>{void 0===i[e][t]&&(i[e][t]=!0)}))})),r.done=!0,r.errors.length?r.callback(r.errors):r.callback())})),this.emit("loaded",i),this.queue=this.queue.filter((e=>!e.done))}read(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,a=arguments.length>5?arguments[5]:void 0;if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:r,tried:n,wait:s,callback:a});this.readingCalls++;const i=(i,o)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}i&&o&&n<this.maxRetries?setTimeout((()=>{this.read.call(this,e,t,r,n+1,2*s,a)}),s):a(i,o)},o=this.backend[r].bind(this.backend);if(2!==o.length)return o(e,t,i);try{const r=o(e,t);r&&"function"==typeof r.then?r.then((e=>i(null,e))).catch(i):i(null,r)}catch(e){i(e)}}prepareLoading(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);const s=this.queueLoad(e,t,r,n);if(!s.toLoad.length)return s.pending.length||n(),null;s.toLoad.forEach((e=>{this.loadOne(e)}))}load(e,t,r){this.prepareLoading(e,t,{},r)}reload(e,t,r){this.prepareLoading(e,t,{reload:!0},r)}loadOne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const r=e.split("|"),n=r[0],s=r[1];this.read(n,s,"read",void 0,void 0,((r,a)=>{r&&this.logger.warn(`${t}loading namespace ${s} for language ${n} failed`,r),!r&&a&&this.logger.log(`${t}loaded namespace ${s} for language ${n}`,a),this.loaded(e,r,a)}))}saveMissing(e,t,r,n,s){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t))this.logger.warn(`did not save key "${r}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");else if(null!=r&&""!==r){if(this.backend&&this.backend.create){const o={...a,isUpdate:s},l=this.backend.create.bind(this.backend);if(l.length<6)try{let s;s=5===l.length?l(e,t,r,n,o):l(e,t,r,n),s&&"function"==typeof s.then?s.then((e=>i(null,e))).catch(i):i(null,s)}catch(e){i(e)}else l(e,t,r,n,i,o)}e&&e[0]&&this.store.addResource(e[0],t,r,n)}}}const Ys=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const r=e[3]||e[2];Object.keys(r).forEach((e=>{t[e]=r[e]}))}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),Js=e=>("string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e),Hs=()=>{};class Zs extends hs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;var r;if(super(),this.options=Js(e),this.services={},this.logger=ds,this.modules={external:[]},r=this,Object.getOwnPropertyNames(Object.getPrototypeOf(r)).forEach((e=>{"function"==typeof r[e]&&(r[e]=r[e].bind(r))})),t&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,t),this;setTimeout((()=>{this.init(e,t)}),0)}}init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,"function"==typeof t&&(r=t,t={}),!t.defaultNS&&!1!==t.defaultNS&&t.ns&&("string"==typeof t.ns?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const n=Ys();this.options={...n,...this.options,...Js(t)},"v1"!==this.options.compatibilityAPI&&(this.options.interpolation={...n.interpolation,...this.options.interpolation}),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator);const s=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let t;this.modules.logger?ds.init(s(this.modules.logger),this.options):ds.init(null,this.options),this.modules.formatter?t=this.modules.formatter:"undefined"!=typeof Intl&&(t=Gs);const r=new Fs(this.options);this.store=new Rs(this.options.resources,this.options);const a=this.services;a.logger=ds,a.resourceStore=this.store,a.languageUtils=r,a.pluralResolver=new qs(r,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!t||this.options.interpolation.format&&this.options.interpolation.format!==n.interpolation.format||(a.formatter=s(t),a.formatter.init(a,this.options),this.options.interpolation.format=a.formatter.format.bind(a.formatter)),a.interpolator=new Us(this.options),a.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},a.backendConnector=new Xs(s(this.modules.backend),a.resourceStore,a,this.options),a.backendConnector.on("*",(function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];e.emit(t,...n)})),this.modules.languageDetector&&(a.languageDetector=s(this.modules.languageDetector),a.languageDetector.init&&a.languageDetector.init(a,this.options.detection,this.options)),this.modules.i18nFormat&&(a.i18nFormat=s(this.modules.i18nFormat),a.i18nFormat.init&&a.i18nFormat.init(this)),this.translator=new Ds(this.services,this.options),this.translator.on("*",(function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];e.emit(t,...n)})),this.modules.external.forEach((e=>{e.init&&e.init(this)}))}if(this.format=this.options.interpolation.format,r||(r=Hs),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((t=>{this[t]=function(){return e.store[t](...arguments)}})),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((t=>{this[t]=function(){return e.store[t](...arguments),e}}));const a=fs(),i=()=>{const e=(e,t)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),a.resolve(t),r(e,t)};if(this.languages&&"v1"!==this.options.compatibilityAPI&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initImmediate?i():setTimeout(i,0),a}loadResources(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Hs;const r="string"==typeof e?e:this.language;if("function"==typeof e&&(t=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&"cimode"===r.toLowerCase()&&(!this.options.preload||0===this.options.preload.length))return t();const e=[],n=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach((t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)}))};r?n(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((e=>n(e))),this.options.preload&&this.options.preload.forEach((e=>n(e))),this.services.backendConnector.load(e,this.options.ns,(e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),t(e)}))}else t(null)}reloadResources(e,t,r){const n=fs();return"function"==typeof e&&(r=e,e=void 0),"function"==typeof t&&(r=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),r||(r=Hs),this.services.backendConnector.reload(e,t,(e=>{n.resolve(),r(e)})),n}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&Ns.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(let e=0;e<this.languages.length;e++){const t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}}changeLanguage(e,t){var r=this;this.isLanguageChangingTo=e;const n=fs();this.emit("languageChanging",e);const s=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},a=(e,a)=>{a?(s(a),this.translator.changeLanguage(a),this.isLanguageChangingTo=void 0,this.emit("languageChanged",a),this.logger.log("languageChanged",a)):this.isLanguageChangingTo=void 0,n.resolve((function(){return r.t(...arguments)})),t&&t(e,(function(){return r.t(...arguments)}))},i=t=>{e||t||!this.services.languageDetector||(t=[]);const r="string"==typeof t?t:this.services.languageUtils.getBestMatchFromCodes(t);r&&(this.language||s(r),this.translator.language||this.translator.changeLanguage(r),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(r)),this.loadResources(r,(e=>{a(e,r)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(i):this.services.languageDetector.detect(i):i(e):i(this.services.languageDetector.detect()),n}getFixedT(e,t,r){var n=this;const s=function(e,t){let a;if("object"!=typeof t){for(var i=arguments.length,o=new Array(i>2?i-2:0),l=2;l<i;l++)o[l-2]=arguments[l];a=n.options.overloadTranslationOptionHandler([e,t].concat(o))}else a={...t};a.lng=a.lng||s.lng,a.lngs=a.lngs||s.lngs,a.ns=a.ns||s.ns,""!==a.keyPrefix&&(a.keyPrefix=a.keyPrefix||r||s.keyPrefix);const c=n.options.keySeparator||".";let u;return u=a.keyPrefix&&Array.isArray(e)?e.map((e=>`${a.keyPrefix}${c}${e}`)):a.keyPrefix?`${a.keyPrefix}${c}${e}`:e,n.t(u,a)};return"string"==typeof e?s.lng=e:s.lngs=e,s.ns=t,s.keyPrefix=r,s}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=t.lng||this.resolvedLanguage||this.languages[0],n=!!this.options&&this.options.fallbackLng,s=this.languages[this.languages.length-1];if("cimode"===r.toLowerCase())return!0;const a=(e,t)=>{const r=this.services.backendConnector.state[`${e}|${t}`];return-1===r||0===r||2===r};if(t.precheck){const e=t.precheck(this,a);if(void 0!==e)return e}return!(!this.hasResourceBundle(r,e)&&this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages)&&(!a(r,e)||n&&!a(s,e)))}loadNamespaces(e,t){const r=fs();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)})),this.loadResources((e=>{r.resolve(),t&&t(e)})),r):(t&&t(),Promise.resolve())}loadLanguages(e,t){const r=fs();"string"==typeof e&&(e=[e]);const n=this.options.preload||[],s=e.filter((e=>n.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e)));return s.length?(this.options.preload=n.concat(s),this.loadResources((e=>{r.resolve(),t&&t(e)})),r):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=this.services&&this.services.languageUtils||new Fs(Ys());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){return new Zs(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}cloneInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Hs;const r=e.forkResourceStore;r&&delete e.forkResourceStore;const n={...this.options,...e,isClone:!0},s=new Zs(n);return void 0===e.debug&&void 0===e.prefix||(s.logger=s.logger.clone(e)),["store","services","language"].forEach((e=>{s[e]=this[e]})),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},r&&(s.store=new Rs(this.store.data,n),s.services.resourceStore=s.store),s.translator=new Ds(s.services,n),s.translator.on("*",(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];s.emit(e,...r)})),s.init(n,t),s.translator.options=n,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Ks=Zs.createInstance();function ea(e,t,r,n,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,s)}function ta(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function i(e){ea(a,n,s,i,o,"next",e)}function o(e){ea(a,n,s,i,o,"throw",e)}i(void 0)}))}}Ks.createInstance=Zs.createInstance,Ks.createInstance,Ks.dir,Ks.init,Ks.loadResources,Ks.reloadResources,Ks.use,Ks.changeLanguage,Ks.getFixedT,Ks.t,Ks.exists,Ks.setDefaultNamespace,Ks.hasLoadedNamespace,Ks.loadNamespaces,Ks.loadLanguages;const ra=({datasource:e,onChange:t,disabled:r,filterKey:a,allFilters:i})=>null===a?(0,n.jsx)("div",{className:"gf-form","data-testid":"AdHocFilterKey-add-key-wrapper",children:(0,n.jsx)(s.SegmentAsync,{disabled:r,className:"query-segment-key",Component:aa,value:a,onChange:t,loadOptions:()=>ia(e,a,i),inputMinWidth:90})}):(0,n.jsx)("div",{className:"gf-form","data-testid":"AdHocFilterKey-key-wrapper",children:(0,n.jsx)(s.SegmentAsync,{disabled:r,className:"query-segment-key",value:a,onChange:t,loadOptions:()=>la(e,a,i),inputMinWidth:90})}),na="-- remove filter --",sa={label:na,value:na},aa=(0,n.jsx)("span",{className:"gf-form-label query-part","aria-label":"Add Filter",children:(0,n.jsx)(s.Icon,{name:"plus"})}),ia=(oa=ta((function*(e,t,n){const s=yield(0,r.getDataSourceSrv)().get(e);if(!s||!s.getTagKeys)return[];const a=n.filter((e=>e.key!==t)),i=yield s.getTagKeys({filters:a});return(Array.isArray(i)?i:i.data).map((e=>({label:e.text,value:e.text})))})),function(e,t,r){return oa.apply(this,arguments)});var oa;const la=function(){var e=ta((function*(e,t,r){const n=yield ia(e,t,r);return[sa,...n]}));return function(t,r,n){return e.apply(this,arguments)}}();function ca(e,t,r,n,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,s)}const ua=({datasource:e,disabled:t,onChange:r,filterKey:a,filterValue:i,placeHolder:o,allFilters:l})=>(0,n.jsx)("div",{className:"gf-form","data-testid":"AdHocFilterValue-value-wrapper",children:(0,n.jsx)(s.SegmentAsync,{className:"query-segment-value",disabled:t,placeholder:o,value:i,onChange:r,loadOptions:()=>pa(e,a,l)})}),pa=function(){var e,n=(e=function*(e,n,s){const a=yield(0,r.getDataSourceSrv)().get(e);if(!a||!a.getTagValues)return[];const i=(0,t.getDefaultTimeRange)(),o=s.filter((e=>e.key!==n)),l=yield a.getTagValues({key:n,filters:o,timeRange:i});return(Array.isArray(l)?l:l.data).map((e=>({label:e.text,value:e.text})))},function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function i(e){ca(a,n,s,i,o,"next",e)}function o(e){ca(a,n,s,i,o,"throw",e)}i(void 0)}))});return function(e,t,r){return n.apply(this,arguments)}}(),ga=["=","!=","<",">","=~","!~"].map((e=>({label:e,value:e}))),da=({value:e,disabled:t,onChange:r})=>(0,n.jsx)(s.Segment,{className:"query-segment-operator",value:e,disabled:t,options:ga,onChange:r}),ha=({datasource:e,filter:{key:t,operator:r,value:s},onKeyChange:a,onOperatorChange:i,onValueChange:o,placeHolder:l,allFilters:c,disabled:u})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ra,{disabled:u,datasource:e,filterKey:t,onChange:a,allFilters:c}),(0,n.jsx)("div",{className:"gf-form",children:(0,n.jsx)(da,{disabled:u,value:r,onChange:i})}),(0,n.jsx)(ua,{disabled:u,datasource:e,filterKey:t,filterValue:s,allFilters:c,onChange:o,placeHolder:l})]}),fa=Ks.t,ma=({datasource:e,appendBefore:t,onCompleted:r,allFilters:s})=>{const[a,o]=(0,i.useState)(null),[l,c]=(0,i.useState)("="),u=(0,i.useCallback)((e=>{var t;e.value===na?o(null):o(null!==(t=e.value)&&void 0!==t?t:"")}),[o]),p=(0,i.useCallback)((e=>{var t;return c(null!==(t=e.value)&&void 0!==t?t:"")}),[c]),g=(0,i.useCallback)((e=>{var t;r({value:null!==(t=e.value)&&void 0!==t?t:"",operator:l,key:a}),o(null),c("=")}),[r,l,a]);return null===a?(0,n.jsx)(ra,{datasource:e,filterKey:a,onChange:u,allFilters:s}):(0,n.jsxs)(i.Fragment,{children:[t,(0,n.jsx)(ha,{datasource:e,filter:{key:a,value:"",operator:l},placeHolder:(d="variable.adhoc.placeholder",h="Select value",fa(d,h,f)),onKeyChange:u,onOperatorChange:p,onValueChange:g,allFilters:s})]},"filter-builder");var d,h,f},va=({label:e})=>(0,n.jsx)("div",{className:"gf-form",children:(0,n.jsx)("span",{className:"gf-form-label query-keyword",children:e})});function ya(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Oa extends i.PureComponent{render(){const{filters:e,disabled:t}=this.props;return(0,n.jsxs)("div",{className:"gf-form-inline",children:[this.renderFilters(e,t),!t&&(0,n.jsx)(ma,{datasource:this.props.datasource,appendBefore:e.length>0?(0,n.jsx)(va,{label:"AND"}):null,onCompleted:this.appendFilterToVariable,allFilters:this.getAllFilters()})]})}getAllFilters(){return this.props.baseFilters?this.props.baseFilters.concat(this.props.filters):this.props.filters}renderFilters(e,t){return 0===e.length&&t?(0,n.jsx)(s.Segment,{disabled:t,value:"No filters",options:[],onChange:()=>{}}):e.reduce(((e,r,s)=>(e.length>0&&e.push((0,n.jsx)(va,{label:"AND"},`condition-${s}`)),e.push(this.renderFilterSegments(r,s,t)),e)),[])}renderFilterSegments(e,t,r){return(0,n.jsx)(i.Fragment,{children:(0,n.jsx)(ha,{disabled:r,datasource:this.props.datasource,filter:e,onKeyChange:this.onChange(t,"key"),onOperatorChange:this.onChange(t,"operator"),onValueChange:this.onChange(t,"value"),allFilters:this.getAllFilters()})},`filter-${t}`)}constructor(...e){super(...e),ya(this,"onChange",((e,t)=>r=>{const{filters:n}=this.props,{value:s}=r;return r.value===na?this.props.removeFilter(e):this.props.changeFilter(e,(a=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ya(e,t,r[t])}))}return e}({},n[e]),i=null!=(i={[t]:s})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(i)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(i,e))})),a));var a,i})),ya(this,"appendFilterToVariable",(e=>{this.props.addFilter(e)}))}}function ba(e,t,r,n,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,s)}function Sa(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xa(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Sa(e,t,r[t])}))}return e}function wa(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function ja({graphDatasourceUid:e,query:t,onChange:r}){const a=(0,s.useStyles2)(_a),o=(0,Wt.A)((()=>function(e){return yn.apply(this,arguments)}(e)),[e]),[l,c]=(0,i.useState)(void 0);if((0,i.useEffect)((()=>{function e(){return t=function*(e){const t=yield e.getTagKeys({filters:[{key:"__name__",operator:"=~",value:"traces_service_graph_request_server_seconds_sum|traces_service_graph_request_total|traces_service_graph_request_failed_total",condition:""}]});c(Boolean(t.length))},e=function(){var e=this,r=arguments;return new Promise((function(n,s){var a=t.apply(e,r);function i(e){ba(a,n,s,i,o,"next",e)}function o(e){ba(a,n,s,i,o,"throw",e)}i(void 0)}))},e.apply(this,arguments);var t}!o.loading&&o.value&&function(t){e.apply(this,arguments)}(o.value)}),[o]),o.loading)return null;const u=o.value;if(!e)return Ta("No service graph datasource selected","Please set up a service graph datasource in the datasource settings",a);if(e&&!u)return Ta("No service graph data found","Service graph datasource is configured but the data source no longer exists. Please configure existing data source to use the service graph functionality",a);const p=function(e){let t,r=[];const n=/([\w_]+)(=|!=|<|>|=~|!~)"(.*?)"/g;for(;null!==(t=n.exec(e));)r.push({key:t[1],operator:t[2],value:t[3],condition:""});return r}((Array.isArray(t.serviceMapQuery)?t.serviceMapQuery[0]:t.serviceMapQuery)||"");return(0,n.jsxs)("div",{children:[(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{label:"Filter",labelWidth:14,grow:!0,children:(0,n.jsx)(Oa,{datasource:{uid:e},filters:p,baseFilters:[{key:"__name__",operator:"=~",value:"traces_service_graph_request_total|traces_spanmetrics_calls_total",condition:""}],addFilter:e=>{r(wa(xa({},t),{serviceMapQuery:Pa([...p,e])}))},removeFilter:e=>{const n=[...p];n.splice(e,1),r(wa(xa({},t),{serviceMapQuery:Pa(n)}))},changeFilter:(e,n)=>{const s=[...p];s.splice(e,1,n),r(wa(xa({},t),{serviceMapQuery:Pa(s)}))}})})}),!1===l?Ta("No service graph data found","Please ensure that service graph metrics are set up correctly",a):null]})}function Ta(e,t,r){return(0,n.jsxs)(s.Alert,{title:e,severity:"info",className:r.alert,children:[t," according to the"," ",(0,n.jsx)("a",{target:"_blank",rel:"noreferrer noopener",href:"https://grafana.com/docs/grafana/latest/datasources/tempo/service-graph/",className:r.link,children:"Tempo documentation"}),"."]})}function Pa(e){return`{${e.map((e=>`${e.key}${e.operator}"${e.value}"`)).join(",")}}`}const _a=e=>({alert:(0,a.css)({maxWidth:"75ch",marginTop:e.spacing(2)}),link:(0,a.css)({color:e.colors.text.link,textDecoration:"underline"})}),Ea={};var ka;!function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.INTERNAL=1]="INTERNAL",e[e.SERVER=2]="SERVER",e[e.CLIENT=3]="CLIENT",e[e.PRODUCER=4]="PRODUCER",e[e.CONSUMER=5]="CONSUMER"}(ka||(ka={}));const Ca=1024;let Ra=0;class Na{constructor(e,t){this.from=e,this.to=t}}class Ia{constructor(e={}){this.id=Ra++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=Fa.match(e)),t=>{let r=e(t);return void 0===r?null:[this,r]}}}Ia.closedBy=new Ia({deserialize:e=>e.split(" ")}),Ia.openedBy=new Ia({deserialize:e=>e.split(" ")}),Ia.group=new Ia({deserialize:e=>e.split(" ")}),Ia.isolate=new Ia({deserialize:e=>{if(e&&"rtl"!=e&&"ltr"!=e&&"auto"!=e)throw new RangeError("Invalid value for isolate: "+e);return e||"auto"}}),Ia.contextHash=new Ia({perNode:!0}),Ia.lookAhead=new Ia({perNode:!0}),Ia.mounted=new Ia({perNode:!0});class Da{constructor(e,t,r){this.tree=e,this.overlay=t,this.parser=r}static get(e){return e&&e.props&&e.props[Ia.mounted.id]}}const $a=Object.create(null);class Fa{constructor(e,t,r,n=0){this.name=e,this.props=t,this.id=r,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):$a,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),n=new Fa(e.name||"",t,e.id,r);if(e.props)for(let r of e.props)if(Array.isArray(r)||(r=r(n)),r){if(r[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[r[0].id]=r[1]}return n}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(Ia.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let n of r.split(" "))t[n]=e[r];return e=>{for(let r=e.prop(Ia.group),n=-1;n<(r?r.length:0);n++){let s=t[n<0?e.name:r[n]];if(s)return s}}}}Fa.none=new Fa("",Object.create(null),0,8);class Aa{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let r of this.types){let n=null;for(let t of e){let e=t(r);e&&(n||(n=Object.assign({},r.props)),n[e[0].id]=e[1])}t.push(n?new Fa(r.name,n,r.id,r.flags):r)}return new Aa(t)}}const Qa=new WeakMap,La=new WeakMap;var Wa;!function(e){e[e.ExcludeBuffers=1]="ExcludeBuffers",e[e.IncludeAnonymous=2]="IncludeAnonymous",e[e.IgnoreMounts=4]="IgnoreMounts",e[e.IgnoreOverlays=8]="IgnoreOverlays"}(Wa||(Wa={}));class za{constructor(e,t,r,n,s){if(this.type=e,this.children=t,this.positions=r,this.length=n,this.props=null,s&&s.length){this.props=Object.create(null);for(let[e,t]of s)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=Da.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let e of this.children){let r=e.toString();r&&(t&&(t+=","),t+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new ei(this.topNode,e)}cursorAt(e,t=0,r=0){let n=Qa.get(this)||this.topNode,s=new ei(n);return s.moveTo(e,t),Qa.set(this,s._tree),s}get topNode(){return new Ga(this,0,0,null)}resolve(e,t=0){let r=Ua(Qa.get(this)||this.topNode,e,t,!1);return Qa.set(this,r),r}resolveInner(e,t=0){let r=Ua(La.get(this)||this.topNode,e,t,!0);return La.set(this,r),r}resolveStack(e,t=0){return function(e,t,r){let n=e.resolveInner(t,r),s=null;for(let e=n instanceof Ga?n:n.context.parent;e;e=e.parent)if(e.index<0){let a=e.parent;(s||(s=[n])).push(a.resolve(t,r)),e=a}else{let a=Da.get(e.tree);if(a&&a.overlay&&a.overlay[0].from<=t&&a.overlay[a.overlay.length-1].to>=t){let i=new Ga(a.tree,a.overlay[0].from+e.from,-1,e);(s||(s=[n])).push(Ua(i,t,r,!1))}}return s?Za(s):n}(this,e,t)}iterate(e){let{enter:t,leave:r,from:n=0,to:s=this.length}=e,a=e.mode||0,i=(a&Wa.IncludeAnonymous)>0;for(let e=this.cursor(a|Wa.IncludeAnonymous);;){let a=!1;if(e.from<=s&&e.to>=n&&(!i&&e.type.isAnonymous||!1!==t(e))){if(e.firstChild())continue;a=!0}for(;a&&r&&(i||!e.type.isAnonymous)&&r(e),!e.nextSibling();){if(!e.parent())return;a=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:si(Fa.none,this.children,this.positions,0,this.children.length,0,this.length,((e,t,r)=>new za(this.type,e,t,r,this.propValues)),e.makeTree||((e,t,r)=>new za(Fa.none,e,t,r)))}static build(e){return function(e){var t;let{buffer:r,nodeSet:n,maxBufferLength:s=Ca,reused:a=[],minRepeatType:i=n.types.length}=e,o=Array.isArray(r)?new qa(r,r.length):r,l=n.types,c=0,u=0;function p(e,t,r,m,v,y){let{id:O,start:b,end:S,size:x}=o,w=u;for(;x<0;){if(o.next(),-1==x){let t=a[O];return r.push(t),void m.push(b-e)}if(-3==x)return void(c=O);if(-4==x)return void(u=O);throw new RangeError(`Unrecognized record size: ${x}`)}let j,T,P=l[O],_=b-e;if(S-b<=s&&(T=function(e,t){let r=o.fork(),n=0,a=0,l=0,c=r.end-s,u={size:0,start:0,skip:0};e:for(let s=r.pos-e;r.pos>s;){let e=r.size;if(r.id==t&&e>=0){u.size=n,u.start=a,u.skip=l,l+=4,n+=4,r.next();continue}let o=r.pos-e;if(e<0||o<s||r.start<c)break;let p=r.id>=i?4:0,g=r.start;for(r.next();r.pos>o;){if(r.size<0){if(-3!=r.size)break e;p+=4}else r.id>=i&&(p+=4);r.next()}a=g,n+=e,l+=p}return(t<0||n==e)&&(u.size=n,u.start=a,u.skip=l),u.size>4?u:void 0}(o.pos-t,v))){let t=new Uint16Array(T.size-T.skip),r=o.pos-T.size,s=t.length;for(;o.pos>r;)s=f(T.start,t,s);j=new Ma(t,S-T.start,n),_=T.start-e}else{let e=o.pos-x;o.next();let t=[],r=[],n=O>=i?O:-1,a=0,l=S;for(;o.pos>e;)n>=0&&o.id==n&&o.size>=0?(o.end<=l-s&&(d(t,r,b,a,o.end,l,n,w),a=t.length,l=o.end),o.next()):y>2500?g(b,e,t,r):p(b,e,t,r,n,y+1);if(n>=0&&a>0&&a<t.length&&d(t,r,b,a,b,l,n,w),t.reverse(),r.reverse(),n>-1&&a>0){let e=function(e){return(t,r,n)=>{let s,a,i=0,o=t.length-1;if(o>=0&&(s=t[o])instanceof za){if(!o&&s.type==e&&s.length==n)return s;(a=s.prop(Ia.lookAhead))&&(i=r[o]+s.length+a)}return h(e,t,r,n,i)}}(P);j=si(P,t,r,0,t.length,0,S-b,e,e)}else j=h(P,t,r,S-b,w-S)}r.push(j),m.push(_)}function g(e,t,r,a){let i=[],l=0,c=-1;for(;o.pos>t;){let{id:e,start:t,end:r,size:n}=o;if(n>4)o.next();else{if(c>-1&&t<c)break;c<0&&(c=r-s),i.push(e,t,r),l++,o.next()}}if(l){let t=new Uint16Array(4*l),s=i[i.length-2];for(let e=i.length-3,r=0;e>=0;e-=3)t[r++]=i[e],t[r++]=i[e+1]-s,t[r++]=i[e+2]-s,t[r++]=r;r.push(new Ma(t,i[2]-s,n)),a.push(s-e)}}function d(e,t,r,s,a,i,o,l){let c=[],u=[];for(;e.length>s;)c.push(e.pop()),u.push(t.pop()+r-a);e.push(h(n.types[o],c,u,i-a,l-i)),t.push(a-r)}function h(e,t,r,n,s=0,a){if(c){let e=[Ia.contextHash,c];a=a?[e].concat(a):[e]}if(s>25){let e=[Ia.lookAhead,s];a=a?[e].concat(a):[e]}return new za(e,t,r,n,a)}function f(e,t,r){let{id:n,start:s,end:a,size:l}=o;if(o.next(),l>=0&&n<i){let i=r;if(l>4){let n=o.pos-(l-4);for(;o.pos>n;)r=f(e,t,r)}t[--r]=i,t[--r]=a-e,t[--r]=s-e,t[--r]=n}else-3==l?c=n:-4==l&&(u=n);return r}let m=[],v=[];for(;o.pos>0;)p(e.start||0,e.bufferStart||0,m,v,-1,0);let y=null!==(t=e.length)&&void 0!==t?t:m.length?v[0]+m[0].length:0;return new za(l[e.topID],m.reverse(),v.reverse(),y)}(e)}}za.empty=new za(Fa.none,[],[],0);class qa{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new qa(this.buffer,this.index)}}class Ma{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return Fa.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],n=this.set.types[t],s=n.name;if(/\W/.test(s)&&!n.isError&&(s=JSON.stringify(s)),r==(e+=4))return s;let a=[];for(;e<r;)a.push(this.childString(e)),e=this.buffer[e+3];return s+"("+a.join(",")+")"}findChild(e,t,r,n,s){let{buffer:a}=this,i=-1;for(let o=e;o!=t&&!(Va(s,n,a[o+1],a[o+2])&&(i=o,r>0));o=a[o+3]);return i}slice(e,t,r){let n=this.buffer,s=new Uint16Array(t-e),a=0;for(let i=e,o=0;i<t;){s[o++]=n[i++],s[o++]=n[i++]-r;let t=s[o++]=n[i++]-r;s[o++]=n[i++]-e,a=Math.max(a,t)}return new Ma(s,a,this.set)}}function Va(e,t,r,n){switch(e){case-2:return r<t;case-1:return n>=t&&r<t;case 0:return r<t&&n>t;case 1:return r<=t&&n>t;case 2:return n>t;case 4:return!0}}function Ua(e,t,r,n){for(var s;e.from==e.to||(r<1?e.from>=t:e.from>t)||(r>-1?e.to<=t:e.to<t);){let t=!n&&e instanceof Ga&&e.index<0?null:e.parent;if(!t)return e;e=t}let a=n?0:Wa.IgnoreOverlays;if(n)for(let n=e,i=n.parent;i;n=i,i=n.parent)n instanceof Ga&&n.index<0&&(null===(s=i.enter(t,r,a))||void 0===s?void 0:s.from)!=n.from&&(e=i);for(;;){let n=e.enter(t,r,a);if(!n)return e;e=n}}class Ba{cursor(e=0){return new ei(this,e)}getChild(e,t=null,r=null){let n=Xa(this,e,t,r);return n.length?n[0]:null}getChildren(e,t=null,r=null){return Xa(this,e,t,r)}resolve(e,t=0){return Ua(this,e,t,!1)}resolveInner(e,t=0){return Ua(this,e,t,!0)}matchContext(e){return Ya(this,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),r=this;for(;t;){let e=t.lastChild;if(!e||e.to!=t.to)break;e.type.isError&&e.from==e.to?(r=t,t=e.prevSibling):t=e}return r}get node(){return this}get next(){return this.parent}}class Ga extends Ba{constructor(e,t,r,n){super(),this._tree=e,this.from=t,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,n,s=0){for(let a=this;;){for(let{children:i,positions:o}=a._tree,l=t>0?i.length:-1;e!=l;e+=t){let l=i[e],c=o[e]+a.from;if(Va(n,r,c,c+l.length))if(l instanceof Ma){if(s&Wa.ExcludeBuffers)continue;let i=l.findChild(0,l.buffer.length,t,r-c,n);if(i>-1)return new Ha(new Ja(a,l,e,c),null,i)}else if(s&Wa.IncludeAnonymous||!l.type.isAnonymous||ti(l)){let i;if(!(s&Wa.IgnoreMounts)&&(i=Da.get(l))&&!i.overlay)return new Ga(i.tree,c,e,a);let o=new Ga(l,c,e,a);return s&Wa.IncludeAnonymous||!o.type.isAnonymous?o:o.nextChild(t<0?l.children.length-1:0,t,r,n)}}if(s&Wa.IncludeAnonymous||!a.type.isAnonymous)return null;if(e=a.index>=0?a.index+t:t<0?-1:a._parent._tree.children.length,a=a._parent,!a)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,r=0){let n;if(!(r&Wa.IgnoreOverlays)&&(n=Da.get(this._tree))&&n.overlay){let r=e-this.from;for(let{from:e,to:s}of n.overlay)if((t>0?e<=r:e<r)&&(t<0?s>=r:s>r))return new Ga(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function Xa(e,t,r,n){let s=e.cursor(),a=[];if(!s.firstChild())return a;if(null!=r)for(let e=!1;!e;)if(e=s.type.is(r),!s.nextSibling())return a;for(;;){if(null!=n&&s.type.is(n))return a;if(s.type.is(t)&&a.push(s.node),!s.nextSibling())return null==n?a:[]}}function Ya(e,t,r=t.length-1){for(let n=e.parent;r>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(t[r]&&t[r]!=n.name)return!1;r--}}return!0}class Ja{constructor(e,t,r,n){this.parent=e,this.buffer=t,this.index=r,this.start=n}}class Ha extends Ba{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){super(),this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,r);return s<0?null:new Ha(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,r=0){if(r&Wa.ExcludeBuffers)return null;let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return s<0?null:new Ha(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new Ha(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new Ha(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,n=this.index+4,s=r.buffer[this.index+3];if(s>n){let a=r.buffer[this.index+1];e.push(r.slice(n,s,a)),t.push(0)}return new za(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function Za(e){if(!e.length)return null;let t=0,r=e[0];for(let n=1;n<e.length;n++){let s=e[n];(s.from>r.from||s.to<r.to)&&(r=s,t=n)}let n=r instanceof Ga&&r.index<0?null:r.parent,s=e.slice();return n?s[t]=n:s.splice(t,1),new Ka(s,r)}class Ka{constructor(e,t){this.heads=e,this.node=t}get next(){return Za(this.heads)}}class ei{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof Ga)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:r,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=r+n.buffer[e+1],this.to=r+n.buffer[e+2],!0}yield(e){return!!e&&(e instanceof Ga?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,r,this.mode));let{buffer:n}=this.buffer,s=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,r);return!(s<0)&&(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,r=this.mode){return this.buffer?!(r&Wa.ExcludeBuffers)&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Wa.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&Wa.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,r=this.stack.length-1;if(e<0){let e=r<0?0:this.stack[r]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(e)}return r<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,r,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(n.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:r}=n)}else({index:t,_parent:r}=this._tree);for(;r;({index:t,_parent:r}=r))if(t>-1)for(let n=t+e,s=e<0?-1:r._tree.children.length;n!=s;n+=e){let e=r._tree.children[n];if(this.mode&Wa.IncludeAnonymous||e instanceof Ma||!e.type.isAnonymous||ti(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer)e:for(let n=this.index,s=this.stack.length;s>=0;){for(let a=e;a;a=a._parent)if(a.index==n){if(n==this.index)return a;t=a,r=s+1;break e}n=this.stack[--s]}for(let e=r;e<this.stack.length;e++)t=new Ha(this.buffer,t,this.stack[e]);return this.bufferNode=new Ha(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let r=0;;){let n=!1;if(this.type.isAnonymous||!1!==e(this)){if(this.firstChild()){r++;continue}this.type.isAnonymous||(n=!0)}for(;n&&t&&t(this),n=this.type.isAnonymous,!this.nextSibling();){if(!r)return;this.parent(),r--,n=!0}}}matchContext(e){if(!this.buffer)return Ya(this.node,e);let{buffer:t}=this.buffer,{types:r}=t.set;for(let n=e.length-1,s=this.stack.length-1;n>=0;s--){if(s<0)return Ya(this.node,e,n);let a=r[t.buffer[this.stack[s]]];if(!a.isAnonymous){if(e[n]&&e[n]!=a.name)return!1;n--}}return!0}}function ti(e){return e.children.some((e=>e instanceof Ma||!e.type.isAnonymous||ti(e)))}const ri=new WeakMap;function ni(e,t){if(!e.isAnonymous||t instanceof Ma||t.type!=e)return 1;let r=ri.get(t);if(null==r){r=1;for(let n of t.children){if(n.type!=e||!(n instanceof za)){r=1;break}r+=ni(e,n)}ri.set(t,r)}return r}function si(e,t,r,n,s,a,i,o,l){let c=0;for(let r=n;r<s;r++)c+=ni(e,t[r]);let u=Math.ceil(1.5*c/8),p=[],g=[];return function t(r,n,s,i,o){for(let c=s;c<i;){let s=c,d=n[c],h=ni(e,r[c]);for(c++;c<i;c++){let t=ni(e,r[c]);if(h+t>=u)break;h+=t}if(c==s+1){if(h>u){let e=r[s];t(e.children,e.positions,0,e.children.length,n[s]+o);continue}p.push(r[s])}else{let t=n[c-1]+r[c-1].length-d;p.push(si(e,r,n,s,c,d,t,null,l))}g.push(d+o-a)}}(t,r,n,s,0),(o||l)(p,g,i)}class ai{startParse(e,t,r){return"string"==typeof e&&(e=new ii(e)),r=r?r.length?r.map((e=>new Na(e.from,e.to))):[new Na(0,0)]:[new Na(0,e.length)],this.createParse(e,t||[],r)}parse(e,t,r){let n=this.startParse(e,t,r);for(;;){let e=n.advance();if(e)return e}}}class ii{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new Ia({perNode:!0});class oi{constructor(e,t,r,n,s,a,i,o,l,c=0,u){this.p=e,this.stack=t,this.state=r,this.reducePos=n,this.pos=s,this.score=a,this.buffer=i,this.bufferBase=o,this.curContext=l,this.lookAhead=c,this.parent=u}toString(){return`[${this.stack.filter(((e,t)=>t%3==0)).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,t,r=0){let n=e.parser.context;return new oi(e,[],t,r,r,0,[],0,n?new li(n,n.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var t;let r=e>>19,n=65535&e,{parser:s}=this.p,a=s.dynamicPrecedence(n);if(a&&(this.score+=a),0==r)return this.pushState(s.getGoto(this.state,n,!0),this.reducePos),n<s.minRepeatTerm&&this.storeNode(n,this.reducePos,this.reducePos,4,!0),void this.reduceContext(n,this.reducePos);let i=this.stack.length-3*(r-1)-(262144&e?6:0),o=i?this.stack[i-2]:this.p.ranges[0].from,l=this.reducePos-o;l>=2e3&&!(null===(t=this.p.parser.nodeSet.types[n])||void 0===t?void 0:t.isAnonymous)&&(o==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=l):this.p.lastBigReductionSize<l&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=o,this.p.lastBigReductionSize=l));let c=i?this.stack[i-1]:0,u=this.bufferBase+this.buffer.length-c;if(n<s.minRepeatTerm||131072&e){let e=s.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(n,o,e,u+4,!0)}if(262144&e)this.state=this.stack[i];else{let e=this.stack[i-3];this.state=s.getGoto(e,n,!0)}for(;this.stack.length>i;)this.stack.pop();this.reduceContext(n,o)}storeNode(e,t,r,n=4,s=!1){if(0==e&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let e=this,n=this.buffer.length;if(0==n&&e.parent&&(n=e.bufferBase-e.parent.bufferBase,e=e.parent),n>0&&0==e.buffer[n-4]&&e.buffer[n-1]>-1){if(t==r)return;if(e.buffer[n-2]>=t)return void(e.buffer[n-2]=r)}}if(s&&this.pos!=r){let s=this.buffer.length;if(s>0&&0!=this.buffer[s-4])for(;s>0&&this.buffer[s-2]>r;)this.buffer[s]=this.buffer[s-4],this.buffer[s+1]=this.buffer[s-3],this.buffer[s+2]=this.buffer[s-2],this.buffer[s+3]=this.buffer[s-1],s-=4,n>4&&(n-=4);this.buffer[s]=e,this.buffer[s+1]=t,this.buffer[s+2]=r,this.buffer[s+3]=n}else this.buffer.push(e,t,r,n)}shift(e,t,r){let n=this.pos;if(131072&e)this.pushState(65535&e,this.pos);else if(262144&e)this.pos=r,this.shiftContext(t,n),t<=this.p.parser.maxNode&&this.buffer.push(t,n,r,4);else{let s=e,{parser:a}=this.p;(r>this.pos||t<=a.maxNode)&&(this.pos=r,a.stateFlag(s,1)||(this.reducePos=r)),this.pushState(s,n),this.shiftContext(t,n),t<=a.maxNode&&this.buffer.push(t,n,r,4)}}apply(e,t,r){65536&e?this.reduce(e):this.shift(e,t,r)}useNode(e,t){let r=this.p.reused.length-1;(r<0||this.p.reused[r]!=e)&&(this.p.reused.push(e),r++);let n=this.pos;this.reducePos=this.pos=n+e.length,this.pushState(t,n),this.buffer.push(r,n,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let r=e.buffer.slice(t),n=e.bufferBase+t;for(;e&&n==e.bufferBase;)e=e.parent;return new oi(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,r,n,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let r=e<=this.p.parser.maxNode;r&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,r?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new ui(this);;){let r=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(0==r)return!1;if(!(65536&r))return!0;t.reduce(r)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let r=[];for(let n,s=0;s<t.length;s+=2)(n=t[s+1])!=this.state&&this.p.parser.hasAction(n,e)&&r.push(t[s],n);if(this.stack.length<120)for(let e=0;r.length<8&&e<t.length;e+=2){let n=t[e+1];r.some(((e,t)=>1&t&&e==n))||r.push(t[e],n)}t=r}let r=[];for(let e=0;e<t.length&&r.length<4;e+=2){let n=t[e+1];if(n==this.state)continue;let s=this.split();s.pushState(n,this.pos),s.storeNode(0,s.pos,s.pos,4,!0),s.shiftContext(t[e],this.pos),s.score-=200,r.push(s)}return r}forceReduce(){let e=this.p.parser.stateSlot(this.state,5);if(!(65536&e))return!1;let{parser:t}=this.p;if(!t.validAction(this.state,e)){let r=e>>19,n=65535&e,s=this.stack.length-3*r;if(s<0||t.getGoto(this.stack[s],n,!1)<0)return!1;this.storeNode(0,this.reducePos,this.reducePos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(e),!0}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(3!=this.stack.length)return!1;let{parser:e}=this.p;return 65535==e.data[e.stateSlot(this.state,1)]&&!e.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||-3!=this.buffer[e])&&this.buffer.push(this.curContext.hash,this.reducePos,this.reducePos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||-4!=this.buffer[e])&&this.buffer.push(this.lookAhead,this.reducePos,this.reducePos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new li(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class li{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}var ci;!function(e){e[e.Insert=200]="Insert",e[e.Delete=190]="Delete",e[e.Reduce=100]="Reduce",e[e.MaxNext=4]="MaxNext",e[e.MaxInsertStackDepth=300]="MaxInsertStackDepth",e[e.DampenInsertStackDepth=120]="DampenInsertStackDepth",e[e.MinBigReduction=2e3]="MinBigReduction"}(ci||(ci={}));class ui{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=65535&e,r=e>>19;0==r?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=3*(r-1);let n=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=n}}class pi{constructor(e,t,r){this.stack=e,this.pos=t,this.index=r,this.buffer=e.buffer,0==this.index&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new pi(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;null!=e&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,0==this.index&&this.maybeNext()}fork(){return new pi(this.stack,this.pos,this.index)}}function gi(e,t=Uint16Array){if("string"!=typeof e)return e;let r=null;for(let n=0,s=0;n<e.length;){let a=0;for(;;){let t=e.charCodeAt(n++),r=!1;if(126==t){a=65535;break}t>=92&&t--,t>=34&&t--;let s=t-32;if(s>=46&&(s-=46,r=!0),a+=s,r)break;a*=46}r?r[s++]=a:r=new t(a)}return r}class di{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const hi=new di;class fi{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=hi,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let r=this.range,n=this.rangeIndex,s=this.pos+e;for(;s<r.from;){if(!n)return null;let e=this.ranges[--n];s-=r.from-e.to,r=e}for(;t<0?s>r.to:s>=r.to;){if(n==this.ranges.length-1)return null;let e=this.ranges[++n];s+=e.from-r.to,r=e}return s}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let t of this.ranges)if(t.to>e)return Math.max(e,t.from);return this.end}peek(e){let t,r,n=this.chunkOff+e;if(n>=0&&n<this.chunk.length)t=this.pos+e,r=this.chunk.charCodeAt(n);else{let n=this.resolveOffset(e,1);if(null==n)return-1;if(t=n,t>=this.chunk2Pos&&t<this.chunk2Pos+this.chunk2.length)r=this.chunk2.charCodeAt(t-this.chunk2Pos);else{let e=this.rangeIndex,n=this.range;for(;n.to<=t;)n=this.ranges[++e];this.chunk2=this.input.chunk(this.chunk2Pos=t),t+this.chunk2.length>n.to&&(this.chunk2=this.chunk2.slice(0,n.to-t)),r=this.chunk2.charCodeAt(0)}}return t>=this.token.lookAhead&&(this.token.lookAhead=t+1),r}acceptToken(e,t=0){let r=t?this.resolveOffset(t,-1):this.pos;if(null==r||r<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=r}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=hi,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let r="";for(let n of this.ranges){if(n.from>=t)break;n.to>e&&(r+=this.input.read(Math.max(n.from,e),Math.min(n.to,t)))}return r}}class mi{constructor(e,t){this.data=e,this.id=t}token(e,t){let{parser:r}=t.p;yi(this.data,e,t,this.id,r.data,r.tokenPrecTable)}}mi.prototype.contextual=mi.prototype.fallback=mi.prototype.extend=!1;class vi{constructor(e,t,r){this.precTable=t,this.elseToken=r,this.data="string"==typeof e?gi(e):e}token(e,t){let r,n=e.pos;for(;r=e.pos,yi(this.data,e,t,0,this.data,this.precTable),!(e.token.value>-1);){if(null==this.elseToken)return;if(e.next<0)break;e.advance(),e.reset(r+1,e.token)}r>n&&(e.reset(n,e.token),e.acceptToken(this.elseToken,r-n))}}function yi(e,t,r,n,s,a){let i=0,o=1<<n,{dialect:l}=r.p.parser;e:for(;o&e[i];){let r=e[i+1];for(let n=i+3;n<r;n+=2)if((e[n+1]&o)>0){let r=e[n];if(l.allows(r)&&(-1==t.token.value||t.token.value==r||bi(r,t.token.value,s,a))){t.acceptToken(r);break}}let n=t.next,c=0,u=e[i+2];if(!(t.next<0&&u>c&&65535==e[r+3*u-3]&&65535==e[r+3*u-3])){for(;c<u;){let s=c+u>>1,a=r+s+(s<<1),o=e[a],l=e[a+1]||65536;if(n<o)u=s;else{if(!(n>=l)){i=e[a+2],t.advance();continue e}c=s+1}}break}i=e[r+3*u-1]}}function Oi(e,t,r){for(let n,s=t;65535!=(n=e[s]);s++)if(n==r)return s-t;return-1}function bi(e,t,r,n){let s=Oi(r,n,t);return s<0||Oi(r,n,e)<s}vi.prototype.contextual=mi.prototype.fallback=mi.prototype.extend=!1;const Si="undefined"!=typeof process&&process.env&&/\bparse\b/.test(process.env.LOG);let xi=null;var wi,ji;function Ti(e,t,r){let n=e.cursor(Wa.IncludeAnonymous);for(n.moveTo(t);;)if(!(r<0?n.childBefore(t):n.childAfter(t)))for(;;){if((r<0?n.to<t:n.from>t)&&!n.type.isError)return r<0?Math.max(0,Math.min(n.to-1,t-25)):Math.min(e.length,Math.max(n.from+1,t+25));if(r<0?n.prevSibling():n.nextSibling())break;if(!n.parent())return r<0?0:e.length}}!function(e){e[e.Margin=25]="Margin"}(wi||(wi={}));class Pi{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?Ti(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?Ti(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let r=this.trees[t],n=this.index[t];if(n==r.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let s=r.children[n],a=this.start[t]+r.positions[n];if(a>e)return this.nextStart=a,null;if(s instanceof za){if(a==e){if(a<this.safeFrom)return null;let e=a+s.length;if(e<=this.safeTo){let t=s.prop(Ia.lookAhead);if(!t||e+t<this.fragment.to)return s}}this.index[t]++,a+s.length>=Math.max(this.safeFrom,e)&&(this.trees.push(s),this.start.push(a),this.index.push(0))}else this.index[t]++,this.nextStart=a+s.length}}}class _i{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map((e=>new di))}getActions(e){let t=0,r=null,{parser:n}=e.p,{tokenizers:s}=n,a=n.stateSlot(e.state,3),i=e.curContext?e.curContext.hash:0,o=0;for(let n=0;n<s.length;n++){if(!(1<<n&a))continue;let l=s[n],c=this.tokens[n];if((!r||l.fallback)&&((l.contextual||c.start!=e.pos||c.mask!=a||c.context!=i)&&(this.updateCachedToken(c,l,e),c.mask=a,c.context=i),c.lookAhead>c.end+25&&(o=Math.max(c.lookAhead,o)),0!=c.value)){let n=t;if(c.extended>-1&&(t=this.addActions(e,c.extended,c.end,t)),t=this.addActions(e,c.value,c.end,t),!l.extend&&(r=c,t>n))break}}for(;this.actions.length>t;)this.actions.pop();return o&&e.setLookAhead(o),r||e.pos!=this.stream.end||(r=new di,r.value=e.p.parser.eofTerm,r.start=r.end=e.pos,t=this.addActions(e,r.value,r.end,t)),this.mainToken=r,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new di,{pos:r,p:n}=e;return t.start=r,t.end=Math.min(r+1,n.stream.end),t.value=r==n.stream.end?n.parser.eofTerm:0,t}updateCachedToken(e,t,r){let n=this.stream.clipPos(r.pos);if(t.token(this.stream.reset(n,e),r),e.value>-1){let{parser:t}=r.p;for(let n=0;n<t.specialized.length;n++)if(t.specialized[n]==e.value){let s=t.specializers[n](this.stream.read(e.start,e.end),r);if(s>=0&&r.p.parser.dialect.allows(s>>1)){1&s?e.extended=s>>1:e.value=s>>1;break}}}else e.value=0,e.end=this.stream.clipPos(n+1)}putAction(e,t,r,n){for(let t=0;t<n;t+=3)if(this.actions[t]==e)return n;return this.actions[n++]=e,this.actions[n++]=t,this.actions[n++]=r,n}addActions(e,t,r,n){let{state:s}=e,{parser:a}=e.p,{data:i}=a;for(let e=0;e<2;e++)for(let o=a.stateSlot(s,e?2:1);;o+=3){if(65535==i[o]){if(1!=i[o+1]){0==n&&2==i[o+1]&&(n=this.putAction(Ni(i,o+2),t,r,n));break}o=Ni(i,o+2)}i[o]==t&&(n=this.putAction(Ni(i,o+1),t,r,n))}return n}}!function(e){e[e.Distance=5]="Distance",e[e.MaxRemainingPerStep=3]="MaxRemainingPerStep",e[e.MinBufferLengthPrune=500]="MinBufferLengthPrune",e[e.ForceReduceLimit=10]="ForceReduceLimit",e[e.CutDepth=15e3]="CutDepth",e[e.CutTo=9e3]="CutTo",e[e.MaxLeftAssociativeReductionCount=300]="MaxLeftAssociativeReductionCount",e[e.MaxStackCount=12]="MaxStackCount"}(ji||(ji={}));class Ei{constructor(e,t,r,n){this.parser=e,this.input=t,this.ranges=n,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new fi(t,n),this.tokens=new _i(e,this.stream),this.topTerm=e.top[1];let{from:s}=n[0];this.stacks=[oi.start(this,e.top[0],s)],this.fragments=r.length&&this.stream.end-s>4*e.bufferLength?new Pi(r,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e,t,r=this.stacks,n=this.minStackPos,s=this.stacks=[];if(this.bigReductionCount>300&&1==r.length){let[e]=r;for(;e.forceReduce()&&e.stack.length&&e.stack[e.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let a=0;a<r.length;a++){let i=r[a];for(;;){if(this.tokens.mainToken=null,i.pos>n)s.push(i);else{if(this.advanceStack(i,s,r))continue;{e||(e=[],t=[]),e.push(i);let r=this.tokens.getMainToken(i);t.push(r.value,r.end)}}break}}if(!s.length){let t=e&&function(e){let t=null;for(let r of e){let e=r.p.stoppedAt;(r.pos==r.p.stream.end||null!=e&&r.pos>e)&&r.p.parser.stateFlag(r.state,2)&&(!t||t.score<r.score)&&(t=r)}return t}(e);if(t)return this.stackToTree(t);if(this.parser.strict)throw Si&&e&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+n);this.recovering||(this.recovering=5)}if(this.recovering&&e){let r=null!=this.stoppedAt&&e[0].pos>this.stoppedAt?e[0]:this.runRecovery(e,t,s);if(r)return this.stackToTree(r.forceAll())}if(this.recovering){let e=1==this.recovering?1:3*this.recovering;if(s.length>e)for(s.sort(((e,t)=>t.score-e.score));s.length>e;)s.pop();s.some((e=>e.reducePos>n))&&this.recovering--}else if(s.length>1){e:for(let e=0;e<s.length-1;e++){let t=s[e];for(let r=e+1;r<s.length;r++){let n=s[r];if(t.sameState(n)||t.buffer.length>500&&n.buffer.length>500){if(!((t.score-n.score||t.buffer.length-n.buffer.length)>0)){s.splice(e--,1);continue e}s.splice(r--,1)}}}s.length>12&&s.splice(12,s.length-12)}this.minStackPos=s[0].pos;for(let e=1;e<s.length;e++)s[e].pos<this.minStackPos&&(this.minStackPos=s[e].pos);return null}stopAt(e){if(null!=this.stoppedAt&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,r){let n=e.pos,{parser:s}=this,a=Si?this.stackID(e)+" -> ":"";if(null!=this.stoppedAt&&n>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let t=e.curContext&&e.curContext.tracker.strict,r=t?e.curContext.hash:0;for(let i=this.fragments.nodeAt(n);i;){let n=this.parser.nodeSet.types[i.type.id]==i.type?s.getGoto(e.state,i.type.id):-1;if(n>-1&&i.length&&(!t||(i.prop(Ia.contextHash)||0)==r))return e.useNode(i,n),Si&&console.log(a+this.stackID(e)+` (via reuse of ${s.getName(i.type.id)})`),!0;if(!(i instanceof za)||0==i.children.length||i.positions[0]>0)break;let o=i.children[0];if(!(o instanceof za&&0==i.positions[0]))break;i=o}}let i=s.stateSlot(e.state,4);if(i>0)return e.reduce(i),Si&&console.log(a+this.stackID(e)+` (via always-reduce ${s.getName(65535&i)})`),!0;if(e.stack.length>=15e3)for(;e.stack.length>9e3&&e.forceReduce(););let o=this.tokens.getActions(e);for(let i=0;i<o.length;){let l=o[i++],c=o[i++],u=o[i++],p=i==o.length||!r,g=p?e:e.split();if(g.apply(l,c,u),Si&&console.log(a+this.stackID(g)+` (via ${65536&l?`reduce of ${s.getName(65535&l)}`:"shift"} for ${s.getName(c)} @ ${n}${g==e?"":", split"})`),p)return!0;g.pos>n?t.push(g):r.push(g)}return!1}advanceFully(e,t){let r=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>r)return ki(e,t),!0}}runRecovery(e,t,r){let n=null,s=!1;for(let a=0;a<e.length;a++){let i=e[a],o=t[a<<1],l=t[1+(a<<1)],c=Si?this.stackID(i)+" -> ":"";if(i.deadEnd){if(s)continue;if(s=!0,i.restart(),Si&&console.log(c+this.stackID(i)+" (restarted)"),this.advanceFully(i,r))continue}let u=i.split(),p=c;for(let e=0;u.forceReduce()&&e<10&&(Si&&console.log(p+this.stackID(u)+" (via force-reduce)"),!this.advanceFully(u,r));e++)Si&&(p=this.stackID(u)+" -> ");for(let e of i.recoverByInsert(o))Si&&console.log(c+this.stackID(e)+" (via recover-insert)"),this.advanceFully(e,r);this.stream.end>i.pos?(l==i.pos&&(l++,o=0),i.recoverByDelete(o,l),Si&&console.log(c+this.stackID(i)+` (via recover-delete ${this.parser.getName(o)})`),ki(i,r)):(!n||n.score<i.score)&&(n=i)}return n}stackToTree(e){return e.close(),za.build({buffer:pi.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(xi||(xi=new WeakMap)).get(e);return t||xi.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function ki(e,t){for(let r=0;r<t.length;r++){let n=t[r];if(n.pos==e.pos&&n.sameState(e))return void(t[r].score<e.score&&(t[r]=e))}t.push(e)}class Ci{constructor(e,t,r){this.source=e,this.flags=t,this.disabled=r}allows(e){return!this.disabled||0==this.disabled[e]}}class Ri extends ai{constructor(e){if(super(),this.wrappers=[],14!=e.version)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let r=0;r<e.repeatNodeCount;r++)t.push("");let r=Object.keys(e.topRules).map((t=>e.topRules[t][1])),n=[];for(let e=0;e<t.length;e++)n.push([]);function s(e,t,r){n[e].push([t,t.deserialize(String(r))])}if(e.nodeProps)for(let t of e.nodeProps){let e=t[0];"string"==typeof e&&(e=Ia[e]);for(let r=1;r<t.length;){let n=t[r++];if(n>=0)s(n,e,t[r++]);else{let a=t[r+-n];for(let i=-n;i>0;i--)s(t[r++],e,a);r++}}}this.nodeSet=new Aa(t.map(((t,s)=>Fa.define({name:s>=this.minRepeatTerm?void 0:t,id:s,props:n[s],top:r.indexOf(s)>-1,error:0==s,skipped:e.skippedNodes&&e.skippedNodes.indexOf(s)>-1})))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=Ca;let a=gi(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let e=0;e<this.specializerSpecs.length;e++)this.specialized[e]=this.specializerSpecs[e].term;this.specializers=this.specializerSpecs.map(Ii),this.states=gi(e.states,Uint32Array),this.data=gi(e.stateData),this.goto=gi(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map((e=>"number"==typeof e?new mi(a,e):e)),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,r){let n=new Ei(this,e,t,r);for(let s of this.wrappers)n=s(n,e,t,r);return n}getGoto(e,t,r=!1){let n=this.goto;if(t>=n[0])return-1;for(let s=n[t+1];;){let t=n[s++],a=1&t,i=n[s++];if(a&&r)return i;for(let r=s+(t>>1);s<r;s++)if(n[s]==e)return i;if(a)return-1}}hasAction(e,t){let r=this.data;for(let n=0;n<2;n++)for(let s,a=this.stateSlot(e,n?2:1);;a+=3){if(65535==(s=r[a])){if(1!=r[a+1]){if(2==r[a+1])return Ni(r,a+2);break}s=r[a=Ni(r,a+2)]}if(s==t||0==s)return Ni(r,a+1)}return 0}stateSlot(e,t){return this.states[6*e+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){if(t==this.stateSlot(e,4))return!0;for(let r=this.stateSlot(e,1);;r+=3){if(65535==this.data[r]){if(1!=this.data[r+1])return!1;r=Ni(this.data,r+2)}if(t==Ni(this.data,r+1))return!0}}nextStates(e){let t=[];for(let r=this.stateSlot(e,1);;r+=3){if(65535==this.data[r]){if(1!=this.data[r+1])break;r=Ni(this.data,r+2)}if(!(1&this.data[r+2])){let e=this.data[r+1];t.some(((t,r)=>1&r&&t==e))||t.push(this.data[r],e)}}return t}configure(e){let t=Object.assign(Object.create(Ri.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let r=this.topRules[e.top];if(!r)throw new RangeError(`Invalid top rule name ${e.top}`);t.top=r}return e.tokenizers&&(t.tokenizers=this.tokenizers.map((t=>{let r=e.tokenizers.find((e=>e.from==t));return r?r.to:t}))),e.specializers&&(t.specializers=this.specializers.slice(),t.specializerSpecs=this.specializerSpecs.map(((r,n)=>{let s=e.specializers.find((e=>e.from==r.external));if(!s)return r;let a=Object.assign(Object.assign({},r),{external:s.to});return t.specializers[n]=Ii(a),a}))),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),null!=e.strict&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),null!=e.bufferLength&&(t.bufferLength=e.bufferLength),t}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return null==t?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),r=t.map((()=>!1));if(e)for(let n of e.split(" ")){let e=t.indexOf(n);e>=0&&(r[e]=!0)}let n=null;for(let e=0;e<t.length;e++)if(!r[e])for(let r,s=this.dialects[t[e]];65535!=(r=this.data[s++]);)(n||(n=new Uint8Array(this.maxTerm+1)))[r]=1;return new Ci(e,r,n)}static deserialize(e){return new Ri(e)}}function Ni(e,t){return e[t]|e[t+1]<<16}function Ii(e){if(e.external){let t=e.extend?1:0;return(r,n)=>e.external(r,n)<<1|t}return e.get}const Di=Ri.deserialize({version:14,states:"3UO]QPOOP!jOPOOO]QPO'#CkO#^QPO'#CjO%qQQO'#ClOOQO'#DP'#DPOOQO'#DO'#DOO%xQPO'#DOO%}QSO'#C{OOQO'#C|'#C|O&VQPO'#C|O&bQPO'#DRO&gQPO'#DSO&lQSO'#DUOOQO'#DX'#DXO&qQSO'#DWO&vQPO'#DYO&{QPO'#D[OOQO'#DV'#DVOOQO'#Cj'#CjQ'QQPOOOOQO'#C`'#C`P'oO!bO'#C^POOO)C?X)C?XO'zQPO,59VO(RQSO,59hO(^QPO,59TO)OQPO,58zO)VQPO,59VO)VQPO,59VO)VQPO,59VO)VQPO,59VO)VQPO,59VO)VQPO,59VO)VQPO,59VOOQO'#Co'#CoOOQO'#Cu'#CuO)[QWO'#CuO)sQ`O'#CwO)xQPO'#CwO#hQQO'#CmO)}QWO,59WO#hQQO'#CmOOQO'#Cm'#CmOOQO,59W,59WO#hQQO,59jO*]QPO,59hO*]QPO,59gOOQO,59h,59hO#hQQO,59mO#hQQO,59nOOQO,59p,59pO+QQPO,59rO+xQPO,59tO+xQPO,59vO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zPOOO'#D_'#D_P,sO!bO,58xPOOO,58x,58xOOQO1G.q1G.qOOQO1G/S1G/SOOQO1G.o1G.oOOQO1G.f1G.fO)VQPO'#CkO-pQPO1G.qO.iQPO1G.qO.pQPO1G.qO/iQPO1G.qO/pQPO1G.qO/wQPO1G.qO0OQ`O,59cOOQO,59c,59cO0ZQ`O,59cO0`QWO,59XO#hQQO,59XO#hQQO,59XO#hQQO,59XOOQO1G.r1G.rO0nQWO,59XO1SQWO1G/UO*]QPO'#C|O1bQpO1G/RO2YQWO1G/XO2kQWO'#DTO2|QPO1G/YOOQO1G/^1G/^O3UQPO'#CuOOQO'#DZ'#DZO3aQPO1G/`O3fQPO'#D]O3kQPO1G/bO4bQPO1G.fO5ZQPO1G.fO5bQPO1G.fO6ZQPO1G.fO6bQPO1G.fO6iQPO1G.fO7bQPO1G.fO7iQPO1G.fPOOO-E7]-E7]POOO1G.d1G.dO7pQPO,59VOOQO1G.}1G.}O8[QPO1G.}OOQO1G.s1G.sO8rQWO1G.sO8yQWO1G.sOOQO7+$p7+$pO9QQSO,59hO#hQQO'#D`O9YQPO7+$sOOQO7+$s7+$sO#hQQO,59oOOQO7+$t7+$tO9bQPO7+$zO:YQPO,59wO:bQPO7+$|O;YQ`O7+$iO;_QWO,59zOOQO-E7^-E7^OOQO<<H_<<H_O;pQWO1G/ZOOQO<<Hf<<HfOOQO'#D^'#D^O<RQPO1G/cOOQO<<Hh<<HhOOQO<<HT<<HTO:YQPO'#DaO<ZQPO7+$}OOQO,59{,59{OOQO-E7_-E7_",stateData:"<p~O!WOSPOS!XPQ~OeXOfXOgXOhXO!]QO!`SO!bYO!zUO!{TO!|TO!}TO#OTO#PZO#R[O#S]O#U^O#V^O#W`O#XaO~O!XfO~OTlOUmOVoOWnOXpOYqO!_rOZ^X[^X~O!U^X!^^X~P!oOdsOesOfsOgsOhsOjuOmwOnwO!]xO!bzO!czO!dsO!esO!fsO!gsO!hsO!isO!jsO!ksO!lsO!msO!nsO!osO!ptO!qtO!rtO!stO!ttO!utO!vtO!wtO!xtO!yvO~O!a|O~P#hO!]}O~Oq!OOt!PO~Oe!QOf!QOg!QO~O!]!RO~O!]!SO~O#T!TO~O#T!UO~O!]!VO~O!]!WO~OT!XOU!YOV!ZOW![OX!]OY!^OZ!`O[!aO!_!_O~O!Y!bO!Z!bO![!dO~O!^!eO~P!oOq!OOt!PO!^!fO~O!^!gOTSXUSXVSXWSXXSXYSXZSX[SX!_SX~O!^!hO~P'QO!]!iO~O!y!pOTiXYiXbiX!aiX!^iX#QiX~Ol!qO~O!y!rO~OT!uOY!vOb!tO!a!wO~OeXOfXOgXOhXO!]!zO!bYO!zUO!{TO!|TO!}TO#OTO~O#PZOTzaUzaVzaWzaXzaYzaZza[za!Uza!_za!^za~Oj#QOmwOnwO!ptO!qtO!rtO!stO!ttO!utO!vtO!wtO!xtO!yvO~O!Y!bO!Z!bO![#`O~OUmOVoOWnOXpO!_rOY_iZ_i[_i!U_i!^_i~OT_i~P-OOUmOT_iV_iX_iY_iZ_i[_i!U_i!__i!^_i~OW_i~P-wOWnO~P-wOUmOVoOWnOT_iY_iZ_i[_i!U_i!__i!^_i~OX_i~P.wOTlO~P-OOXpO~P.wOl#bOm#cOn#cO~Ol#bO~OT!uOY!vOb!tO!^#dO~OT!uOY!vOb!tO!aaa!^aa#Qaa~OT!uOY!vOb!tO!^#gO~Oq!OOToiUoiVoiWoiXoiYoiZoi[oi!Uoi!_oi!^oi~OT!uOY!vOb!tO!^#kO#Q#iO~OT!uOY!vOb!tO!^wX#QwX~O!^#mO#Q#lO~O!y!pO!^iX#QiX~O!^#nO~O#Q#oO~O!^#pO~OU!YOV!ZOW![OX!]O!_!_OYSiZSi[Si!USi!^Si~OTSi~P3pOU!YOTSiVSiXSiYSiZSi[Si!USi!_Si!^Si~OW![O~P4iOWSi~P4iOU!YOV!ZOW![OTSiYSiZSi[Si!USi!_Si!^Si~OXSi~P5iOT!XO~P3pOX!]O~P5iOT!XOU!YOV!ZOW![OX!]OY!^O!_!_O[Si!USi!^Si~OZSi~P6pOZ!`O~P6pOTlOUmOVoOWnOXpOYqO!^!eO!_rO~O!y#qO~Ob!tOYai!aai!^ai#Qai~OTai~P8aOT!uO~P8aOq!OO!^!fO~O!^#tO#Q#iO~O#PZOT|qU|qV|qW|qX|qY|qZ|q[|q!U|q!_|q!^|q~Oe#wOf#wO~O#PZOT!OqU!OqV!OqW!OqX!OqY!OqZ!Oq[!Oq!U!Oq!_!Oq!^!Oq~Ol#zO~OT!uOY!vOb!tO!^!Sa#Q!Sa~OT!uOY!vOb!tO!^wi#Qwi~O#Q#{O!^!Pi~O#Q#{O!^!Pq~OgfePqbjmjnln~",goto:")S!UPP!VP!YPPPPPPPP!{#Y#i$b$oP%bPPPPP%oP%oPPP$b&QP&j&zP'[$b'r$b$b'u(S'u(a'u(g(j(p(v(|RgPQdOQkQQ!h!YQ#V!XQ#W!ZQ#X![Q#Y!]Q#Z!^Q#[!_Q#]!`R#^!ageOQ!X!Y!Z![!]!^!_!`!adeO!X!Y!Z![!]!^!_!`!aRjQdRO!X!Y!Z![!]!^!_!`!aQhQQ!emQ!jlQ!knQ!loQ!mpQ!nqQ!orR#a!igcOQ!X!Y!Z![!]!^!_!`!aQySQ!sxQ!xzQ!y}Q!|!RQ!}!SQ#d!tQ#e!uQ#f!vQ#r#iR#u#lg{Sxz}!R!S!t!u!v#i#lf{Sxz}!R!S!t!u!v#i#lT#R!V!WdWO!X!Y!Z![!]!^!_!`!aQiQQ!f!OQ!{!PR#h!zmXOQ!O!P!X!Y!Z![!]!^!_!`!a!zmVOQ!O!P!X!Y!Z![!]!^!_!`!a!zfcOQ!X!Y!Z![!]!^!_!`!aQ#P!UQ#v#nR#y#pR#O!SgbOQ!X!Y!Z![!]!^!_!`!ag_OQ!X!Y!Z![!]!^!_!`!aQ#S!VR#T!WR#U!WQ#x#oR#}#{Q!cfR#_!cQ#j!|R#s#jQ#|#xR$O#|",nodeNames:"⚠ LineComment BlockComment TraceQL SpansetPipelineExpression And Gt Desc Lt Anc Or Pipe ExperimentalOp WrappedSpansetPipeline SpansetPipeline SpansetExpression SpansetFilter FieldExpression FieldOp Static String Integer Float Duration TemplateVariable IntrinsicField Parent AttributeField Identifier Resource Span ScalarFilter ScalarExpression ScalarOp Aggregate AggregateExpression ComparisonOp GroupOperation SelectOperation SelectArgs CoalesceOperation MetricsOperation MetricsOperationBasic MetricsOperationBasicType MetricsOperationHistogram MetricsExpression MetricsOperationQuantile MetricsOperationQuantileArgs MetricsOperationQuantileArgsType",maxTerm:101,skippedNodes:[0,1,2,49],repeatNodeCount:3,tokenData:"&+e~R!aX^%Wpq%Wqr%{rs'Tst(gtu*muv2fvw3bwx(gxy3myz3zz{2f{|2f|}4P}!O4U!O!P4_!P!Q4d!Q![5_![!](g!]!^(g!^!_7R!_!`7g!`!a7q!a!b(g!b!c(g!c!}(g#Q#R8V#R#S(g#S#T8^#T#U<f#U#V?[#V#WAS#W#X!:j#X#Y!BU#Y#Z!Fv#Z#[(g#[#]!Kh#]#^#/f#^#_(g#_#`#7Q#`#a(g#a#b#:t#b#c#?h#c#d#EY#d#e#GQ#e#f$%d#f#g$6d#g#h%$Y#h#i%>T#i#j%Lc#j#o(g#o#p&*u#p#q&*z#q#r&+X#r#s&+^#y#z%W$f$g%W#BY#BZ%W$IS$I_%W$I|$JO%W$JT$JU%W$KV$KW%W&FU&FV%W~%]Y!W~X^%Wpq%W#y#z%W$f$g%W#BY#BZ%W$IS$I_%W$I|$JO%W$JT$JU%W$KV$KW%W&FU&FV%W#Q&QS!cS!^!_&^!_!`&k!`!a&r#r#s&z!d&cP[!d!^!_&f!d&kO[!dh&rOtWb`!d&wP[!d!`!a&f!|'TOtW[!db`t'WVOr'Trs'ms#O'T#O#P*^#P;'S'T;'S;=`*g<%lO'Tt'tZdSlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gp(lZlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gp)bVOr)_rs(gs#O)_#O#P)w#P;'S)_;'S;=`*Q<%lO)_p)zQrs)_#O#P)_p*TP;=`<%l)_p*ZP;=`<%l(gt*aQrs'T#O#P'Tt*jP;=`<%l'Tv*relpOp(grs,Tst,mtu,muv,mwx,mz|,m}![(g![!],m!]!^,m!a!b,m!b!c,m!c!},m!}#Q(g#R#S,m#S#T,m#T#o,m#o#p-|#s;'S(g;'S;=`*W<%lO(gv,WVOr,Trs,ms#O,T#O#P-m#P;'S,T;'S;=`-v<%lO,Tv,tZhUlpOp,mrs,Tsv,mwx,mz|,m}!^,m!a#Q,m#R#o,m#s;'S,m;'S;=`-g<%lO,mv-jP;=`<%l,mv-pQrs,T#O#P,Tv-yP;=`<%l,Tv.P^rs.{st/etu/euv/ewx/ez|/e![!]/e!]!^/e!a!b/e!b!c/e!c!}/e#R#S/e#S#T/e#T#o/ev/OVOr.{rs/es#O.{#O#P2V#P;'S.{;'S;=`2`<%lO.{v/h^Op/ers.{sv/ewx/ez|/e}![/e![!]0d!]!^/e!a#Q/e#R#o/e#q#r1x#s;'S/e;'S;=`2P<%lO/ev0geOp/ers.{sv/ewx/ez|/e}!O/e!O!P0d!P!Q/e!Q![0d![!]0d!]!^/e!a!c/e!c!}0d!}#Q/e#R#S0d#S#T/e#T#o0d#q#r1x#s;'S/e;'S;=`2P<%lO/ev2POhUlpv2SP;=`<%l/ev2YQrs.{#O#P.{v2cP;=`<%l.{#l2oZq!jb`lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(g~3ePvw3h~3mOT~^3rP!]Uyz3uW3zO#TW~4PO!^~~4UO#Q~#Q4_O!bUq!jb`~4dO!y~~4kQq!jb`z{4q!P!Q4v~4vO!X~~4{SP~OY4vZ;'S4v;'S;=`5X<%lO4v~5[P;=`<%l4v~5dWe~!O!P5|!Q![5_#[#]6n#a#b6s#b#c6{#g#h6n#i#j6{${$|6{~6PP!Q![6S~6XVf~!Q![6S#[#]6n#a#b6s#b#c6{#g#h6n#i#j6{${$|6{~6sOg~~6xPg~#g#h6n~7OP#g#h6n!|7[QtWW!db`!^!_7b!_!`&k!d7gOX!dh7nPtWb`#r#s&k!|7zQtWU!db`!_!`&k!`!a8Q!d8VOV!d!z8^Oq!jb`t8cdlpOp8^pr9qrs:`sv8^vw9qwx8^xz9qz|8^|}9q}!^8^!^!a9q!a#Q8^#Q#R9q#R#S8^#S#T'm#T#o8^#o#s9q#s;'S8^;'S;=`<`<%lO8^S9tTO#S9q#S#T:T#T;'S9q;'S;=`:Y<%lO9qS:YOdSS:]P;=`<%l9qt:cXOr:`rs8^s#O:`#O#P;O#P#S:`#S#T;n#T;'S:`;'S;=`<Y<%lO:`t;RXOr9qrs:`s#O9q#O#P:`#P#S9q#S#T:T#T;'S9q;'S;=`:Y<%lO9qt;sVdSOr)_rs(gs#O)_#O#P)w#P;'S)_;'S;=`*Q<%lO)_t<]P;=`<%l:`t<cP;=`<%l8^r<k]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#j(g#j#k=d#k#o(g#s;'S(g;'S;=`*W<%lO(gr=i]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#Z(g#Z#[>b#[#o(g#s;'S(g;'S;=`*W<%lO(gr>iZ!}QlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gr?a]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#m(g#m#n@Y#n#o(g#s;'S(g;'S;=`*W<%lO(gr@aZ#PQlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gvAXalpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#[(g#[#]B^#]#`(g#`#aJv#a#c(g#c#d! h#d#o(g#s;'S(g;'S;=`*W<%lO(gvBc]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#](g#]#^C[#^#o(g#s;'S(g;'S;=`*W<%lO(gvCa]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#`(g#`#aDY#a#o(g#s;'S(g;'S;=`*W<%lO(gvD_]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#W(g#W#XEW#X#o(g#s;'S(g;'S;=`*W<%lO(gvE]]lpOp(grs)_sv(gwx(gz|(g}!^(g!a!e(g!e!fFU!f#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gvFZ]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#c(g#c#dGS#d#o(g#s;'S(g;'S;=`*W<%lO(gvGX]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#i(g#i#jHQ#j#o(g#s;'S(g;'S;=`*W<%lO(gvHV]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#b(g#b#cIO#c#o(g#s;'S(g;'S;=`*W<%lO(gvIT]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#iI|#i#o(g#s;'S(g;'S;=`*W<%lO(gvJTZ!pUlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gtJ{]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#](g#]#^Kt#^#o(g#s;'S(g;'S;=`*W<%lO(gtKy]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#YLr#Y#o(g#s;'S(g;'S;=`*W<%lO(gtLw]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#b(g#b#cMp#c#o(g#s;'S(g;'S;=`*W<%lO(gtMu]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#iNn#i#o(g#s;'S(g;'S;=`*W<%lO(gtNuZ!mSlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gv! malpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U!!r#U#b(g#b#c!(b#c#i(g#i#j!.Q#j#o(g#s;'S(g;'S;=`*W<%lO(gr!!w]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#`(g#`#a!#p#a#o(g#s;'S(g;'S;=`*W<%lO(gr!#u]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y!$n#Y#o(g#s;'S(g;'S;=`*W<%lO(gr!$s]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#g(g#g#h!%l#h#o(g#s;'S(g;'S;=`*W<%lO(gr!%q]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#V(g#V#W!&j#W#o(g#s;'S(g;'S;=`*W<%lO(gr!&o]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y!'h#Y#o(g#s;'S(g;'S;=`*W<%lO(gr!'oZ#SQlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gt!(g]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#g(g#g#h!)`#h#o(g#s;'S(g;'S;=`*W<%lO(gt!)e]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#i(g#i#j!*^#j#o(g#s;'S(g;'S;=`*W<%lO(gt!*c]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#a(g#a#b!+[#b#o(g#s;'S(g;'S;=`*W<%lO(gt!+a]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y!,Y#Y#o(g#s;'S(g;'S;=`*W<%lO(gt!,_]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g!-W#g#o(g#s;'S(g;'S;=`*W<%lO(gt!-_Z!oSlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gr!.V]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#b(g#b#c!/O#c#o(g#s;'S(g;'S;=`*W<%lO(gr!/T]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i!/|#i#o(g#s;'S(g;'S;=`*W<%lO(gr!0R]lpOp(grs)_sv(gwx(gxy!0zz|(g}!^(g!a#Q(g#R#S!1V#S#o(g#s;'S(g;'S;=`*W<%lO(gQ!0}Pyz!1QQ!1VO!zQr!1[]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#c(g#c#d!2T#d#o(g#s;'S(g;'S;=`*W<%lO(gr!2Y]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#j(g#j#k!3R#k#o(g#s;'S(g;'S;=`*W<%lO(gr!3W]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y!4P#Y#o(g#s;'S(g;'S;=`*W<%lO(gr!4U]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g!4}#g#o(g#s;'S(g;'S;=`*W<%lO(gr!5S[lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#S!5x#S#o(g#s;'S(g;'S;=`*W<%lO(gr!5}]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i!6v#i#o(g#s;'S(g;'S;=`*W<%lO(gr!6{]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#](g#]#^!7t#^#o(g#s;'S(g;'S;=`*W<%lO(gr!7y]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#a(g#a#b!8r#b#o(g#s;'S(g;'S;=`*W<%lO(gr!8w]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y!9p#Y#o(g#s;'S(g;'S;=`*W<%lO(gr!9wZ#VQlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gv!:o]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#i(g#i#j!;h#j#o(g#s;'S(g;'S;=`*W<%lO(gv!;m]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g!<f#g#o(g#s;'S(g;'S;=`*W<%lO(gv!<k]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U!=d#U#o(g#s;'S(g;'S;=`*W<%lO(gv!=i]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i!>b#i#o(g#s;'S(g;'S;=`*W<%lO(gv!>g]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#](g#]#^!?`#^#o(g#s;'S(g;'S;=`*W<%lO(gv!?e]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#c(g#c#d!@^#d#o(g#s;'S(g;'S;=`*W<%lO(gv!@c]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#b(g#b#c!A[#c#o(g#s;'S(g;'S;=`*W<%lO(gv!AcZ!qUlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gt!BZ]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g!CS#g#o(g#s;'S(g;'S;=`*W<%lO(gt!CX]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g!DQ#g#o(g#s;'S(g;'S;=`*W<%lO(gt!DV]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#c(g#c#d!EO#d#o(g#s;'S(g;'S;=`*W<%lO(gt!ET]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g!E|#g#o(g#s;'S(g;'S;=`*W<%lO(gt!FTZ!hSlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gt!F{]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U!Gt#U#o(g#s;'S(g;'S;=`*W<%lO(gt!Gy]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#`(g#`#a!Hr#a#o(g#s;'S(g;'S;=`*W<%lO(gt!Hw]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#g(g#g#h!Ip#h#o(g#s;'S(g;'S;=`*W<%lO(gt!Iu]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y!Jn#Y#o(g#s;'S(g;'S;=`*W<%lO(gt!JuZ!eSlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gr!Km]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#](g#]#^!Lf#^#o(g#s;'S(g;'S;=`*W<%lO(gr!Lk]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#g(g#g#h!Md#h#o(g#s;'S(g;'S;=`*W<%lO(gr!Mi]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i!Nb#i#o(g#s;'S(g;'S;=`*W<%lO(gr!Ng]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#c(g#c#d# `#d#o(g#s;'S(g;'S;=`*W<%lO(gr# e]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#Z(g#Z#[#!^#[#o(g#s;'S(g;'S;=`*W<%lO(gr#!c]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g##[#g#o(g#s;'S(g;'S;=`*W<%lO(gr##a]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U#$Y#U#o(g#s;'S(g;'S;=`*W<%lO(gr#$_]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#a(g#a#b#%W#b#o(g#s;'S(g;'S;=`*W<%lO(gr#%][lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#S#&R#S#o(g#s;'S(g;'S;=`*W<%lO(gr#&W]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#c(g#c#d#'P#d#o(g#s;'S(g;'S;=`*W<%lO(gr#'U]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#j(g#j#k#'}#k#o(g#s;'S(g;'S;=`*W<%lO(gr#(S]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y#({#Y#o(g#s;'S(g;'S;=`*W<%lO(gr#)Q]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g#)y#g#o(g#s;'S(g;'S;=`*W<%lO(gr#*O[lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#S#*t#S#o(g#s;'S(g;'S;=`*W<%lO(gr#*y]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i#+r#i#o(g#s;'S(g;'S;=`*W<%lO(gr#+w]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#](g#]#^#,p#^#o(g#s;'S(g;'S;=`*W<%lO(gr#,u]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#a(g#a#b#-n#b#o(g#s;'S(g;'S;=`*W<%lO(gr#-s]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y#.l#Y#o(g#s;'S(g;'S;=`*W<%lO(gr#.sZ#WQlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gt#/k]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#b(g#b#c#0d#c#o(g#s;'S(g;'S;=`*W<%lO(gt#0i]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i#1b#i#o(g#s;'S(g;'S;=`*W<%lO(gt#1g]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y#2`#Y#o(g#s;'S(g;'S;=`*W<%lO(gt#2e]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g#3^#g#o(g#s;'S(g;'S;=`*W<%lO(gt#3c]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#b(g#b#c#4[#c#o(g#s;'S(g;'S;=`*W<%lO(gt#4a]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U#5Y#U#o(g#s;'S(g;'S;=`*W<%lO(gt#5_]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#`(g#`#a#6W#a#o(g#s;'S(g;'S;=`*W<%lO(gt#6_Z!kSlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gv#7V]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#](g#]#^#8O#^#o(g#s;'S(g;'S;=`*W<%lO(gv#8T]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#b(g#b#c#8|#c#o(g#s;'S(g;'S;=`*W<%lO(gv#9R]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#W(g#W#X#9z#X#o(g#s;'S(g;'S;=`*W<%lO(gv#:RZ!rUlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gr#:y_lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U#;x#U#](g#]#^#=p#^#o(g#s;'S(g;'S;=`*W<%lO(gr#;}]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#l(g#l#m#<v#m#o(g#s;'S(g;'S;=`*W<%lO(gr#<}Z!{QlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gr#=u]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#b(g#b#c#>n#c#o(g#s;'S(g;'S;=`*W<%lO(gr#>uZ!|QlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gv#?m_lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U#@l#U#](g#]#^#Cb#^#o(g#s;'S(g;'S;=`*W<%lO(gv#@q]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#a(g#a#b#Aj#b#o(g#s;'S(g;'S;=`*W<%lO(gv#Ao]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y#Bh#Y#o(g#s;'S(g;'S;=`*W<%lO(gv#BoZ!sUlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gt#Cg]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#`(g#`#a#D`#a#o(g#s;'S(g;'S;=`*W<%lO(gt#DgZ!fSlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gt#E_]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#_(g#_#`#FW#`#o(g#s;'S(g;'S;=`*W<%lO(gt#F_Z!gSlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(g~#GV_lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U#HU#U#f(g#f#g#Lv#g#o(g#s;'S(g;'S;=`*W<%lO(g~#HZ]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g#IS#g#o(g#s;'S(g;'S;=`*W<%lO(g~#IX]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y#JQ#Y#o(g#s;'S(g;'S;=`*W<%lO(g~#JV]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#b(g#b#c#KO#c#o(g#s;'S(g;'S;=`*W<%lO(g~#KT]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i#K|#i#o(g#s;'S(g;'S;=`*W<%lO(g~#LTZj~lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gt#L{]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#c(g#c#d#Mt#d#o(g#s;'S(g;'S;=`*W<%lO(gt#My]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#W(g#W#X#Nr#X#o(g#s;'S(g;'S;=`*W<%lO(gt#Nw]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#i(g#i#j$ p#j#o(g#s;'S(g;'S;=`*W<%lO(gt$ u]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#V(g#V#W$!n#W#o(g#s;'S(g;'S;=`*W<%lO(gt$!s]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y$#l#Y#o(g#s;'S(g;'S;=`*W<%lO(gt$#q]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g$$j#g#o(g#s;'S(g;'S;=`*W<%lO(gt$$qZ!nSlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gr$%i]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#i(g#i#j$&b#j#o(g#s;'S(g;'S;=`*W<%lO(gr$&g]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U$'`#U#o(g#s;'S(g;'S;=`*W<%lO(gr$'e]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#b(g#b#c$(^#c#o(g#s;'S(g;'S;=`*W<%lO(gr$(c]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i$)[#i#o(g#s;'S(g;'S;=`*W<%lO(gr$)a]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#](g#]#^$*Y#^#o(g#s;'S(g;'S;=`*W<%lO(gr$*_]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#`(g#`#a$+W#a#o(g#s;'S(g;'S;=`*W<%lO(gr$+]]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y$,U#Y#o(g#s;'S(g;'S;=`*W<%lO(gr$,Z[lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#S$-P#S#o(g#s;'S(g;'S;=`*W<%lO(gr$-U]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#c(g#c#d$-}#d#o(g#s;'S(g;'S;=`*W<%lO(gr$.S]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#j(g#j#k$.{#k#o(g#s;'S(g;'S;=`*W<%lO(gr$/Q]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y$/y#Y#o(g#s;'S(g;'S;=`*W<%lO(gr$0O]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g$0w#g#o(g#s;'S(g;'S;=`*W<%lO(gr$0|[lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#S$1r#S#o(g#s;'S(g;'S;=`*W<%lO(gr$1w]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i$2p#i#o(g#s;'S(g;'S;=`*W<%lO(gr$2u]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#](g#]#^$3n#^#o(g#s;'S(g;'S;=`*W<%lO(gr$3s]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#a(g#a#b$4l#b#o(g#s;'S(g;'S;=`*W<%lO(gr$4q]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y$5j#Y#o(g#s;'S(g;'S;=`*W<%lO(gr$5qZ#XQlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(g~$6ialpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U$7n#U#X(g#X#Y$:d#Y#c(g#c#d$AQ#d#o(g#s;'S(g;'S;=`*W<%lO(gr$7s]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i$8l#i#o(g#s;'S(g;'S;=`*W<%lO(gr$8q]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y$9j#Y#o(g#s;'S(g;'S;=`*W<%lO(gr$9qZ#UQlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(g~$:i]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#g(g#g#h$;b#h#o(g#s;'S(g;'S;=`*W<%lO(g~$;g]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#c(g#c#d$<`#d#o(g#s;'S(g;'S;=`*W<%lO(g~$<e]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#i(g#i#j$=^#j#o(g#s;'S(g;'S;=`*W<%lO(g~$=c]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g$>[#g#o(g#s;'S(g;'S;=`*W<%lO(g~$>a]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#V(g#V#W$?Y#W#o(g#s;'S(g;'S;=`*W<%lO(g~$?_]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y$@W#Y#o(g#s;'S(g;'S;=`*W<%lO(g~$@_Zm~lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gv$AV]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#c(g#c#d$BO#d#o(g#s;'S(g;'S;=`*W<%lO(gv$BT]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i$B|#i#o(g#s;'S(g;'S;=`*W<%lO(gv$CR_lpOp(grs)_sv(gwx(gz|(g}!^(g!a!p(g!p!q$DQ!q!u(g!u!v$Gt!v#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gv$DV]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U$EO#U#o(g#s;'S(g;'S;=`*W<%lO(gv$ET]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#a(g#a#b$E|#b#o(g#s;'S(g;'S;=`*W<%lO(gv$FR]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y$Fz#Y#o(g#s;'S(g;'S;=`*W<%lO(gv$GRZ!tUlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gv$Gy]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y$Hr#Y#o(g#s;'S(g;'S;=`*W<%lO(gv$Hw]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g$Ip#g#o(g#s;'S(g;'S;=`*W<%lO(gv$Iu]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#j(g#j#k$Jn#k#o(g#s;'S(g;'S;=`*W<%lO(gv$Js]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#](g#]#^$Kl#^#o(g#s;'S(g;'S;=`*W<%lO(gv$Kq]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#V(g#V#W$Lj#W#o(g#s;'S(g;'S;=`*W<%lO(gv$Lo]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y$Mh#Y#o(g#s;'S(g;'S;=`*W<%lO(gv$Mm]lpOp(grs)_sv(gwx(gz|(g}!^(g!a!p(g!p!q$Nf!q#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gv$Nk]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U% d#U#o(g#s;'S(g;'S;=`*W<%lO(gv% i]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#a(g#a#b%!b#b#o(g#s;'S(g;'S;=`*W<%lO(gv%!g]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y%#`#Y#o(g#s;'S(g;'S;=`*W<%lO(gv%#gZ!uUlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(g~%$_blpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y%%g#Y#d(g#d#e%.R#e#h(g#h#i%0w#i#j%<]#j#o(g#s;'S(g;'S;=`*W<%lO(gv%%l_lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#`(g#`#a%&k#a#f(g#f#g%*_#g#o(g#s;'S(g;'S;=`*W<%lO(gr%&p]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y%'i#Y#o(g#s;'S(g;'S;=`*W<%lO(gr%'n]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#V(g#V#W%(g#W#o(g#s;'S(g;'S;=`*W<%lO(gr%(l]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i%)e#i#o(g#s;'S(g;'S;=`*W<%lO(gr%)lZ#RQlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gt%*d]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#j(g#j#k%+]#k#o(g#s;'S(g;'S;=`*W<%lO(gt%+b]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y%,Z#Y#o(g#s;'S(g;'S;=`*W<%lO(gt%,`]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g%-X#g#o(g#s;'S(g;'S;=`*W<%lO(gt%-`Z!lSlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(g~%.W]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U%/P#U#o(g#s;'S(g;'S;=`*W<%lO(g~%/U]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#b(g#b#c%/}#c#o(g#s;'S(g;'S;=`*W<%lO(g~%0UZn~lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gv%0|]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U%1u#U#o(g#s;'S(g;'S;=`*W<%lO(gv%1z]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i%2s#i#o(g#s;'S(g;'S;=`*W<%lO(gv%2x]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#i(g#i#j%3q#j#o(g#s;'S(g;'S;=`*W<%lO(gv%3v]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#g(g#g#h%4o#h#o(g#s;'S(g;'S;=`*W<%lO(gv%4v]!vUlpOp(grs)_sv(gwx(gz|(g}!^(g!a!o(g!o!p%5o!p#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gv%5t]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y%6m#Y#o(g#s;'S(g;'S;=`*W<%lO(gv%6r]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#g(g#g#h%7k#h#o(g#s;'S(g;'S;=`*W<%lO(gv%7p]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#g(g#g#h%8i#h#o(g#s;'S(g;'S;=`*W<%lO(gv%8n]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U%9g#U#o(g#s;'S(g;'S;=`*W<%lO(gv%9l]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#Z(g#Z#[%:e#[#o(g#s;'S(g;'S;=`*W<%lO(gv%:j]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y%;c#Y#o(g#s;'S(g;'S;=`*W<%lO(gv%;jZ!wUlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gr%<b]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#a(g#a#b%=Z#b#o(g#s;'S(g;'S;=`*W<%lO(gr%=bZ#OQlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gv%>Y]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g%?R#g#o(g#s;'S(g;'S;=`*W<%lO(gv%?W_lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U%@V#U#i(g#i#j%Jk#j#o(g#s;'S(g;'S;=`*W<%lO(gv%@[]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#V(g#V#W%AT#W#o(g#s;'S(g;'S;=`*W<%lO(gv%AY]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y%BR#Y#o(g#s;'S(g;'S;=`*W<%lO(gv%BW]lpOp(grs)_sv(gwx(gz|(g}!^(g!a!f(g!f!g%CP!g#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gv%CU]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#i(g#i#j%C}#j#o(g#s;'S(g;'S;=`*W<%lO(gv%DS]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#f(g#f#g%D{#g#o(g#s;'S(g;'S;=`*W<%lO(gv%EQ]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#T(g#T#U%Ey#U#o(g#s;'S(g;'S;=`*W<%lO(gv%FO]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i%Fw#i#o(g#s;'S(g;'S;=`*W<%lO(gv%F|]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#](g#]#^%Gu#^#o(g#s;'S(g;'S;=`*W<%lO(gv%Gz]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#c(g#c#d%Hs#d#o(g#s;'S(g;'S;=`*W<%lO(gv%Hx]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#b(g#b#c%Iq#c#o(g#s;'S(g;'S;=`*W<%lO(gv%IxZ!xUlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gt%Jp]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y%Ki#Y#o(g#s;'S(g;'S;=`*W<%lO(gt%KpZ!dSlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gt%Lh]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#b(g#b#c%Ma#c#o(g#s;'S(g;'S;=`*W<%lO(gt%Mf]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#g(g#g#h%N_#h#o(g#s;'S(g;'S;=`*W<%lO(gt%Nd_lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y& c#Y#d(g#d#e&#Z#e#o(g#s;'S(g;'S;=`*W<%lO(gt& h]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#h(g#h#i&!a#i#o(g#s;'S(g;'S;=`*W<%lO(gt&!hZ!iSlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(gt&#`]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y&$X#Y#o(g#s;'S(g;'S;=`*W<%lO(gt&$^]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#V(g#V#W&%V#W#o(g#s;'S(g;'S;=`*W<%lO(gt&%[]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#](g#]#^&&T#^#o(g#s;'S(g;'S;=`*W<%lO(gt&&Y]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#Y(g#Y#Z&'R#Z#o(g#s;'S(g;'S;=`*W<%lO(gt&'W]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#](g#]#^&(P#^#o(g#s;'S(g;'S;=`*W<%lO(gt&(U]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#X(g#X#Y&(}#Y#o(g#s;'S(g;'S;=`*W<%lO(gt&)S]lpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#W(g#W#X&){#X#o(g#s;'S(g;'S;=`*W<%lO(gt&*SZ!jSlpOp(grs)_sv(gwx(gz|(g}!^(g!a#Q(g#R#o(g#s;'S(g;'S;=`*W<%lO(g~&*zO!`~~&+PPZ~#p#q&+S~&+XOY~~&+^O!a~!t&+eO!_!db`",tokenizers:[1,2,3,4,5,6,new vi("j~RQYZXz{^~^O!Z~~aP!P!Qd~iO![~~",25,56)],topRules:{TraceQL:[0,3]},tokenPrec:1261}),$i=17,Fi=25,Ai=34,Qi=37,Li=38,Wi=39;function zi(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qi(e,t){const r=e.cursorAt(t);do{if(r.from===t||r.to===t){const{node:e}=r;if(e.type.isError)return e}}while(r.next());return null}function Mi(e,t){return e[t]}function Vi(e,t){let r=e;for(const[e,n]of t){if(r=Mi(r,e),null===r)return null;if(void 0===n.find((e=>e===(null==r?void 0:r.type.id))))return null}return r}function Ui(e,t){return t.slice(e.from===e.to?e.from-1:e.from,e.to)}function Bi(e,t){return e.every(((e,r)=>e===t[r]))}const Gi=[{path:[0,27],fun:function(e,t){const r=Vi(e,[["parent",[27]]]),n=r?Ui(r,t):"";if("."===n)return{type:"SPANSET_ONLY_DOT"};const s=n.indexOf("."),a=n.slice(0,s);return["span","resource","parent"].find((e=>e===a))?{type:"SPANSET_IN_NAME_SCOPE",scope:a}:{type:"SPANSET_IN_NAME"}}},{path:[0,$i],fun:Ji},{path:[0,16],fun:function(e,t,r){const n=Xi(e,t,r);return n||{type:"SPANSET_EXPRESSION_OPERATORS_WITH_MISSING_CLOSED_BRACE"}}},{path:[0,Ai],fun:Zi},{path:[0,Fi],fun:Zi},{path:[0,Qi],fun:Zi},{path:[0,Li],fun:Zi},{path:[0,4],fun:function(e,t,r){var n;return 11===(null===(n=e.prevSibling)||void 0===n?void 0:n.type.id)?{type:"SPANSET_PIPELINE_AFTER_OPERATOR"}:{type:"NEW_SPANSET"}}},{path:[0,31,14],fun:function(e,t,r){var n;if(36!==(null===(n=e.prevSibling)||void 0===n?void 0:n.type.id))return{type:"SPANSET_COMPARISON_OPERATORS"}}},{path:[$i],fun:Yi},{path:[16],fun:Yi},{path:[4],fun:Hi},{path:[3],fun:Hi},{path:[20,19],fun:Ji}],Xi=(e,t,r)=>{const n=e=>{const r=Vi(e,[["firstChild",[27]]]),n=r?Ui(r,t):"",s=n.indexOf(".");return n.slice(0,s)};if(" "===t[r-1])return;const s=Vi(e,[["firstChild",[$i]]]);if(s)return{type:"SPANSET_IN_NAME_SCOPE",scope:n(s)};const a=Vi(e,[["parent",[16]],["firstChild",[$i]]]);return a&&" "!==t[r]?{type:"SPANSET_IN_NAME_SCOPE",scope:n(a)}:void 0};function Yi(e,t,r,n){const s=Xi(e,t,n);if(s)return s;let a=Vi(e,[["firstChild",[$i]],["firstChild",[27]]]);return a?{type:"SPANSET_EXPRESSION_OPERATORS"}:(a=Vi(e,[["lastChild",[$i]],["lastChild",[$i]],["lastChild",[19]]]),a?{type:"SPANFIELD_COMBINING_OPERATORS"}:(a=Vi(e,[["lastChild",[$i]]]),a?{type:"SPANSET_EXPRESSION_OPERATORS"}:{type:"SPANSET_EMPTY"}))}function Ji(e,t,r,n){var s,a,i;const o=Xi(e,t,n);if(o)return o;if(Vi(e,[["parent",[19]],["parent",[$i]],["prevSibling",[18]]])){var l,c,u;let r=null===(u=e.parent)||void 0===u||null===(c=u.parent)||void 0===c||null===(l=c.prevSibling)||void 0===l?void 0:l.prevSibling;if(r)return{type:"SPANSET_IN_VALUE",tagName:Ui(r,t),betweenQuotes:!0}}if(18===(null===(s=e.prevSibling)||void 0===s?void 0:s.type.id)){var p;let r=null===(p=e.prevSibling)||void 0===p?void 0:p.prevSibling;if(r)return{type:"SPANSET_IN_VALUE",tagName:Ui(r,t),betweenQuotes:!1}}return"And"===(null===(a=e.prevSibling)||void 0===a?void 0:a.type.name)||"Or"===(null===(i=e.prevSibling)||void 0===i?void 0:i.type.name)?{type:"SPANSET_EMPTY"}:{type:"SPANSET_IN_THE_MIDDLE"}}function Hi(e,t,r){let n=e.firstChild;try{for(n=e.firstChild;n.to<r;)n=n.nextSibling}catch(e){console.error("Unexpected error while searching for previous node",e)}return 5===(null==n?void 0:n.type.id)||10===(null==n?void 0:n.type.id)?{type:"NEW_SPANSET"}:{type:"SPANSET_COMBINING_OPERATORS"}}function Zi(e,t,r){const n=null==e?void 0:e.parent;if(n&&[Fi,Ai,Qi,Li,Wi].includes(n.type.id))return{type:"ATTRIBUTE_FOR_FUNCTION"}}function Ki(e,t,r,n,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,s)}function eo(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function i(e){Ki(a,n,s,i,o,"next",e)}function o(e){Ki(a,n,s,i,o,"throw",e)}i(void 0)}))}}function to(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ro(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){to(e,t,r[t])}))}return e}function no(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class so{provideCompletionItems(e,t){var r;if(!this.monaco||!this.editor)throw new Error("provideCompletionItems called before CompletionProvider was initialized");if((null===(r=this.editor.getModel())||void 0===r?void 0:r.id)!==e.id)return{suggestions:[]};const{range:n,offset:s}=function(e,t,r){const n=t.getWordAtPosition(r),s=null!=n?e.Range.lift({startLineNumber:r.lineNumber,endLineNumber:r.lineNumber,startColumn:n.startColumn,endColumn:n.endColumn}):e.Range.fromPositions(r),a={column:r.column,lineNumber:r.lineNumber};return{offset:t.getOffsetAt(a),range:s}}(this.monaco,e,t),a=function(e,t){if(""===e)return{query:e,type:"EMPTY"};const r=Di.parse(e);let n=t;for(;n-1>=0&&" "===e[n-1];)n-=1;let s=qi(r,n);s||(s=qi(r,n-1));const a=null!=s?s.cursor():r.cursorAt(n),i=a.node,o=[a.type.id];for(;a.parent();)o.push(a.type.id);let l;for(let r of Gi)Bi(r.path,o)&&(l=r.fun(i,e,n,t));return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){zi(e,t,r[t])}))}return e}({query:e},null!=l?l:{type:"UNKNOWN"})}(e.getValue(),s);return(null!=a?this.getCompletions(a,this.setAlertText):Promise.resolve([])).then((t=>{const r=t.length.toString().length,a=t.map(((t,a)=>{const i={kind:ao(t.type,this.monaco),label:t.label,insertText:t.insertText,insertTextRules:t.insertTextRules,detail:t.detail,documentation:t.documentation,sortText:a.toString().padStart(r,"0"),range:n,command:{id:this.registerInteractionCommandId||"noOp",title:"Report Interaction",arguments:[t.label,t.type]}};return function(e,t,r,n){if("TAG_NAME"===t){const t=r.getValue().substring(0,n).match(/(span\.|resource\.|\.)?([\w./-]*)$/);if(t){const r=t[1],s=t[2];s&&(r||"."===e.insertText[0]||(e.insertText="."+e.insertText),e.range=no(ro({},e.range),{startColumn:n-s.length+1}))}}}(i,t.type,e,s),i}));return{suggestions:a}}))}setRegisterInteractionCommandId(e){this.registerInteractionCommandId=e}getTagValues(e,t){var r=this;return eo((function*(){let n;const s=`${e}:${t}`;return r.cachedValues.hasOwnProperty(s)?n=r.cachedValues[s]:(n=yield r.languageProvider.getOptionsV2(e,t),r.cachedValues[s]=n),n}))()}getCompletions(e,t){var n=this;return eo((function*(){switch(e.type){case"UNKNOWN":return[];case"EMPTY":return n.getScopesCompletions("{ ","$0 }").concat(n.getIntrinsicsCompletions("{ ","$0 }")).concat(n.getTagsCompletions("{ ."));case"SPANSET_EMPTY":case"ATTRIBUTE_FOR_FUNCTION":return n.getScopesCompletions().concat(n.getIntrinsicsCompletions()).concat(n.getTagsCompletions("."));case"SPANSET_ONLY_DOT":return n.getTagsCompletions();case"SPANSET_IN_THE_MIDDLE":case"SPANSET_EXPRESSION_OPERATORS_WITH_MISSING_CLOSED_BRACE":return[...so.comparisonOps,...so.logicalOps].map((e=>no(ro({},e),{type:"OPERATOR"})));case"SPANSET_IN_NAME":return n.getScopesCompletions().concat(n.getIntrinsicsCompletions()).concat(n.getTagsCompletions());case"SPANSET_IN_NAME_SCOPE":return n.getTagsCompletions(void 0,e.scope);case"SPANSET_EXPRESSION_OPERATORS":return[...so.comparisonOps,...so.logicalOps,...so.arithmeticOps].map((e=>no(ro({},e),{type:"OPERATOR"})));case"SPANFIELD_COMBINING_OPERATORS":return[...so.logicalOps,...so.arithmeticOps,...so.comparisonOps].map((e=>no(ro({},e),{type:"OPERATOR"})));case"SPANSET_COMBINING_OPERATORS":return so.spansetOps.map((e=>no(ro({},e),{type:"OPERATOR"})));case"SPANSET_PIPELINE_AFTER_OPERATOR":return[...so.functions.map((e=>{var t,r;return no(ro({},e),{insertTextRules:null===(r=n.monaco)||void 0===r||null===(t=r.languages.CompletionItemInsertTextRule)||void 0===t?void 0:t.InsertAsSnippet,type:"FUNCTION"})})),...n.getScopesCompletions().concat(n.getIntrinsicsCompletions()).concat(n.getTagsCompletions("."))];case"SPANSET_COMPARISON_OPERATORS":return so.comparisonOps.map((e=>no(ro({},e),{type:"OPERATOR"})));case"SPANSET_IN_VALUE":let s;try{s=yield n.getTagValues(e.tagName,e.query),t(void 0)}catch(e){(0,r.isFetchError)(e)?t(e.data.error):e instanceof Error&&t(`Error: ${e.message}`)}const a=[],i=t=>e.betweenQuotes?t.label:"string"===t.type?`"${t.label}"`:t.label;return null==s||s.forEach((e=>{(null==e?void 0:e.label)&&a.push({label:e.label,insertText:i(e),type:"TAG_VALUE"})})),a;case"SPANSET_AFTER_VALUE":return so.logicalOps.map((e=>({label:e.label,insertText:e.insertText+"}",type:"OPERATOR"})));case"NEW_SPANSET":return n.getScopesCompletions("{ ","$0 }").concat(n.getIntrinsicsCompletions("{ ","$0 }")).concat(n.getTagsCompletions("."));default:throw new Error(`Unexpected situation ${e}`)}}))()}getTagsCompletions(e,t){return this.languageProvider.getTraceqlAutocompleteTags(t).sort(((e,t)=>e.localeCompare(t,void 0,{sensitivity:"accent"}))).map((t=>({label:t,insertText:(e||"")+t,type:"TAG_NAME"})))}getIntrinsicsCompletions(e,t){return xt.map((r=>{var n,s;return{label:r,insertText:(e||"")+r+(t||""),type:"KEYWORD",insertTextRules:null===(s=this.monaco)||void 0===s||null===(n=s.languages.CompletionItemInsertTextRule)||void 0===n?void 0:n.InsertAsSnippet}}))}getScopesCompletions(e,t){return wt.map((r=>{var n,s;return{label:r,insertText:(e||"")+r+(t||""),type:"SCOPE",insertTextRules:null===(s=this.monaco)||void 0===s||null===(n=s.languages.CompletionItemInsertTextRule)||void 0===n?void 0:n.InsertAsSnippet}}))}constructor(e){to(this,"languageProvider",void 0),to(this,"registerInteractionCommandId",void 0),to(this,"setAlertText",void 0),to(this,"triggerCharacters",["{",".","[","(","=","~"," ",'"']),to(this,"monaco",void 0),to(this,"editor",void 0),to(this,"cachedValues",{}),this.languageProvider=e.languageProvider,this.setAlertText=e.setAlertText,this.registerInteractionCommandId=null}}function ao(e,t){switch(e){case"TAG_NAME":return t.languages.CompletionItemKind.Enum;case"KEYWORD":return t.languages.CompletionItemKind.Keyword;case"OPERATOR":return t.languages.CompletionItemKind.Operator;case"TAG_VALUE":return t.languages.CompletionItemKind.EnumMember;case"SCOPE":return t.languages.CompletionItemKind.Class;case"FUNCTION":return t.languages.CompletionItemKind.Function;default:throw new Error(`Unexpected CompletionType: ${e}`)}}to(so,"arithmeticOps",[{label:"+",insertText:"+",detail:"Plus"},{label:"-",insertText:"-",detail:"Minus"},{label:"*",insertText:"*",detail:"Times"},{label:"/",insertText:"/",detail:"Over"}]),to(so,"logicalOps",[{label:"&&",insertText:"&&",detail:"And",documentation:"And (intersection) operator. Checks that both conditions found matches."},{label:"||",insertText:"||",detail:"Or",documentation:"Or (union) operator. Checks that either condition found matches."}]),to(so,"comparisonOps",[{label:"=",insertText:"=",detail:"Equality"},{label:"!=",insertText:"!=",detail:"Inequality"},{label:">",insertText:">",detail:"Greater than"},{label:">=",insertText:">=",detail:"Greater than or equal to"},{label:"<",insertText:"<",detail:"Less than"},{label:"<=",insertText:"<=",detail:"Less than or equal to"},{label:"=~",insertText:"=~",detail:"Regular expression"},{label:"!~",insertText:"!~",detail:"Negated regular expression"}]),to(so,"structuralOps",[{label:">>",insertText:">>",detail:"Descendant",documentation:"Descendant operator. Looks for spans matching {condB} that are descendants of a span matching {condA}"},{label:">",insertText:">",detail:"Child",documentation:"Child operator. Looks for spans matching {condB} that are direct child spans of a parent matching {condA}"},{label:"<<",insertText:"<<",detail:"Ancestor",documentation:"Ancestor operator. Looks for spans matching {condB} that are ancestors of a span matching {condA}"},{label:"<",insertText:"<",detail:"Parent",documentation:"Parent operator. Looks for spans matching {condB} that are direct parent spans of a child matching {condA}"},{label:"~",insertText:"~",detail:"Sibling",documentation:"Sibling operator. Checks that spans matching {condA} and {condB} are siblings of the same parent span."}]),to(so,"spansetOps",[{label:"|",insertText:"|",detail:"Pipe"},...so.logicalOps,...so.structuralOps]),to(so,"aggregatorFunctions",[{label:"avg",insertText:"avg($0)",detail:"Average of attribute",documentation:"Computes the average of a given numeric attribute or intrinsic for a spanset."},{label:"count",insertText:"count()$0",detail:"Number of spans",documentation:"Counts the number of spans in a spanset."},{label:"max",insertText:"max($0)",detail:"Max value of attribute",documentation:"Computes the maximum value of a given numeric attribute or intrinsic for a spanset."},{label:"min",insertText:"min($0)",detail:"Min value of attribute",documentation:"Computes the minimum value of a given numeric attribute or intrinsic for a spanset."},{label:"sum",insertText:"sum($0)",detail:"Sum value of attribute",documentation:"Computes the sum value of a given numeric attribute or intrinsic for a spanset."}]),to(so,"functions",[...so.aggregatorFunctions,{label:"by",insertText:"by($0)",detail:"Grouping of attributes",documentation:"Groups by arbitrary attributes."},{label:"count_over_time",insertText:"count_over_time()$0",detail:"Number of spans over time",documentation:"Counts the number of spans over time."},{label:"histogram_over_time",insertText:"histogram_over_time($0)",detail:"Histogram of attribute over time",documentation:"Retrieves a histogram of an attributes values over time which are sorted into buckets."},{label:"quantile_over_time",insertText:"quantile_over_time($0)",detail:"Quantile of attribute over time",documentation:"Retrieves one or more quantiles of an attributes numeric values over time."},{label:"rate",insertText:"rate()$0",detail:"Rate of spans",documentation:"Counts the rate of spans per second."},{label:"select",insertText:"select($0)",detail:"Selection of fields",documentation:"Selects arbitrary fields from spans."}]);const io=e=>{if(""===e.trim())return[];if(e.trim().match(/^[0-9A-Fa-f]*$/))return[];const t=Di.parse(e),r=[];return t.iterate({enter:e=>{0===e.type.id&&r.push(e.node)}}),r},oo=(e,t,r)=>{const n=[...lo(e.MarkerSeverity.Error,t,r),...co(e.MarkerSeverity.Warning,t)];e.editor.setModelMarkers(t,"owner",n)},lo=(e,t,r)=>r.map((r=>{const n=(e=>{var t;switch(null===(t=e.parent)||void 0===t?void 0:t.type.id){case $i:var r;switch(null===(r=e.prevSibling)||void 0===r?void 0:r.type.id){case 5:case 10:return"Invalid value after logical operator.";case 18:return"Invalid value after comparison or arithmetic operator.";default:return"Invalid operator after field expression."}case 16:var n;return(null===(n=e.prevSibling)||void 0===n?void 0:n.type.id)===$i?"Invalid comparison operator after field expression.":"Invalid expression for spanset.";case 4:var s;switch(null===(s=e.prevSibling)||void 0===s?void 0:s.type.id){case 4:return"Invalid spanset combining operator after spanset expression.";case 11:return"Invalid aggregation operator after pipeline operator.";default:return"Invalid spanset expression after spanset combining operator."}case Fi:case Ai:var a,i,o,l,c,u,p;return(null===(o=e.parent)||void 0===o||null===(i=o.parent)||void 0===i||null===(a=i.parent)||void 0===a?void 0:a.type.id)===Qi?"Invalid expression for by operator.":(null===(p=e.parent)||void 0===p||null===(u=p.parent)||void 0===u||null===(c=u.parent)||void 0===c||null===(l=c.parent)||void 0===l?void 0:l.type.id)===Li?"Invalid expression for select operator.":"Invalid expression for aggregator operator.";case 27:return"Invalid expression for spanset.";case 31:var g;switch(null===(g=e.prevSibling)||void 0===g?void 0:g.type.id){case 36:return"Invalid value after comparison operator.";case 32:var d,h;if((null===(h=e.prevSibling)||void 0===h||null===(d=h.firstChild)||void 0===d?void 0:d.type.id)===Ai)return"Invalid comparison operator after aggregator operator.";default:return"Invalid value after comparison operator."}default:return"Invalid query."}})(r);return uo(e,n,t,r.from,r.to)})),co=(e,t)=>{let r=[];const n=t.getValue(),s=Di.parse(n);if(n.indexOf(".")>-1){const n=s.cursorAt(0);do{const{node:s}=n;var a,i,o;if(28===s.type.id&&26!==(null===(a=s.prevSibling)||void 0===a?void 0:a.type.id)&&29!==(null===(i=s.prevSibling)||void 0===i?void 0:i.type.id)&&30!==(null===(o=s.prevSibling)||void 0===o?void 0:o.type.id)){const n=s.prevSibling?s.prevSibling.from:s.from-1,a=s.prevSibling?s.prevSibling.to:s.from-1,i="Add resource or span scope to attribute to improve query performance.";r.push(uo(e,i,t,n,a))}}while(n.next())}return r},uo=(e,t,r,n,s)=>{let a=0,i=0,o=n,l=s;for(;o>0;)a++,o-=r.getLineLength(a)+1;for(;l>0;)i++,l-=r.getLineLength(i)+1;return{message:t,severity:e,startLineNumber:a,endLineNumber:i,startColumn:o+r.getLineLength(a)+2,endColumn:l+r.getLineLength(i)+2}};function po(e,t,r,n,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,s)}function go(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ho(e){const[t,a]=(0,i.useState)(),{query:o,onChange:l,onRunQuery:u,placeholder:p}=e,g=function(e,t){const r=(0,i.useRef)(new so({languageProvider:e.languageProvider,setAlertText:t}));(0,i.useEffect)((()=>{const r=function(){var r,n=(r=function*(){try{yield e.languageProvider.start(),t(void 0)}catch(e){e instanceof Error&&t(`Error: ${e.message}`)}},function(){var e=this,t=arguments;return new Promise((function(n,s){var a=r.apply(e,t);function i(e){po(a,n,s,i,o,"next",e)}function o(e){po(a,n,s,i,o,"throw",e)}i(void 0)}))});return function(){return n.apply(this,arguments)}}();r()}),[e,t]);const n=(0,i.useRef)(null);return(0,i.useEffect)((()=>()=>{var e;null===(e=n.current)||void 0===e||e.call(n)}),[]),(e,t,s)=>{r.current.editor=e,r.current.monaco=t,r.current.setRegisterInteractionCommandId(s);const{dispose:a}=t.languages.registerCompletionItemProvider(mo,r.current);n.current=a}}(e.datasource,a),d=(0,s.useTheme2)(),h=yo(d,p),f=(0,i.useRef)(o);f.current=o;const m=e=>{var t,r;l((t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){go(e,t,r[t])}))}return e}({},f.current),r=null!=(r={query:e})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t))},v=(0,i.useRef)(u);v.current=u;const y=(0,i.useRef)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.CodeEditor,{value:o.query||"",language:mo,onBlur:m,onChange:m,containerStyles:h.queryField,readOnly:e.readOnly,monacoOptions:{folding:!1,fontSize:14,lineNumbers:"off",overviewRulerLanes:0,renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,wordWrap:"on"},onBeforeEditorMount:vo,onEditorDidMount:(t,n)=>{e.readOnly||(g(t,n,function(e){return e.addCommand(0,(function(e,t,n){const s={datasourceType:"tempo",type:n};"TAG_VALUE"!==n&&(s.label=t),(0,r.reportInteraction)("grafana_traces_traceql_completion",s)}))}(t)),function(e,t,r){e.addAction({id:"run-query",label:"Run Query",keybindings:[t.KeyMod.Shift|t.KeyCode.Enter],contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(){v.current()}})}(t,n),function(e,t,r){const n=[{range:new t.Range(1,1,1,1),options:{className:r.placeholder,isWholeLine:!0}}];let s=[];const a=()=>{const t=e.getModel();if(!t)return;const r=0===t.getValueLength()?n:[];s=t.deltaDecorations(s,r)};a(),e.onDidChangeModelContent(a)}(t,n,h)),function(e){const t=e.getDomNode(),r=()=>{if(t){const r=Math.min(1e3,e.getContentHeight()),n=parseInt(t.style.width,10);t.style.width=`${n}px`,t.style.height=`${r}px`,e.layout({width:n,height:r})}};e.onDidContentSizeChange(r),r()}(t);const s=t.getModel();if(s){const e=io(s.getValue());oo(n,s,e)}t.onDidChangeModelContent((e=>{const r=t.getModel();if(!r)return;window.clearTimeout(y.current);const s=io(r.getValue()),a=e.changes[0].rangeOffset;oo(n,r,s.filter((e=>!(e.from<=a&&a<=e.to)))),y.current=window.setTimeout((()=>{oo(n,r,s)}),500)}))}}),t&&(0,n.jsx)(c,{severity:"error",text:t})]})}let fo=!1;const mo="traceql";function vo(e){if(!fo){fo=!0;const{aliases:t,extensions:r,mimetypes:n,def:s}=Pt;e.languages.register({id:mo,aliases:t,extensions:r,mimetypes:n}),e.languages.setMonarchTokensProvider(mo,s.language),e.languages.setLanguageConfiguration(mo,s.languageConfiguration)}}const yo=(e,t)=>({queryField:(0,a.css)({borderRadius:e.shape.radius.default,border:`1px solid ${e.components.input.borderColor}`,flex:1}),placeholder:(0,a.css)({"::after":{content:`'${t}'`,fontFamily:e.typography.fontFamilyMonospace,opacity:.3}})});function Oo(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bo(e){const t=(0,s.useStyles2)(So),a=(0,z.defaults)(e.query,Ea),[o,l]=(0,i.useState)((()=>{const e=Ct(a.filters||[]);return e===a.query||"{}"===e}));var c;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(s.InlineLabel,{children:["Build complex queries using TraceQL to select a list of traces."," ",(0,n.jsx)("a",{rel:"noreferrer",target:"_blank",href:"https://grafana.com/docs/tempo/latest/traceql/",children:"Documentation"})]}),!o&&(0,n.jsxs)("div",{className:t.copyContainer,children:[(0,n.jsx)("span",{children:"Continue editing the query from the Search tab?"}),(0,n.jsx)(s.Button,{variant:"secondary",size:"sm",onClick:()=>{var t,n,s;(0,r.reportInteraction)("grafana_traces_copy_to_traceql_clicked",{app:null!==(t=e.app)&&void 0!==t?t:"",grafana_version:r.config.buildInfo.version,location:"traceql_tab"}),e.onClearResults(),e.onChange((n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Oo(e,t,r[t])}))}return e}({},a),s=null!=(s={query:Ct(a.filters||[])})?s:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(s)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(s,e))})),n)),l(!0)},style:{marginLeft:"10px"},children:"Copy query from Search"})]}),(0,n.jsx)(ho,{placeholder:"Enter a TraceQL query or trace ID (run with Shift+Enter)",query:a,onChange:e.onChange,datasource:e.datasource,onRunQuery:e.onRunQuery}),(0,n.jsx)("div",{className:t.optionsContainer,children:(0,n.jsx)(Vn,{query:a,onChange:e.onChange,isStreaming:null!==(c=e.datasource.isStreamingSearchEnabled())&&void 0!==c&&c})})]})}const So=e=>({optionsContainer:(0,a.css)({marginTop:"10px"}),copyContainer:(0,a.css)({backgroundColor:e.colors.background.secondary,padding:e.spacing(.5,1),fontSize:e.typography.body.fontSize})});function xo(e,t,r,n,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,s)}function wo(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){wo(e,t,r[t])}))}return e}function To(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class Po extends i.PureComponent{componentDidMount(){var e,t=this;return(e=function*(){t.props.query.queryType&&"clear"!==t.props.query.queryType||t.props.onChange(To(jo({},t.props.query),{queryType:"traceql"}))},function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function i(e){xo(a,n,s,i,o,"next",e)}function o(e){xo(a,n,s,i,o,"throw",e)}i(void 0)}))})()}render(){var e;const{query:t,onChange:i,datasource:o,app:l}=this.props,c=null===(e=o.serviceMap)||void 0===e?void 0:e.datasourceUid;return(t.spanName||t.serviceName||t.search||t.maxDuration||t.minDuration||"nativeSearch"===t.queryType)&&i(On(t)),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.Modal,{title:"Upload trace",isOpen:this.state.uploadModalOpen,onDismiss:()=>this.setState({uploadModalOpen:!1}),children:(0,n.jsx)("div",{className:(0,a.css)({padding:this.props.theme.spacing(2)}),children:(0,n.jsx)(s.FileDropzone,{options:{multiple:!1},onLoad:e=>{if("string"!=typeof e&&null!==e)throw Error("Unexpected result type: "+typeof e);this.props.datasource.uploadedJson=e,i(To(jo({},t),{queryType:"upload"})),this.setState({uploadModalOpen:!1}),this.props.onRunQuery()}})})}),(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{label:"Query type",grow:!0,children:(0,n.jsxs)(s.HorizontalGroup,{spacing:"sm",align:"center",justify:"space-between",children:[(0,n.jsx)(s.RadioButtonGroup,{options:[{value:"traceqlSearch",label:"Search"},{value:"traceql",label:"TraceQL"},{value:"serviceMap",label:"Service Graph"}],value:t.queryType,onChange:e=>{var n;(0,r.reportInteraction)("grafana_traces_query_type_changed",{datasourceType:"tempo",app:null!=l?l:"",grafana_version:r.config.buildInfo.version,newQueryType:e,previousQueryType:null!==(n=t.queryType)&&void 0!==n?n:""}),this.onClearResults(),i(To(jo({},t),{queryType:e}))},size:"md"}),(0,n.jsx)(s.Button,{variant:"secondary",size:"sm",onClick:()=>{this.setState({uploadModalOpen:!0})},children:"Import trace"})]})})}),"traceqlSearch"===t.queryType&&(0,n.jsx)(cs,{datasource:this.props.datasource,query:t,onChange:i,onBlur:this.props.onBlur,app:l,onClearResults:this.onClearResults,addVariablesToOptions:this.props.addVariablesToOptions}),"serviceMap"===t.queryType&&(0,n.jsx)(ja,{graphDatasourceUid:c,query:t,onChange:i}),"traceql"===t.queryType&&(0,n.jsx)(bo,{datasource:this.props.datasource,query:t,onRunQuery:this.props.onRunQuery,onChange:i,app:l,onClearResults:this.onClearResults})]})}constructor(e){super(e),wo(this,"onClearResults",(()=>{const{onChange:e,query:t,onRunQuery:r}=this.props;e(To(jo({},t),{queryType:"clear"})),r()})),this.state={uploadModalOpen:!1}}}const _o=(0,s.withTheme2)(Po);var Eo=Object.defineProperty,ko=Object.defineProperties,Co=Object.getOwnPropertyDescriptors,Ro=Object.getOwnPropertySymbols,No=Object.prototype.hasOwnProperty,Io=Object.prototype.propertyIsEnumerable,Do=(e,t,r)=>t in e?Eo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,$o=(e,t)=>{for(var r in t||(t={}))No.call(t,r)&&Do(e,r,t[r]);if(Ro)for(var r of Ro(t))Io.call(t,r)&&Do(e,r,t[r]);return e};const Fo=({dataSourceName:e,docsLink:t,hasRequiredFields:r=!0,className:n})=>{const i=(0,s.useTheme2)(),l={container:(0,a.css)({p:{margin:0},"p + p":{marginTop:i.spacing(2)}}),text:(0,a.css)((c=$o({},i.typography.body),u={color:i.colors.text.secondary,a:(0,a.css)({color:i.colors.text.link,textDecoration:"underline","&:hover":{textDecoration:"none"}})},ko(c,Co(u))))};var c,u;return o().createElement("div",{className:(0,a.cx)(l.container,n)},o().createElement("p",{className:l.text},"Before you can use the ",e," data source, you must configure it below or in the config file. For detailed instructions,"," ",o().createElement("a",{href:t,target:"_blank",rel:"noreferrer"},"view the documentation"),"."),r&&o().createElement("p",{className:l.text},o().createElement("i",null,"Fields marked with * are required")))};var Ao=Object.defineProperty,Qo=Object.defineProperties,Lo=Object.getOwnPropertyDescriptors,Wo=Object.getOwnPropertySymbols,zo=Object.prototype.hasOwnProperty,qo=Object.prototype.propertyIsEnumerable,Mo=(e,t,r)=>t in e?Ao(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Vo=(e,t)=>{for(var r in t||(t={}))zo.call(t,r)&&Mo(e,r,t[r]);if(Wo)for(var r of Wo(t))qo.call(t,r)&&Mo(e,r,t[r]);return e};const Uo=({children:e,title:t,description:r,isCollapsible:n=!1,isInitiallyOpen:l=!0,kind:c="section",className:u})=>{const{colors:p,typography:g,spacing:d}=(0,s.useTheme2)(),[h,f]=(0,i.useState)(!n||l),m=h?"angle-up":"angle-down",v="sub-section"===c,y=`${h?"Collapse":"Expand"} section ${t}`,O={header:(0,a.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,a.css)({margin:0}),subtitle:(0,a.css)({margin:0,fontWeight:g.fontWeightRegular}),descriptionText:(0,a.css)((b=Vo({marginTop:d(v?.25:.5),marginBottom:0},g.bodySmall),S={color:p.text.secondary},Qo(b,Lo(S)))),content:(0,a.css)({marginTop:d(2)})};var b,S;return o().createElement("div",{className:u},o().createElement("div",{className:O.header},"section"===c?o().createElement("h3",{className:O.title},t):o().createElement("h6",{className:O.subtitle},t),n&&o().createElement(s.IconButton,{name:m,onClick:()=>f(!h),type:"button",size:"xl","aria-label":y})),r&&o().createElement("p",{className:O.descriptionText},r),h&&o().createElement("div",{className:O.content},e))};var Bo=Object.defineProperty,Go=Object.defineProperties,Xo=Object.getOwnPropertyDescriptors,Yo=Object.getOwnPropertySymbols,Jo=Object.prototype.hasOwnProperty,Ho=Object.prototype.propertyIsEnumerable,Zo=(e,t,r)=>t in e?Bo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const Ko=e=>{var t,r=e,{children:n}=r,s=((e,t)=>{var r={};for(var n in e)Jo.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&Yo)for(var n of Yo(e))t.indexOf(n)<0&&Ho.call(e,n)&&(r[n]=e[n]);return r})(r,["children"]);return o().createElement(Uo,(t=((e,t)=>{for(var r in t||(t={}))Jo.call(t,r)&&Zo(e,r,t[r]);if(Yo)for(var r of Yo(t))Ho.call(t,r)&&Zo(e,r,t[r]);return e})({},s),Go(t,Xo({kind:"section"}))),n)};var el=Object.defineProperty,tl=Object.defineProperties,rl=Object.getOwnPropertyDescriptors,nl=Object.getOwnPropertySymbols,sl=Object.prototype.hasOwnProperty,al=Object.prototype.propertyIsEnumerable,il=(e,t,r)=>t in e?el(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const ol=({config:e,onChange:t,description:r,urlPlaceholder:n,urlTooltip:i,urlLabel:l,className:c})=>{const u=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(e.url),p={container:(0,a.css)({maxWidth:578})};return o().createElement(o().Fragment,null,o().createElement(Ko,{title:"Connection",description:r,className:(0,a.cx)(p.container,c)},o().createElement(s.InlineField,{htmlFor:"connection-url",label:l||"URL",labelWidth:24,tooltip:i||o().createElement(o().Fragment,null,"Specify a complete HTTP URL",o().createElement("br",null),"(for example https://example.com:8080)"),grow:!0,disabled:e.readOnly,required:!0,invalid:!u&&!e.readOnly,error:u?"":"Please enter a valid URL",interactive:!0},o().createElement(s.Input,{id:"connection-url","aria-label":"Data source connection URL",onChange:r=>{return t((n=((e,t)=>{for(var r in t||(t={}))sl.call(t,r)&&il(e,r,t[r]);if(nl)for(var r of nl(t))al.call(t,r)&&il(e,r,t[r]);return e})({},e),s={url:r.currentTarget.value},tl(n,rl(s))));var n,s},value:e.url||"",placeholder:n||"URL"}))))},ll=()=>({inlineFieldNoMarginRight:(0,a.css)({marginRight:0}),inlineFieldWithSecret:(0,a.css)({'[class$="layoutChildrenWrapper"]:first-child':{flexGrow:1}})}),cl=({user:e,passwordConfigured:t,userLabel:r="User",userTooltip:n="The username of the data source account",userPlaceholder:i="User",passwordLabel:l="Password",passwordTooltip:c="The password of the data source account",passwordPlaceholder:u="Password",onUserChange:p,onPasswordChange:g,onPasswordReset:d,readOnly:h})=>{const f=ll(),m={lastInlineField:(0,a.css)({marginBottom:0})};return o().createElement(o().Fragment,null,o().createElement(s.InlineField,{className:f.inlineFieldNoMarginRight,label:r,labelWidth:24,tooltip:n,required:!0,htmlFor:"basic-auth-user-input",interactive:!0,grow:!0,disabled:h},o().createElement(s.Input,{id:"basic-auth-user-input",placeholder:i,value:e,onChange:e=>p(e.currentTarget.value),required:!0})),o().createElement(s.InlineField,{className:(0,a.cx)(f.inlineFieldNoMarginRight,f.inlineFieldWithSecret,m.lastInlineField),label:l,labelWidth:24,tooltip:c,required:!0,htmlFor:"basic-auth-password-input",interactive:!0,grow:!0,disabled:h},o().createElement(s.SecretInput,{id:"basic-auth-password-input",isConfigured:t,onReset:h?()=>{}:d,placeholder:u,onChange:e=>g(e.currentTarget.value),required:!0})))};var ul=Object.defineProperty,pl=Object.defineProperties,gl=Object.getOwnPropertyDescriptors,dl=Object.getOwnPropertySymbols,hl=Object.prototype.hasOwnProperty,fl=Object.prototype.propertyIsEnumerable,ml=(e,t,r)=>t in e?ul(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const vl=e=>{var t,r=e,{children:n}=r,s=((e,t)=>{var r={};for(var n in e)hl.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&dl)for(var n of dl(e))t.indexOf(n)<0&&fl.call(e,n)&&(r[n]=e[n]);return r})(r,["children"]);return o().createElement(Uo,(t=((e,t)=>{for(var r in t||(t={}))hl.call(t,r)&&ml(e,r,t[r]);if(dl)for(var r of dl(t))fl.call(t,r)&&ml(e,r,t[r]);return e})({},s),pl(t,gl({kind:"sub-section"}))),n)};var yl=(e=>(e.NoAuth="NoAuth",e.BasicAuth="BasicAuth",e.OAuthForward="OAuthForward",e.CrossSiteCredentials="CrossSiteCredentials",e))(yl||{}),Ol=Object.defineProperty,bl=Object.defineProperties,Sl=Object.getOwnPropertyDescriptors,xl=Object.getOwnPropertySymbols,wl=Object.prototype.hasOwnProperty,jl=Object.prototype.propertyIsEnumerable,Tl=(e,t,r)=>t in e?Ol(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Pl=(e,t)=>{for(var r in t||(t={}))wl.call(t,r)&&Tl(e,r,t[r]);if(xl)for(var r of xl(t))jl.call(t,r)&&Tl(e,r,t[r]);return e},_l=(e,t)=>bl(e,Sl(t));const El={[yl.BasicAuth]:{label:"Basic authentication",value:yl.BasicAuth,description:"Authenticate with your data source username and password"},[yl.CrossSiteCredentials]:{label:"Enable cross-site access control requests",value:yl.CrossSiteCredentials,description:"Allow cross-site Access-Control requests with your existing credentials and cookies. This enables the server to authenticate the user and perform authorized requests on their behalf on other domains."},[yl.OAuthForward]:{label:"Forward OAuth Identity",value:yl.OAuthForward,description:"Forward the OAuth access token (and if available: the OIDC ID token) of the user querying to the data source"},[yl.NoAuth]:{label:"No Authentication",value:yl.NoAuth,description:"Data source is available without authentication"}},kl=({selectedMethod:e,mostCommonMethod:t,visibleMethods:r,extendedDefaultOptions:n,customMethods:l,onAuthMethodSelect:c,basicAuth:u,readOnly:p})=>{var g,d,h,f;const[m,v]=(0,i.useState)(!1),{colors:y,spacing:O}=(0,s.useTheme2)(),b=(0,i.useMemo)((()=>{var e;return null!=r?r:[yl.BasicAuth,yl.OAuthForward,yl.NoAuth,...null!=(e=null==l?void 0:l.map((e=>e.id)))?e:[]]}),[l,r]),S=b.length>1,x=(0,i.useMemo)((()=>{var e;const r=null!=(e=null==l?void 0:l.reduce(((e,t)=>(e[t.id]={label:t.label,value:t.id,description:t.description},e)),{}))?e:{},s={};let a;for(a in El)n&&n[a]?s[a]=Pl(Pl({},El[a]),n[a]):s[a]=El[a];const i=Pl(Pl({},r),s);return b.filter((e=>Boolean(i[e]))).map((e=>{const r=i[e];return e===t&&S?_l(Pl({},r),{label:`${r.label} (most common)`}):r}))}),[b,l,n,t,S]);let w=e;S?e===yl.NoAuth&&t&&!m&&(w=t):w=b[0];let j=null;w===yl.BasicAuth&&u?j=o().createElement(cl,_l(Pl({},u),{readOnly:p})):w.startsWith("custom-")&&(j=null!=(d=null==(g=null==l?void 0:l.find((e=>e.id===w)))?void 0:g.component)?d:null);const T=S?"Authentication methods":null!=(h=x[0].label)?h:"",P=S?"Choose an authentication method to access the data source":null!=(f=x[0].description)?f:"",_={authMethods:(0,a.css)(Pl({marginTop:O(2.5)},S&&{padding:O(2),border:`1px solid ${y.border.weak}`})),selectedMethodFields:(0,a.css)({marginTop:O(1.5)})};return o().createElement(vl,{title:T,description:P},o().createElement("div",{className:_.authMethods},S&&o().createElement(s.Select,{options:x,value:w,onChange:e=>{v(!0),c(e.value)},disabled:p}),j&&o().createElement("div",{className:_.selectedMethodFields},j)))},Cl=({children:e,enabled:t,label:r,tooltipText:n,onToggle:i,readOnly:l})=>{const{colors:c,spacing:u}=(0,s.useTheme2)(),p={container:(0,a.css)({marginTop:3}),checkboxContainer:(0,a.css)({display:"flex",alignItems:"center"}),infoIcon:(0,a.css)({marginTop:-2,marginLeft:5,color:c.text.secondary}),content:(0,a.css)({margin:u(1,0,2,3)})};return o().createElement("div",{className:p.container},o().createElement("div",{className:p.checkboxContainer},o().createElement(s.Checkbox,{value:t,label:r,onChange:()=>i(!t),disabled:l}),o().createElement(s.Tooltip,{placement:"top",content:n,interactive:!0},o().createElement(s.Icon,{name:"info-circle",className:p.infoIcon,size:"sm"}))),t&&e&&o().createElement("div",{className:p.content},e))},Rl=({enabled:e,certificateConfigured:t,onToggle:r,onCertificateChange:n,onCertificateReset:i,tooltips:l,readOnly:c})=>{var u;const p=ll();return o().createElement(Cl,{enabled:e,label:"Add self-signed certificate",tooltipText:"Add your own Certificate Authority (CA) certificate on top of one generated by the certificate authorities for additional security measures",onToggle:e=>r(e),readOnly:c},o().createElement(s.InlineField,{label:"CA Certificate",labelWidth:24,tooltip:null!=(u=null==l?void 0:l.certificateLabel)?u:"Your self-signed certificate",required:!0,htmlFor:"self-signed-certificate-input",interactive:!0,grow:!0,className:(0,a.cx)(p.inlineFieldNoMarginRight,p.inlineFieldWithSecret),disabled:c},o().createElement(s.SecretTextArea,{id:"self-signed-certificate-input",isConfigured:t,onChange:e=>n(e.currentTarget.value),onReset:c?()=>{}:i,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})))},Nl=({enabled:e,serverName:t,clientCertificateConfigured:r,clientKeyConfigured:n,onToggle:i,onServerNameChange:l,onClientCertificateChange:c,onClientKeyChange:u,onClientCertificateReset:p,onClientKeyReset:g,tooltips:d,readOnly:h})=>{var f,m,v;const y=ll();return o().createElement(Cl,{enabled:e,label:"TLS Client Authentication",tooltipText:"Validate using TLS client authentication, in which the server authenticates the client",onToggle:e=>i(e),readOnly:h},o().createElement(s.InlineField,{label:"ServerName",labelWidth:24,tooltip:null!=(f=null==d?void 0:d.serverNameLabel)?f:"A Servername is used to verify the hostname on the returned certificate",required:!0,htmlFor:"client-auth-servername-input",interactive:!0,grow:!0,className:y.inlineFieldNoMarginRight,disabled:h},o().createElement(s.Input,{id:"client-auth-servername-input",placeholder:"domain.example.com",value:t,onChange:e=>l(e.currentTarget.value),required:!0})),o().createElement(s.InlineField,{label:"Client Certificate",labelWidth:24,tooltip:null!=(m=null==d?void 0:d.certificateLabel)?m:"The client certificate can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-certificate-input",interactive:!0,grow:!0,className:(0,a.cx)(y.inlineFieldNoMarginRight,y.inlineFieldWithSecret),disabled:h},o().createElement(s.SecretTextArea,{id:"client-auth-client-certificate-input",isConfigured:r,onChange:e=>c(e.currentTarget.value),onReset:h?()=>{}:p,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})),o().createElement(s.InlineField,{label:"Client Key",labelWidth:24,tooltip:null!=(v=null==d?void 0:d.keyLabel)?v:"The client key can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-key-input",interactive:!0,grow:!0,className:(0,a.cx)(y.inlineFieldNoMarginRight,y.inlineFieldWithSecret),disabled:h},o().createElement(s.SecretTextArea,{id:"client-auth-client-key-input",isConfigured:n,onChange:e=>u(e.currentTarget.value),onReset:h?()=>{}:g,placeholder:"Begins with --- RSA PRIVATE KEY CERTIFICATE ---",rows:6,required:!0})))},Il=({enabled:e,onToggle:t,readOnly:r})=>o().createElement(Cl,{enabled:e,label:"Skip TLS certificate validation",tooltipText:"Skipping TLS certificate validation is not recommended unless absolutely necessary or for testing",onToggle:e=>t(e),readOnly:r});var Dl=Object.defineProperty,$l=Object.defineProperties,Fl=Object.getOwnPropertyDescriptors,Al=Object.getOwnPropertySymbols,Ql=Object.prototype.hasOwnProperty,Ll=Object.prototype.propertyIsEnumerable,Wl=(e,t,r)=>t in e?Dl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,zl=(e,t)=>{for(var r in t||(t={}))Ql.call(t,r)&&Wl(e,r,t[r]);if(Al)for(var r of Al(t))Ll.call(t,r)&&Wl(e,r,t[r]);return e},ql=(e,t)=>$l(e,Fl(t));const Ml=({selfSignedCertificate:e,TLSClientAuth:t,skipTLSVerification:r,readOnly:n})=>{const{spacing:i}=(0,s.useTheme2)(),l={container:(0,a.css)({marginTop:i(3)})};return o().createElement(vl,{className:l.container,title:"TLS settings",description:"Additional security measures that can be applied on top of authentication"},o().createElement(Rl,ql(zl({},e),{readOnly:n})),o().createElement(Nl,ql(zl({},t),{readOnly:n})),o().createElement(Il,ql(zl({},r),{readOnly:n})))};var Vl=Object.defineProperty,Ul=Object.defineProperties,Bl=Object.getOwnPropertyDescriptors,Gl=Object.getOwnPropertySymbols,Xl=Object.prototype.hasOwnProperty,Yl=Object.prototype.propertyIsEnumerable,Jl=(e,t,r)=>t in e?Vl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Hl=(e,t)=>{for(var r in t||(t={}))Xl.call(t,r)&&Jl(e,r,t[r]);if(Gl)for(var r of Gl(t))Yl.call(t,r)&&Jl(e,r,t[r]);return e},Zl=(e,t)=>Ul(e,Bl(t));const Kl=({header:e,onChange:t,onBlur:r,onDelete:n,readOnly:i})=>{const{spacing:l}=(0,s.useTheme2)(),c=ll(),u={container:(0,a.css)({alignItems:"center"}),input:(0,a.css)({minWidth:"100%"}),headerNameField:(0,a.css)({width:"40%",marginRight:0,paddingRight:l(1)}),headerValueField:(0,a.css)({width:"45%",marginRight:0}),removeHeaderBtn:(0,a.css)({margin:"0 0 3px 10px"})};return o().createElement(o().Fragment,null,o().createElement(s.InlineFieldRow,{className:u.container},o().createElement(s.InlineField,{label:"Header",labelWidth:9,grow:!0,className:u.headerNameField,htmlFor:`custom-header-${e.id}-name-input`,disabled:i},o().createElement(s.Input,{id:`custom-header-${e.id}-name-input`,placeholder:"X-Custom-Header",value:e.name,width:12,onChange:r=>t(Zl(Hl({},e),{name:r.currentTarget.value})),onBlur:r,className:u.input})),o().createElement(s.InlineField,{label:"Value",labelWidth:9,grow:!0,className:(0,a.cx)(c.inlineFieldWithSecret,u.headerValueField),htmlFor:`custom-header-${e.id}-value-input`,disabled:i},o().createElement(s.SecretInput,{id:`custom-header-${e.id}-value-input`,isConfigured:e.configured,placeholder:"Header value",value:e.value,width:12,onChange:r=>t(Zl(Hl({},e),{value:r.currentTarget.value})),onReset:i?()=>{}:()=>t(Zl(Hl({},e),{configured:!1,value:""})),onBlur:r,className:u.input})),o().createElement(s.IconButton,{name:"trash-alt",tooltip:"Remove header",tooltipPlacement:"top",className:u.removeHeaderBtn,onClick:n,type:"button",disabled:i})))};var ec=Object.defineProperty,tc=Object.defineProperties,rc=Object.getOwnPropertyDescriptors,nc=Object.getOwnPropertySymbols,sc=Object.prototype.hasOwnProperty,ac=Object.prototype.propertyIsEnumerable,ic=(e,t,r)=>t in e?ec(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,oc=(e,t)=>{for(var r in t||(t={}))sc.call(t,r)&&ic(e,r,t[r]);if(nc)for(var r of nc(t))ac.call(t,r)&&ic(e,r,t[r]);return e},lc=(e,t)=>tc(e,rc(t));const cc=({headers:e,onChange:t,readOnly:r})=>{const{spacing:n}=(0,s.useTheme2)(),[l,c]=(0,i.useState)(e.map((e=>lc(oc({},e),{id:uc(),value:""}))));(0,i.useEffect)((()=>{c((t=>{let r=!1;const n=t.map((t=>{var n;const s=null==(n=e.find((e=>e.name===t.name)))?void 0:n.configured;return void 0!==s&&t.configured!==s?(r=!0,lc(oc({},t),{configured:s})):t}));return r?n:t}))}),[e]);const u=()=>{t(l.map((({name:e,value:t,configured:r})=>({name:e,value:t,configured:r}))))},p={container:(0,a.css)({marginTop:n(3)}),addHeaderButton:(0,a.css)({marginTop:n(1.5)})};return o().createElement("div",{className:p.container},o().createElement(vl,{title:"HTTP headers",description:"Pass along additional context and metadata about the request/response",isCollapsible:!0,isInitiallyOpen:l.length>0},o().createElement("div",null,l.map((e=>o().createElement(Kl,{key:e.id,header:e,onChange:e=>((e,t)=>{c(l.map((r=>r.id===e?oc({},t):r)))})(e.id,e),onDelete:()=>(e=>{const r=l.findIndex((t=>t.id===e));if(-1===r)return;const n=[...l];n.splice(r,1),c(n),t(n.map((({name:e,value:t,configured:r})=>({name:e,value:t,configured:r}))))})(e.id),onBlur:u,readOnly:r})))),o().createElement("div",{className:p.addHeaderButton},o().createElement(s.Button,{icon:"plus",variant:"secondary",fill:"outline",onClick:()=>{c([...l,{id:uc(),name:"",value:"",configured:!1}])},disabled:r},0===l.length?"Add header":"Add another header"))))};function uc(){return Math.random().toString(16).slice(2)}var pc=Object.defineProperty,gc=Object.defineProperties,dc=Object.getOwnPropertyDescriptors,hc=Object.getOwnPropertySymbols,fc=Object.prototype.hasOwnProperty,mc=Object.prototype.propertyIsEnumerable,vc=(e,t,r)=>t in e?pc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,yc=(e,t)=>{for(var r in t||(t={}))fc.call(t,r)&&vc(e,r,t[r]);if(hc)for(var r of hc(t))mc.call(t,r)&&vc(e,r,t[r]);return e},Oc=(e,t)=>gc(e,dc(t));const bc=({selectedMethod:e,mostCommonMethod:t,visibleMethods:r,extendedDefaultOptions:n,customMethods:s,onAuthMethodSelect:i,basicAuth:l,TLS:c,customHeaders:u,readOnly:p=!1})=>{const g={container:(0,a.css)({maxWidth:578})};return o().createElement("div",{className:g.container},o().createElement(Ko,{title:"Authentication"},o().createElement(kl,{selectedMethod:e,mostCommonMethod:t,customMethods:s,visibleMethods:r,extendedDefaultOptions:n,onAuthMethodSelect:i,basicAuth:l,readOnly:p}),c&&o().createElement(Ml,Oc(yc({},c),{readOnly:p})),u&&o().createElement(cc,Oc(yc({},u),{readOnly:p}))))};var Sc=Object.defineProperty,xc=Object.defineProperties,wc=Object.getOwnPropertyDescriptors,jc=Object.getOwnPropertySymbols,Tc=Object.prototype.hasOwnProperty,Pc=Object.prototype.propertyIsEnumerable,_c=(e,t,r)=>t in e?Sc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ec=(e,t)=>{for(var r in t||(t={}))Tc.call(t,r)&&_c(e,r,t[r]);if(jc)for(var r of jc(t))Pc.call(t,r)&&_c(e,r,t[r]);return e},kc=(e,t)=>xc(e,wc(t));const Cc="httpHeaderName",Rc="httpHeaderValue";function Nc({config:e,onChange:t}){return{selectedMethod:Ic(e),onAuthMethodSelect:Dc(e,t),basicAuth:$c(e,t),TLS:Fc(e,t),customHeaders:Ac(e,t),readOnly:e.readOnly}}function Ic(e){return e.basicAuth?yl.BasicAuth:e.withCredentials?yl.CrossSiteCredentials:e.jsonData.oauthPassThru?yl.OAuthForward:yl.NoAuth}function Dc(e,t){return r=>{t(kc(Ec({},e),{basicAuth:r===yl.BasicAuth,withCredentials:r===yl.CrossSiteCredentials,jsonData:kc(Ec({},e.jsonData),{oauthPassThru:r===yl.OAuthForward})}))}}function $c(e,t){return{user:e.basicAuthUser,passwordConfigured:e.secureJsonFields.basicAuthPassword,onUserChange:r=>t(kc(Ec({},e),{basicAuthUser:r})),onPasswordChange:r=>t(kc(Ec({},e),{secureJsonData:kc(Ec({},e.secureJsonData),{basicAuthPassword:r})})),onPasswordReset:()=>t(kc(Ec({},e),{secureJsonData:kc(Ec({},e.secureJsonData),{basicAuthPassword:""}),secureJsonFields:kc(Ec({},e.secureJsonFields),{basicAuthPassword:!1})}))}}function Fc(e,t){return{selfSignedCertificate:{enabled:Boolean(e.jsonData.tlsAuthWithCACert),certificateConfigured:e.secureJsonFields.tlsCACert,onToggle:r=>t(kc(Ec({},e),r?{jsonData:kc(Ec({},e.jsonData),{tlsAuthWithCACert:r})}:{jsonData:kc(Ec({},e.jsonData),{tlsAuthWithCACert:r}),secureJsonData:kc(Ec({},e.secureJsonData),{tlsCACert:""}),secureJsonFields:kc(Ec({},e.secureJsonFields),{tlsCACert:!1})})),onCertificateChange:r=>t(kc(Ec({},e),{secureJsonData:kc(Ec({},e.secureJsonData),{tlsCACert:r})})),onCertificateReset:()=>t(kc(Ec({},e),{secureJsonData:kc(Ec({},e.secureJsonData),{tlsCACert:""}),secureJsonFields:kc(Ec({},e.secureJsonFields),{tlsCACert:!1})}))},TLSClientAuth:{enabled:e.jsonData.tlsAuth,serverName:e.jsonData.serverName,clientCertificateConfigured:e.secureJsonFields.tlsClientCert,clientKeyConfigured:e.secureJsonFields.tlsClientKey,onToggle:r=>t(kc(Ec({},e),r?{jsonData:kc(Ec({},e.jsonData),{tlsAuth:r})}:{jsonData:kc(Ec({},e.jsonData),{tlsAuth:r,serverName:""}),secureJsonData:kc(Ec({},e.secureJsonData),{tlsClientCert:"",tlsClientKey:""}),secureJsonFields:kc(Ec({},e.secureJsonFields),{tlsClientCert:!1,tlsClientKey:!1})})),onServerNameChange:r=>t(kc(Ec({},e),{jsonData:kc(Ec({},e.jsonData),{serverName:r})})),onClientCertificateChange:r=>t(kc(Ec({},e),{secureJsonData:kc(Ec({},e.secureJsonData),{tlsClientCert:r})})),onClientCertificateReset:()=>t(kc(Ec({},e),{secureJsonData:kc(Ec({},e.secureJsonData),{tlsClientCert:""}),secureJsonFields:kc(Ec({},e.secureJsonFields),{tlsClientCert:!1})})),onClientKeyChange:r=>t(kc(Ec({},e),{secureJsonData:kc(Ec({},e.secureJsonData),{tlsClientKey:r})})),onClientKeyReset:()=>t(kc(Ec({},e),{secureJsonData:kc(Ec({},e.secureJsonData),{tlsClientKey:""}),secureJsonFields:kc(Ec({},e.secureJsonFields),{tlsClientKey:!1})}))},skipTLSVerification:{enabled:e.jsonData.tlsSkipVerify,onToggle:r=>t(kc(Ec({},e),{jsonData:kc(Ec({},e.jsonData),{tlsSkipVerify:r})}))}}}function Ac(e,t){return{headers:Object.keys(e.jsonData).filter((e=>e.startsWith(Cc))).sort().map((t=>{var r;const n=t.slice(Cc.length);return{name:e.jsonData[t],configured:null!=(r=e.secureJsonFields[`${Rc}${n}`])&&r}})),onChange:r=>{const n=Object.fromEntries(Object.entries(e.jsonData).filter((([e])=>!e.startsWith(Cc)))),s=Object.fromEntries(Object.entries(e.secureJsonData||{}).filter((([e])=>!e.startsWith(Rc)))),a=Object.fromEntries(Object.entries(e.secureJsonFields).filter((([e])=>!e.startsWith(Rc))));r.forEach(((e,t)=>{n[`${Cc}${t+1}`]=e.name,e.configured?a[`${Rc}${t+1}`]=!0:s[`${Rc}${t+1}`]=e.value})),t(kc(Ec({},e),{jsonData:n,secureJsonData:s,secureJsonFields:a}))}}}var Qc=Object.defineProperty,Lc=Object.defineProperties,Wc=Object.getOwnPropertyDescriptors,zc=Object.getOwnPropertySymbols,qc=Object.prototype.hasOwnProperty,Mc=Object.prototype.propertyIsEnumerable,Vc=(e,t,r)=>t in e?Qc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Uc=(e,t)=>{for(var r in t||(t={}))qc.call(t,r)&&Vc(e,r,t[r]);if(zc)for(var r of zc(t))Mc.call(t,r)&&Vc(e,r,t[r]);return e},Bc=(e,t)=>Lc(e,Wc(t));const Gc=({config:e,onChange:t,className:r})=>{const n={container:(0,a.css)({maxWidth:578})};return o().createElement(vl,{title:"Advanced HTTP settings",className:(0,a.cx)(n.container,r)},o().createElement(s.InlineField,{htmlFor:"advanced-http-cookies",label:"Allowed cookies",labelWidth:24,tooltip:"Grafana proxy deletes forwarded cookies by default. Specify cookies by name that should be forwarded to the data source.",disabled:e.readOnly,grow:!0},o().createElement(s.TagsInput,{id:"advanced-http-cookies",placeholder:"New cookie (hit enter to add)",tags:e.jsonData.keepCookies,onChange:r=>{t(Bc(Uc({},e),{jsonData:Bc(Uc({},e.jsonData),{keepCookies:r})}))}})),o().createElement(s.InlineField,{htmlFor:"advanced-http-timeout",label:"Timeout",labelWidth:24,tooltip:"HTTP request timeout in seconds",disabled:e.readOnly,grow:!0},o().createElement(s.Input,{id:"advanced-http-timeout",type:"number",min:0,placeholder:"Timeout in seconds","aria-label":"Timeout in seconds",value:e.jsonData.timeout,onChange:r=>{t(Bc(Uc({},e),{jsonData:Bc(Uc({},e.jsonData),{timeout:parseInt(r.currentTarget.value,10)})}))}})))};function Xc(e){const{description:t,suffix:r,feature:n}=e,a=`Learn more about ${n}`,i=(0,s.useStyles2)(Yc);return o().createElement("span",{className:i.container},t,o().createElement("a",{"aria-label":a,href:`https://grafana.com/docs/grafana/next/datasources/${r}`,rel:"noreferrer",target:"_blank"},a))}const Yc=e=>({container:(0,a.css)({color:e.colors.text.secondary,a:(0,a.css)({color:e.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})})});const Jc=/^(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])$/,Hc=(e,t)=>!(e.match(t)||!e);function Zc(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Kc=e=>{const t=e.validationRegex||Jc,[r,a]=(0,i.useState)((()=>!!e.value&&Hc(e.value,t)));var o;!function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=[]);var n=function(e,t){void 0===t&&(t=0);var r=(0,i.useRef)(!1),n=(0,i.useRef)(),s=(0,i.useRef)(e),a=(0,i.useCallback)((function(){return r.current}),[]),o=(0,i.useCallback)((function(){r.current=!1,n.current&&clearTimeout(n.current),n.current=setTimeout((function(){r.current=!0,s.current()}),t)}),[t]),l=(0,i.useCallback)((function(){r.current=null,n.current&&clearTimeout(n.current)}),[]);return(0,i.useEffect)((function(){s.current=e}),[e]),(0,i.useEffect)((function(){return o(),l}),[t]),[a,l,o]}(e,t),s=n[0],a=n[1],o=n[2];(0,i.useEffect)(o,r)}((()=>{a(Hc(e.value,t))}),500,[e.value]);const l={labelWidth:26,disabled:null!==(o=e.disabled)&&void 0!==o&&o,invalid:r,error:e.isInvalidError};return e.label&&(l.label=e.label,l.tooltip=e.tooltip||""),(0,n.jsx)(s.InlineField,(c=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Zc(e,t,r[t])}))}return e}({},l),u=null!=(u={children:(0,n.jsx)(s.Input,{type:"text",placeholder:e.placeholder||"0",width:e.width||40,onChange:t=>{e.onChange(t.currentTarget.value)},value:e.value,"aria-label":e.ariaLabel||"interval input"})})?u:{},Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(u)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(u)).forEach((function(e){Object.defineProperty(c,e,Object.getOwnPropertyDescriptor(u,e))})),c));var c,u};function eu(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tu(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){eu(e,t,r[t])}))}return e}function ru(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const nu=({values:e,onChange:t,id:r})=>{const i=(0,s.useStyles2)(su);return(0,n.jsx)("div",{className:i.wrapper,children:e.length?e.map(((o,l)=>(0,n.jsxs)("div",{className:i.pair,children:[(0,n.jsx)(s.SegmentInput,{id:`${r}-key-${l}`,placeholder:"Tag name",value:o.key,onChange:r=>{t(e.map(((e,t)=>t===l?ru(tu({},e),{key:String(r)}):e)))}}),(0,n.jsx)(s.InlineLabel,{"aria-label":"equals",className:i.operator,children:"as"}),(0,n.jsx)(s.SegmentInput,{id:`${r}-value-${l}`,placeholder:"New name (optional)",value:o.value||"",onChange:r=>{t(e.map(((e,t)=>t===l?ru(tu({},e),{value:String(r)}):e)))}}),(0,n.jsx)(s.ToolbarButton,{onClick:()=>t([...e.slice(0,l),...e.slice(l+1)]),className:(0,a.cx)(i.removeTag,"query-part"),"aria-label":"Remove tag",type:"button",icon:"times"}),l===e.length-1?(0,n.jsx)(s.ToolbarButton,{onClick:()=>t([...e,{key:"",value:""}]),className:"query-part","aria-label":"Add tag",type:"button",icon:"plus"}):null]},l))):(0,n.jsx)(s.ToolbarButton,{icon:"plus",onClick:()=>t([...e,{key:"",value:""}]),className:"query-part","aria-label":"Add tag",type:"button"})})},su=e=>({wrapper:(0,a.css)({display:"flex",flexDirection:"column",gap:`${e.spacing(.5)} 0`}),pair:(0,a.css)({display:"flex",justifyContent:"start",alignItems:"center"}),operator:(0,a.css)({color:e.v1.palette.orange,width:"auto"}),removeTag:(0,a.css)({marginRight:e.spacing(.5)})});function au(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function iu(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){au(e,t,r[t])}))}return e}function ou(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function lu({options:e,onOptionsChange:t}){const o=["loki","elasticsearch","grafana-splunk-datasource","grafana-opensearch-datasource","grafana-falconlogscale-datasource","googlecloud-logging-datasource"],l=(0,i.useMemo)((()=>function(e){var t;if(null==e?void 0:e.tracesToLogsV2)return e.tracesToLogsV2;if(!(null==e?void 0:e.tracesToLogs))return;const r={customQuery:!1};return r.datasourceUid=e.tracesToLogs.datasourceUid,r.tags=e.tracesToLogs.mapTagNamesEnabled?e.tracesToLogs.mappedTags:null===(t=e.tracesToLogs.tags)||void 0===t?void 0:t.map((e=>({key:e}))),r.filterByTraceID=e.tracesToLogs.filterByTraceID,r.filterBySpanID=e.tracesToLogs.filterBySpanID,r.spanStartTimeShift=e.tracesToLogs.spanStartTimeShift,r.spanEndTimeShift=e.tracesToLogs.spanEndTimeShift,r}(e.jsonData)||{customQuery:!1}),[e.jsonData]),{query:c="",tags:u,customQuery:p}=l,g=(0,i.useCallback)((r=>{t(ou(iu({},e),{jsonData:ou(iu({},e.jsonData),{tracesToLogsV2:iu({},l,r),tracesToLogs:void 0})}))}),[t,e,l]);return(0,n.jsxs)("div",{className:(0,a.css)({width:"100%"}),children:[(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{tooltip:"The logs data source the trace is going to navigate to",label:"Data source",labelWidth:26,children:(0,n.jsx)(r.DataSourcePicker,{inputId:"trace-to-logs-data-source-picker",filter:e=>o.includes(e.type),current:l.datasourceUid,noDefault:!0,width:40,onChange:e=>g({datasourceUid:e.uid})})})}),(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(Kc,{label:uu("start"),tooltip:pu("start","0"),value:l.spanStartTimeShift||"",onChange:e=>{g({spanStartTimeShift:e})},isInvalidError:gu})}),(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(Kc,{label:uu("end"),tooltip:pu("end","0"),value:l.spanEndTimeShift||"",onChange:e=>{g({spanEndTimeShift:e})},isInvalidError:gu})}),(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{tooltip:"Tags that will be used in the query. Default tags: 'cluster', 'hostname', 'namespace', 'pod', 'service.name', 'service.namespace'",label:"Tags",labelWidth:26,children:(0,n.jsx)(nu,{values:null!=u?u:[],onChange:e=>g({tags:e})})})}),(0,n.jsx)(cu,{disabled:p,type:"trace",id:"filterByTraceID",value:Boolean(l.filterByTraceID),onChange:e=>g({filterByTraceID:e})}),(0,n.jsx)(cu,{disabled:p,type:"span",id:"filterBySpanID",value:Boolean(l.filterBySpanID),onChange:e=>g({filterBySpanID:e})}),(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{tooltip:"Use a custom query with the possibility to interpolate variables from the trace or span",label:"Use custom query",labelWidth:26,children:(0,n.jsx)(s.InlineSwitch,{id:"customQuerySwitch",value:p,onChange:e=>g({customQuery:e.currentTarget.checked})})})}),p&&(0,n.jsx)(s.InlineField,{label:"Query",labelWidth:26,tooltip:"The query that will run when navigating from a trace to logs data source. Interpolate tags using the `$__tags` keyword",grow:!0,children:(0,n.jsx)(s.Input,{label:"Query",type:"text",allowFullScreen:!0,value:c,onChange:e=>g({query:e.currentTarget.value})})})]})}function cu(e){return(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{disabled:e.disabled,label:`Filter by ${e.type} ID`,labelWidth:26,grow:!0,tooltip:`Filters logs by ${e.type} ID, where the ${e.type} ID should be part of the log line`,children:(0,n.jsx)(s.InlineSwitch,{id:e.id,value:e.value,onChange:t=>e.onChange(t.currentTarget.checked)})})})}const uu=e=>`Span ${e} time shift`,pu=(e,t)=>`Shifts the ${e} time of the span. Default: ${t} (Time units can be used here, for example: 5s, -1m, 3h)`,gu="Invalid time shift. See tooltip for examples.",du=({options:e,onOptionsChange:t})=>{let r=e.type;return r+="tempo"===e.type?"/configure-tempo-data-source/#trace-to-logs":"/#trace-to-logs",(0,n.jsx)(Ko,{title:"Trace to logs",description:(0,n.jsx)(Xc,{description:"Navigate from a trace span to the selected data source's logs.",suffix:r,feature:"trace to logs"}),isCollapsible:!0,isInitiallyOpen:!0,children:(0,n.jsx)(lu,{options:e,onOptionsChange:t})})};function hu(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fu(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){hu(e,t,r[t])}))}return e}function mu(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function vu({options:e,onOptionsChange:i}){var o,l,c,u,p,g,d;const h=(0,s.useStyles2)(Ou);var f;return(0,n.jsxs)("div",{className:(0,a.css)({width:"100%"}),children:[(0,n.jsxs)(s.InlineFieldRow,{className:h.row,children:[(0,n.jsx)(s.InlineField,{tooltip:"The Prometheus data source the trace is going to navigate to",label:"Data source",labelWidth:26,children:(0,n.jsx)(r.DataSourcePicker,{inputId:"trace-to-metrics-data-source-picker",pluginId:"prometheus",current:null===(o=e.jsonData.tracesToMetrics)||void 0===o?void 0:o.datasourceUid,noDefault:!0,width:40,onChange:r=>(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:e},"tracesToMetrics",mu(fu({},e.jsonData.tracesToMetrics),{datasourceUid:r.uid}))})}),(null===(l=e.jsonData.tracesToMetrics)||void 0===l?void 0:l.datasourceUid)?(0,n.jsx)(s.Button,{type:"button",variant:"secondary",size:"sm",fill:"text",onClick:()=>{(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:e},"tracesToMetrics",mu(fu({},e.jsonData.tracesToMetrics),{datasourceUid:void 0}))},children:"Clear"}):null]}),(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(Kc,{label:uu("start"),tooltip:pu("start","-2m"),value:(null===(c=e.jsonData.tracesToMetrics)||void 0===c?void 0:c.spanStartTimeShift)||"",onChange:r=>{(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:e},"tracesToMetrics",mu(fu({},e.jsonData.tracesToMetrics),{spanStartTimeShift:r}))},placeholder:"-2m",isInvalidError:gu})}),(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(Kc,{label:uu("end"),tooltip:pu("end","2m"),value:(null===(u=e.jsonData.tracesToMetrics)||void 0===u?void 0:u.spanEndTimeShift)||"",onChange:r=>{(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:e},"tracesToMetrics",mu(fu({},e.jsonData.tracesToMetrics),{spanEndTimeShift:r}))},placeholder:"2m",isInvalidError:gu})}),(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{tooltip:"Tags that will be used in the metrics query",label:"Tags",labelWidth:26,children:(0,n.jsx)(nu,{values:null!==(f=null===(p=e.jsonData.tracesToMetrics)||void 0===p?void 0:p.tags)&&void 0!==f?f:[],onChange:r=>(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:e},"tracesToMetrics",mu(fu({},e.jsonData.tracesToMetrics),{tags:r}))})})}),null===(d=e.jsonData.tracesToMetrics)||void 0===d||null===(g=d.queries)||void 0===g?void 0:g.map(((r,a)=>(0,n.jsxs)("div",{className:h.queryRow,children:[(0,n.jsx)(s.InlineField,{label:"Link Label",labelWidth:26,tooltip:"Descriptive label for the linked query",children:(0,n.jsx)(s.Input,{label:"Link Label",type:"text",allowFullScreen:!0,value:r.name,width:40,onChange:r=>{var n,s;const o=(null!==(s=null===(n=e.jsonData.tracesToMetrics)||void 0===n?void 0:n.queries)&&void 0!==s?s:[]).map(((e,t)=>t===a?mu(fu({},e),{name:r.currentTarget.value}):e));(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:e},"tracesToMetrics",mu(fu({},e.jsonData.tracesToMetrics),{queries:o}))}})}),(0,n.jsx)(s.InlineField,{label:"Query",labelWidth:10,tooltip:"The Prometheus query that will run when navigating from a trace to metrics. Interpolate tags using the `$__tags` keyword",grow:!0,children:(0,n.jsx)(s.Input,{label:"Query",type:"text",allowFullScreen:!0,value:r.query,onChange:r=>{var n,s;const o=(null!==(s=null===(n=e.jsonData.tracesToMetrics)||void 0===n?void 0:n.queries)&&void 0!==s?s:[]).map(((e,t)=>t===a?mu(fu({},e),{query:r.currentTarget.value}):e));(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:e},"tracesToMetrics",mu(fu({},e.jsonData.tracesToMetrics),{queries:o}))}})}),(0,n.jsx)(s.Button,{variant:"destructive",title:"Remove query",icon:"times",type:"button",onClick:()=>{var r;const n=null===(r=e.jsonData.tracesToMetrics)||void 0===r?void 0:r.queries.filter(((e,t)=>t!==a));(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:e},"tracesToMetrics",mu(fu({},e.jsonData.tracesToMetrics),{queries:n}))}})]},a))),(0,n.jsx)(s.Button,{variant:"secondary",title:"Add query",icon:"plus",type:"button",onClick:()=>{var r,n;(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:e},"tracesToMetrics",mu(fu({},e.jsonData.tracesToMetrics),{queries:[...null!==(n=null===(r=e.jsonData.tracesToMetrics)||void 0===r?void 0:r.queries)&&void 0!==n?n:[],{query:""}]}))},children:"Add query"})]})}const yu=({options:e,onOptionsChange:t})=>{let r=e.type;return r+="tempo"===e.type?"/configure-tempo-data-source/#trace-to-metrics":"/#trace-to-metrics",(0,n.jsx)(Ko,{title:"Trace to metrics",description:(0,n.jsx)(Xc,{description:"Navigate from a trace span to the selected data source's metrics.",suffix:r,feature:"trace to metrics"}),isCollapsible:!0,isInitiallyOpen:!0,children:(0,n.jsx)(vu,{options:e,onOptionsChange:t})})},Ou=e=>({infoText:{paddingBottom:e.spacing(2),color:e.colors.text.secondary},row:(0,a.css)({label:"row",alignItems:"baseline"}),queryRow:(0,a.css)({label:"queryRow",display:"flex",flexFlow:"wrap"})});function bu(e,t){void 0===t&&(t=[]);var r=function(e,t,r){void 0===t&&(t=[]),void 0===r&&(r={loading:!1});var n=(0,i.useRef)(0),s=function(){var e=(0,i.useRef)(!1),t=(0,i.useCallback)((function(){return e.current}),[]);return(0,i.useEffect)((function(){return e.current=!0,function(){e.current=!1}}),[]),t}(),a=(0,i.useState)(r),o=a[0],l=a[1],c=(0,i.useCallback)((function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var a=++n.current;return o.loading||l((function(e){return(0,B.__assign)((0,B.__assign)({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return s()&&a===n.current&&l({value:e,loading:!1}),e}),(function(e){return s()&&a===n.current&&l({error:e,loading:!1}),e}))}),t);return[o,c]}(e,t,{loading:!0}),n=r[0],s=r[1];return(0,i.useEffect)((function(){s()}),[s]),n}function Su(e){const t=(r=e.profileTypes,(0,i.useMemo)((()=>{if(!r)return[];let e=new Map;for(let n of r){var t;let r=[];n.id.indexOf(":")>-1&&(r=n.id.split(":"));const[s,a]=r;e.has(s)||e.set(s,{label:s,value:s,items:[]}),null===(t=e.get(s))||void 0===t||t.items.push({label:a,value:n.id})}return Array.from(e.values())}),[r]));var r,a;return(0,n.jsx)(s.Cascader,{placeholder:e.placeholder,separator:"-",displayAllSelectedLevels:!0,initialValue:e.initialProfileTypeId,allowCustomValue:!0,onSelect:e.onChange,options:t,changeOnSelect:!1,width:null!==(a=e.width)&&void 0!==a?a:26})}function xu(e,t,r,n,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,s)}function wu(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function i(e){xu(a,n,s,i,o,"next",e)}function o(e){xu(a,n,s,i,o,"throw",e)}i(void 0)}))}}function ju(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Tu(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ju(e,t,r[t])}))}return e}function Pu(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _u({options:e,onOptionsChange:o}){var l,c,u,p,g,d,h,f;const m=(0,i.useMemo)((()=>["grafana-pyroscope-datasource"]),[]),[v,y]=(0,i.useState)([]),O=(0,i.useMemo)((()=>{var t;let r=0===v.length?"No profile types found":"Select profile type";return(null===(t=e.jsonData.tracesToProfiles)||void 0===t?void 0:t.datasourceUid)||(r="Please select profiling data source"),r}),[null===(l=e.jsonData.tracesToProfiles)||void 0===l?void 0:l.datasourceUid,v]),{value:b}=bu(wu((function*(){var t;return yield(0,r.getDataSourceSrv)().get(null===(t=e.jsonData.tracesToProfiles)||void 0===t?void 0:t.datasourceUid)})),[null===(c=e.jsonData.tracesToProfiles)||void 0===c?void 0:c.datasourceUid]),{value:S}=bu(wu((function*(){var t;if(b instanceof r.DataSourceWithBackend&&m.includes(b.type)&&b.uid===(null===(t=e.jsonData.tracesToProfiles)||void 0===t?void 0:t.datasourceUid))return yield null==b?void 0:b.getResource("profileTypes")})),[b]);var x;return(0,i.useEffect)((()=>{y(null!=S?S:[])}),[S]),(0,n.jsxs)("div",{className:(0,a.css)({width:"100%"}),children:[(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{tooltip:"The profiles data source the trace is going to navigate to",label:"Data source",labelWidth:26,children:(0,n.jsx)(r.DataSourcePicker,{inputId:"trace-to-profiles-data-source-picker",filter:e=>m.includes(e.type),current:null===(u=e.jsonData.tracesToProfiles)||void 0===u?void 0:u.datasourceUid,noDefault:!0,width:40,onChange:r=>{(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:o,options:e},"tracesToProfiles",Pu(Tu({},e.jsonData.tracesToProfiles),{datasourceUid:r.uid}))}})})}),(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{tooltip:"Tags that will be used in the query. Default tags: 'service.name', 'service.namespace'",label:"Tags",labelWidth:26,children:(0,n.jsx)(nu,{values:null!==(x=null===(p=e.jsonData.tracesToProfiles)||void 0===p?void 0:p.tags)&&void 0!==x?x:[],onChange:r=>{(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:o,options:e},"tracesToProfiles",Pu(Tu({},e.jsonData.tracesToProfiles),{tags:r}))}})})}),(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{tooltip:"Profile type that will be used in the query",label:"Profile type",labelWidth:26,children:(0,n.jsx)(Su,{profileTypes:v,placeholder:O,initialProfileTypeId:null===(g=e.jsonData.tracesToProfiles)||void 0===g?void 0:g.profileTypeId,onChange:r=>{(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:o,options:e},"tracesToProfiles",Pu(Tu({},e.jsonData.tracesToProfiles),{profileTypeId:r}))},width:40})})}),(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{tooltip:"Use a custom query with the possibility to interpolate variables from the trace or span",label:"Use custom query",labelWidth:26,children:(0,n.jsx)(s.InlineSwitch,{id:"profilesCustomQuerySwitch",value:null===(d=e.jsonData.tracesToProfiles)||void 0===d?void 0:d.customQuery,onChange:r=>(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:o,options:e},"tracesToProfiles",Pu(Tu({},e.jsonData.tracesToProfiles),{customQuery:r.currentTarget.checked}))})})}),(null===(h=e.jsonData.tracesToProfiles)||void 0===h?void 0:h.customQuery)&&(0,n.jsx)(s.InlineField,{label:"Query",labelWidth:26,tooltip:"The query that will run when navigating from a trace to profiles data source. Interpolate tags using the `$__tags` keyword",grow:!0,children:(0,n.jsx)(s.Input,{label:"Query",type:"text",allowFullScreen:!0,value:(null===(f=e.jsonData.tracesToProfiles)||void 0===f?void 0:f.query)||"",onChange:r=>(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:o,options:e},"tracesToProfiles",Pu(Tu({},e.jsonData.tracesToProfiles),{query:r.currentTarget.value}))})})]})}const Eu=({options:e,onOptionsChange:t})=>(0,n.jsx)(Ko,{title:"Trace to profiles",description:(0,n.jsx)(Xc,{description:"Navigate from a trace span to the selected data source's profiles.",suffix:`${e.type}/configure-tempo-data-source/#trace-to-profiles`,feature:"trace to profiles"}),isCollapsible:!0,isInitiallyOpen:!0,children:(0,n.jsx)(_u,{options:e,onOptionsChange:t})});function ku(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Cu({options:e,onOptionsChange:r}){var a;const i=(0,s.useStyles2)(Nu);return(0,n.jsx)("div",{className:i.container,children:(0,n.jsx)(s.InlineFieldRow,{className:i.row,children:(0,n.jsx)(s.InlineField,{tooltip:"Displays the node graph above the trace view. Default: disabled",label:"Enable node graph",labelWidth:26,children:(0,n.jsx)(s.InlineSwitch,{id:"enableNodeGraph",value:null===(a=e.jsonData.nodeGraph)||void 0===a?void 0:a.enabled,onChange:n=>{return(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:e},"nodeGraph",(s=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ku(e,t,r[t])}))}return e}({},e.jsonData.nodeGraph),a=null!=(a={enabled:n.currentTarget.checked})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(a)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(a)).forEach((function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(a,e))})),s));var s,a}})})})})}const Ru=({options:e,onOptionsChange:t})=>{let r=e.type;return r+="tempo"===e.type?"/configure-tempo-data-source/#node-graph":"/#node-graph",(0,n.jsx)(vl,{title:"Node graph",description:(0,n.jsx)(Xc,{description:"Show or hide the node graph visualization.",suffix:r,feature:"the node graph"}),children:(0,n.jsx)(Cu,{options:e,onOptionsChange:t})})},Nu=e=>({infoText:(0,a.css)({label:"infoText",paddingBottom:e.spacing(2),color:e.colors.text.secondary}),container:(0,a.css)({label:"container",width:"100%"}),row:(0,a.css)({label:"row",alignItems:"baseline"})});function Iu(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Du(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Iu(e,t,r[t])}))}return e}function $u(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Fu="None",Au="Duration",Qu="Tag";function Lu({options:e,onOptionsChange:r}){var i,o,l;const c=(0,s.useStyles2)(zu),u=[Fu,Au,Qu].map(t.toOption);return(0,n.jsxs)("div",{className:(0,a.css)({width:"100%"}),children:[(0,n.jsx)(s.InlineFieldRow,{className:c.row,children:(0,n.jsx)(s.InlineField,{label:"Label",labelWidth:26,tooltip:"Default: duration",grow:!0,children:(0,n.jsx)(s.Select,{inputId:"label",options:u,value:(null===(i=e.jsonData.spanBar)||void 0===i?void 0:i.type)||"",onChange:n=>{var s;(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:e},"spanBar",$u(Du({},e.jsonData.spanBar),{type:null!==(s=null==n?void 0:n.value)&&void 0!==s?s:""}))},placeholder:"Duration",isClearable:!0,"aria-label":"select-label-name",width:40})})}),(null===(o=e.jsonData.spanBar)||void 0===o?void 0:o.type)===Qu&&(0,n.jsx)(s.InlineFieldRow,{className:c.row,children:(0,n.jsx)(s.InlineField,{label:"Tag key",labelWidth:26,tooltip:"Tag key which will be used to get the tag value. A span's attributes and resources will be searched for the tag key",children:(0,n.jsx)(s.Input,{type:"text",placeholder:"Enter tag key",onChange:n=>(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:e},"spanBar",$u(Du({},e.jsonData.spanBar),{tag:n.currentTarget.value})),value:(null===(l=e.jsonData.spanBar)||void 0===l?void 0:l.tag)||"",width:40})})})]})}const Wu=({options:e,onOptionsChange:t})=>{let r=e.type;return r+="tempo"===e.type?"/configure-tempo-data-source/#span-bar":"/#span-bar",(0,n.jsx)(vl,{title:"Span bar",description:(0,n.jsx)(Xc,{description:"Add additional info next to the service and operation on a span bar row in the trace view.",suffix:r,feature:"the span bar"}),children:(0,n.jsx)(Lu,{options:e,onOptionsChange:t})})},zu=e=>({infoText:(0,a.css)({label:"infoText",paddingBottom:e.spacing(2),color:e.colors.text.secondary}),row:(0,a.css)({label:"row",alignItems:"baseline"})});function qu(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mu(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){qu(e,t,r[t])}))}return e}function Vu(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Uu({options:e,onOptionsChange:r}){var a,i,o,l,c;const u=(0,s.useStyles2)(Bu),p=e=>`Time shift for ${e} of search`,g=e=>`Shifts the ${e} of the time range when searching by TraceID. Searching can return traces that do not fully fall into the search time range, so we recommend using higher time shifts for longer traces. Default: 30m (Time units can be used here, for example: 5s, 1m, 3h`;return(0,n.jsxs)("div",{className:u.container,children:[(0,n.jsx)(s.InlineField,{label:"Use time range in query",tooltip:"The time range can be used when there are performance issues or timeouts since it will narrow down the search to the defined range. Default: disabled",labelWidth:26,children:(0,n.jsx)(s.InlineSwitch,{id:"enable-time-shift",value:(null===(a=e.jsonData.traceQuery)||void 0===a?void 0:a.timeShiftEnabled)||!1,onChange:n=>{(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:e},"traceQuery",Vu(Mu({},e.jsonData.traceQuery),{timeShiftEnabled:n.currentTarget.checked}))}})}),(0,n.jsx)(Kc,{label:p("start"),tooltip:g("start"),value:(null===(i=e.jsonData.traceQuery)||void 0===i?void 0:i.spanStartTimeShift)||"",disabled:!(null===(o=e.jsonData.traceQuery)||void 0===o?void 0:o.timeShiftEnabled),onChange:n=>{(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:e},"traceQuery",Vu(Mu({},e.jsonData.traceQuery),{spanStartTimeShift:n}))},isInvalidError:gu}),(0,n.jsx)(Kc,{label:p("end"),tooltip:g("end"),value:(null===(l=e.jsonData.traceQuery)||void 0===l?void 0:l.spanEndTimeShift)||"",disabled:!(null===(c=e.jsonData.traceQuery)||void 0===c?void 0:c.timeShiftEnabled),onChange:n=>{(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:e},"traceQuery",Vu(Mu({},e.jsonData.traceQuery),{spanEndTimeShift:n}))},isInvalidError:gu})]})}const Bu=e=>({infoText:(0,a.css)({paddingBottom:e.spacing(2),color:e.colors.text.secondary}),container:(0,a.css)({width:"100%"}),row:(0,a.css)({alignItems:"baseline"})});function Gu({options:e,onOptionsChange:a}){var i,o;const l=(0,s.useStyles2)(Bu);return(0,n.jsx)("div",{className:l.container,children:(0,n.jsxs)(s.InlineFieldRow,{className:l.row,children:[(0,n.jsx)(s.InlineField,{tooltip:"The Prometheus data source with the service graph data",label:"Data source",labelWidth:26,children:(0,n.jsx)(r.DataSourcePicker,{inputId:"service-graph-data-source-picker",pluginId:"prometheus",current:null===(i=e.jsonData.serviceMap)||void 0===i?void 0:i.datasourceUid,noDefault:!0,width:40,onChange:r=>(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:a,options:e},"serviceMap",{datasourceUid:r.uid})})}),(null===(o=e.jsonData.serviceMap)||void 0===o?void 0:o.datasourceUid)?(0,n.jsx)(s.Button,{type:"button",variant:"secondary",size:"sm",fill:"text",onClick:()=>{(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:a,options:e},"serviceMap",{datasourceUid:void 0})},children:"Clear"}):null]})})}function Xu(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Yu=({options:e,onOptionsChange:r})=>{var a;const i=(0,s.useStyles2)(Ju);return(0,n.jsxs)(Ko,{title:"Streaming",isCollapsible:!1,description:(0,n.jsxs)(s.Stack,{gap:.5,children:[(0,n.jsx)("div",{children:`Enable streaming for different Tempo features.\n        Currently supported only for search queries and from Tempo version ${kn[En.streaming]} onwards.`}),(0,n.jsx)("a",{href:"https://grafana.com/docs/tempo/latest/traceql/#stream-query-results",target:"_blank",rel:"noreferrer",className:i.a,children:"Learn more"})]}),children:[(0,n.jsx)(s.Alert,{severity:"info",title:"Streaming and self-managed Tempo instances",children:"If your Tempo instance is behind a load balancer or proxy that does not supporting gRPC or HTTP2, streaming will probably not work and should be disabled."}),(0,n.jsx)(s.InlineFieldRow,{children:(0,n.jsx)(s.InlineField,{tooltip:`Enable streaming for search queries. Minimum required version for Tempo: ${kn[En.streaming]}.`,label:"Queries",labelWidth:26,children:(0,n.jsx)(s.InlineSwitch,{id:"streamingEnabled.search",value:(null===(a=e.jsonData.streamingEnabled)||void 0===a?void 0:a.search)||!1,onChange:n=>{var s,a;(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:e},"streamingEnabled",(s=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Xu(e,t,r[t])}))}return e}({},e.jsonData.streamingEnabled),a=null!=(a={search:n.currentTarget.checked})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(a)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(a)).forEach((function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(a,e))})),s))}})})})]})},Ju=e=>({a:(0,a.css)({color:e.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})});function Hu(e,t,r,n,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,s)}function Zu(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ku(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Zu(e,t,r[t])}))}return e}function ep(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function tp({options:e,onOptionsChange:r,datasource:a}){var o,l,c;const u=function(){var e,t=(e=function*(){if(!a)throw new Error("Unable to retrieve datasource");try{yield a.languageProvider.start()}catch(e){throw new Error(vn(e.data.message,"Unable to query Tempo"))}},function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function i(e){Hu(a,n,s,i,o,"next",e)}function o(e){Hu(a,n,s,i,o,"throw",e)}i(void 0)}))});return function(){return t.apply(this,arguments)}}(),{error:p,loading:g}=(0,Wt.A)(u,[a,e]),d=(0,i.useCallback)((n=>{var s;let a=null===(s=e.jsonData.search)||void 0===s?void 0:s.filters;a||(a=[]);const i=a.findIndex((e=>e.id===n.id));i>=0?a=Qt(a,i,n):a.push(n),(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:e},"search",ep(Ku({},e.jsonData.search),{filters:a}))}),[r,e]);(0,i.useEffect)((()=>{var n;(null===(n=e.jsonData.search)||void 0===n?void 0:n.filters)||(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:e},"search",ep(Ku({},e.jsonData.search),{filters:[{id:"service-name",tag:"service.name",operator:"=",scope:O.Resource},{id:"span-name",tag:"name",operator:"=",scope:O.Span}]}))}),[r,e]);const h=null===(l=e.jsonData.search)||void 0===l||null===(o=l.filters)||void 0===o?void 0:o.find((e=>!e.tag));return(0,n.jsxs)(n.Fragment,{children:[a?(0,n.jsx)(hn,{updateFilter:d,deleteFilter:n=>{var s,a;(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:e},"search",ep(Ku({},e.jsonData.search),{filters:null===(a=e.jsonData.search)||void 0===a||null===(s=a.filters)||void 0===s?void 0:s.filter((e=>e.id!==n.id))}))},filters:(null===(c=e.jsonData.search)||void 0===c?void 0:c.filters)||[],datasource:a,setError:()=>{},staticTags:["duration"],isTagsLoading:g,hideValues:!0,query:"{}"}):(0,n.jsx)("div",{children:"Invalid data source, please create a valid data source and try again"}),p&&(0,n.jsx)(s.Alert,{title:"Unable to fetch TraceQL tags",severity:"error",topSpacing:1,children:p.message}),h&&(0,n.jsx)(s.Alert,{title:"Please ensure each filter has a selected tag",severity:"warning",topSpacing:1})]})}function rp(e,t,r,n,s,a,i){try{var o=e[a](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,s)}function np(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sp({options:e,onOptionsChange:a}){var i;const o=(0,s.useStyles2)(Bu),l=(0,r.getDataSourceSrv)(),c=function(){var t,r=(t=function*(){return yield l.get({type:e.type,uid:e.uid})},function(){var e=this,r=arguments;return new Promise((function(n,s){var a=t.apply(e,r);function i(e){rp(a,n,s,i,o,"next",e)}function o(e){rp(a,n,s,i,o,"throw",e)}i(void 0)}))});return function(){return r.apply(this,arguments)}}(),{value:u}=(0,Wt.A)(c,[l,e]);return(0,n.jsxs)("div",{className:o.container,children:[(0,n.jsx)(s.InlineFieldRow,{className:o.row,children:(0,n.jsx)(s.InlineField,{tooltip:"Removes the search tab from the query editor",label:"Hide search",labelWidth:26,children:(0,n.jsx)(s.InlineSwitch,{id:"hideSearch",value:null===(i=e.jsonData.search)||void 0===i?void 0:i.hide,onChange:r=>{return(0,t.updateDatasourcePluginJsonDataOption)({onOptionsChange:a,options:e},"search",(n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){np(e,t,r[t])}))}return e}({},e.jsonData.search),s=null!=(s={hide:r.currentTarget.checked})?s:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(s)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(s,e))})),n));var n,s}})})}),(0,n.jsx)(s.InlineFieldRow,{className:o.row,children:(0,n.jsx)(s.InlineField,{tooltip:"Configures which fields are available in the UI",label:"Static filters",labelWidth:26,children:(0,n.jsx)(tp,{datasource:u,options:e,onOptionsChange:a})})})]})}function ap(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ip(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ap(e,t,r[t])}))}return e}const op=e=>({container:(0,a.css)({marginBottom:e.spacing(2),maxWidth:"900px"})}),lp=e=>(Array.isArray(e)?e:[e]).some((e=>(0,r.getTemplateSrv)().containsTemplate(e))),cp=new t.DataSourcePlugin(Cn).setQueryEditor(_o).setConfigEditor((({options:e,onOptionsChange:t})=>{const a=(0,s.useStyles2)(op);return(0,n.jsxs)("div",{className:a.container,children:[(0,n.jsx)(Fo,{dataSourceName:"Tempo",docsLink:"https://grafana.com/docs/grafana/latest/datasources/tempo",hasRequiredFields:!1}),(0,n.jsx)(s.Divider,{spacing:4}),(0,n.jsx)(ol,{config:e,onChange:t,urlPlaceholder:"http://localhost:3200"}),(0,n.jsx)(s.Divider,{spacing:4}),(0,n.jsx)(bc,ip({},Nc({config:e,onChange:t}))),(0,n.jsx)(s.Divider,{spacing:4}),(0,n.jsx)(Yu,{options:e,onOptionsChange:t}),(0,n.jsx)(s.Divider,{spacing:4}),(0,n.jsx)(du,{options:e,onOptionsChange:t}),(0,n.jsx)(s.Divider,{spacing:4}),(0,n.jsx)(yu,{options:e,onOptionsChange:t}),(0,n.jsx)(s.Divider,{spacing:4}),(0,n.jsx)(Eu,{options:e,onOptionsChange:t}),(0,n.jsx)(s.Divider,{spacing:4}),(0,n.jsx)(Ko,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!1,children:(0,n.jsxs)(s.Stack,{gap:5,direction:"column",children:[(0,n.jsx)(Gc,{config:e,onChange:t}),r.config.secureSocksDSProxyEnabled&&(0,n.jsx)(s.SecureSocksProxySettings,{options:e,onOptionsChange:t}),(0,n.jsx)(vl,{title:"Service graph",description:(0,n.jsx)(Xc,{description:"Select a Prometheus data source that contains the service graph data.",suffix:"tempo/configure-tempo-data-source/#service-graph",feature:"the service graph"}),children:(0,n.jsx)(Gu,{options:e,onOptionsChange:t})}),(0,n.jsx)(Ru,{options:e,onOptionsChange:t}),(0,n.jsx)(vl,{title:"Tempo search",description:(0,n.jsx)(Xc,{description:"Modify how traces are searched.",suffix:"tempo/configure-tempo-data-source/#tempo-search",feature:"Tempo search"}),children:(0,n.jsx)(sp,{options:e,onOptionsChange:t})}),(0,n.jsx)(vl,{title:"TraceID query",description:(0,n.jsx)(Xc,{description:"Modify how TraceID queries are run.",suffix:"tempo/configure-tempo-data-source/#traceid-query",feature:"the TraceID query"}),children:(0,n.jsx)(Uu,{options:e,onOptionsChange:t})}),(0,n.jsx)(Wu,{options:e,onOptionsChange:t})]})})]})})).setQueryEditorHelp((function(){return(0,r.reportInteraction)("grafana_traces_cheatsheet_clicked",{datasourceType:"tempo",grafana_version:r.config.buildInfo.version}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h2",{children:"Tempo Cheat Sheet"}),(0,n.jsxs)("p",{children:[(0,n.jsx)(s.TextLink,{href:"https://grafana.com/docs/tempo/latest/",external:!0,children:"Grafana Tempo"})," ","is an open source, easy-to-use, and high-volume distributed tracing backend."]}),(0,n.jsxs)("p",{children:["Tempo implements"," ",(0,n.jsx)(s.TextLink,{href:"https://grafana.com/docs/tempo/latest/traceql",external:!0,children:"TraceQL"}),", a traces-first query language inspired by LogQL and PromQL. This query language allows users to precisely and easily select spans and jump directly to the spans fulfilling the specified conditions."]}),(0,n.jsxs)("p",{children:["You can compose TraceQL queries using either the Search tab (the TraceQL query builder) or the TraceQL tab (the TraceQL query editor). Both of these methods let you build queries and drill-down into result sets. (",(0,n.jsx)(s.TextLink,{href:"https://grafana.com/docs/grafana/latest/datasources/tempo/query-editor/",external:!0,children:"Learn more"}),")"]})]})}));(0,r.getAppEvents)().subscribe(t.DashboardLoadedEvent,(({payload:{dashboardId:e,orgId:t,grafanaVersion:n,queries:s}})=>{try{const a=s.tempo;if(!(null==a?void 0:a.length))return;let i={grafana_version:n,dashboard_id:e,org_id:t,service_map_query_count:0,traceql_query_count:0,upload_query_count:0,service_map_queries_with_template_variables_count:0,traceql_queries_with_template_variables_count:0};for(const e of a)e.hide||("serviceMap"===e.queryType?(i.service_map_query_count++,e.serviceMapQuery&&lp(e.serviceMapQuery)&&i.service_map_queries_with_template_variables_count++):"traceql"===e.queryType?(i.traceql_query_count++,lp(e.query)&&i.traceql_queries_with_template_variables_count++):"upload"===e.queryType&&i.upload_query_count++);(0,r.reportInteraction)("grafana_tempo_dashboard_loaded",i)}catch(e){console.error("error in tempo tracking handler",e)}}))})(),p})()));
//# sourceMappingURL=module.js.map